(this.webpackJsonp=this.webpackJsonp||[]).push([[5],{"+4sY5OxF":function(t,e){t.exports=function(t){return'<form class="archive-form"> <p>'+tb_i18n.get("event.menu.confirm.archive")+'</p> <button class="btn btn-danger" type="submit">'+tb_i18n.get("archive")+"</button></form>"}},"+ChHpCVR":function(t,e,n){var i,o,r={}.hasOwnProperty;o=n("zBkMzjyh"),i=n("OZDTLQvo"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,o),e.prototype.pluginType="plugin_for_project",e.prototype.createPlugin=function(t){var e;return e=this.view.projectModel.toJSON(),this.requestSubView(i,{view:this.view,pluginModel:t,data:e})},e}()},"+QYKsXiA":function(t,e,n){var i,o,r,s={}.hasOwnProperty;r=n("7gS+SwzT"),o=n("7fdVgQwj"),i=n("ByKekhNl"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,r),e.prototype.container=".nav",e.prototype.pluginType="app_for_project",e.prototype.initialize=function(t){var n;return this.view=t.view,this.collection=t.collection,n=t.options,this.nativePluginConfigs=n.nativePluginConfigs,this.shouldHideApps=this.nativePluginConfigs.filter(function(t){return t.hide}).map(function(t){return t.url}),e.__super__.initialize.apply(this,arguments)},e.prototype.createPlugin=function(t){var e,n,r,s;return e=this.view.projectModel.toJSON(),r=t.get("url"),n=this.nativePluginConfigs.find(function(t){return t.url===r})||{},s=function(){switch(t.get("url")){case"teambition://projectinfoapp":return i;default:return o}}(),this.requestSubView(s,{view:this.view,data:e,pluginModel:t,nativePluginConfig:n})},e.prototype.afterRenderPlugin=function(t,e){return this.view.renderPlugins(e.$el),this.saveNail(t,e)},e.prototype.shouldShowPlugin=function(t){var n,i,o;return n=(i=t.pick("mode","url")).mode,o=i.url,!("native"===n&&this.shouldHideApps.indexOf(o)>=0)&&e.__super__.shouldShowPlugin.apply(this,arguments)},e}()},"+ToXT53j":function(t,e,n){var i,o,r={}.hasOwnProperty;i=n("VuB9cZyl"),o=n("/dfPTVwF"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,i),e.prototype.name="bookkeepings",e.prototype.boundToObjectType="project",e.prototype.model=o,e}()},"+WIg4jaI":function(t,e){t.exports=function(t){return'<form class="stage-template-created"> <p class="stage-template-success">'+t.successInfo+'</p> <p class="muted">'+tb_i18n.get("tasklist.menu.add.templates.desc")+'</p> <button class="btn btn-primary">'+tb_i18n.get("confirm")+"</button></form>"}},"/VuqkkbT":function(t,e){t.exports=function(t){var e,n,i="undefined"!=typeof _encodeHTML?_encodeHTML:(e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},n=/&(?!#?\w+;)|<|>|"|'|\//g,function(t){return t?t.toString().replace(n,function(t){return e[t]||t}):""}),o='<header class="creator-header"> <h4 class="creator-title"> ';return t.isEdit?o+=' <span class="creator-location-tips">'+t.sourceName+"</span> ":(o+=' <span class="creator-location-tips">'+tb_i18n.get("post.creator.tips_1")+"</span> ",t.isStatic?o+=' <span class="creator-location"></span> ':o+=' <a class="creator-location-handler" data-gta="{action: \'move content\', type: \'post\', control: \'Global New Post\'}"> <span class="creator-location"></span> <span class="icon icon-chevron-down"></span> </a> ',o+=' <span class="creator-location-tips">'+tb_i18n.get("post.creator.tips_2")+"</span> "),o+=' </h4> <a class="creator-close pull-right icon icon-remove"></a></header><header class="post-creator-header"> <input class="form-control post-title-input" type="text" placeholder="'+tb_i18n.get("post.creator.title.placeholder")+'" maxlength="70" value="'+i(t.title)+'"/></header><section class="post-creator-body ',t.isEdit&&(o+="is-edit"),o+='"> <section class="post-creator-editor-wrap"></section> ',t.hasMemCache&&(o+=' <div class="draft">'+tb_i18n.get("draft")+' <a class="restore-draft">'+tb_i18n.get("draft.restore")+'</a> <a class="discard-draft">'+tb_i18n.get("draft.discard")+"</a> </div> "),o+=' <footer class="involve-set"></footer></section><footer class="post-creator-footer"> <div class="post-creator-footer-fixed"> <a class="creator-visible"></a> <button class="btn btn-primary submit-handler pull-right"> ',t.isEdit?o+=""+tb_i18n.get("post.update"):o+=""+tb_i18n.get("submit.post"),o+=" </button> </div></footer>"}},"/f0zoIw5":function(t,e,n){t.exports=function(t){var e="",i=n("2qRnoGmE");return e+='<header class="my-tab-header events-header"> <ul class="my-header-tabs"> <li class="events-tab is-active" data-type="future">'+tb_i18n.get("my.events.future")+'</li> <li class="events-tab" data-type="past">'+tb_i18n.get("my.events.past")+"</li> </ul> ",i.FEATURES.subPersonalCalendar&&(e+=" <a class=\"icalendar pull-right\" data-gta=\"{action: 'subscribe to calendar', type: 'event', control: 'Subscribe My Events'}\"> "+tb_i18n.get("iCalendar.title",t.title)+" </a> "),e+='</header><div class="schedule-wrap"></div>'}},"0IQem2k4":function(t,e,n){var i,o,r,s={}.hasOwnProperty;n("oXTsRL5n"),r=n("XbrdCDrd"),o=n("Jd7u/zMm"),i=n("oAE0d9eX"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,r),e.prototype.viewName="LinkTabPluginItem",e.prototype.className="link-tab-plugin",e.prototype.tagName="li",e.prototype.events={"click a":"onPluginClick"},e.prototype.render=function(){return this.$el.html(o(this.pluginModel.toJSON()))},e.prototype.getToken=function(){var t;return t=this.pluginModel.get("needAuthFrom"),this.view.tokens[t]},e.prototype.onPluginClick=function(){var t,e,n;return n=this.getToken(),t=this.view.$el.find(".object-picker-body"),e=this.requestSubView(i,{pluginModel:this.pluginModel,view:this.view,token:n}),t.html(e.$el)},e}()},"0ZfGkaWP":function(t,e,n){"use strict";n.d(e,"a",function(){return a});var i=n("mrSGxOB2"),o=n("q1tIBJhx"),r=n("TSYQbtd+"),s=n.n(r),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onToggleCheck=function(t){t.stopPropagation(),e.props.onCheckClick&&e.props.onCheckClick()},e}return i.d(e,t),e.prototype.renderCheckbox=function(){return o.createElement("div",{className:"frame-check-box",onClick:this.onToggleCheck},o.createElement("i",{className:"check-mark icon icon-tick"}))},e.prototype.renderContent=function(){return this.props.children&&o.createElement("div",{className:"frame-content"},this.props.children)},e.prototype.render=function(){var t=s()("check-frame",{checked:!!this.props.checked,disabled:!!this.props.disabled});return o.createElement("div",{className:t},this.renderContent(),this.renderCheckbox())},e}(o.PureComponent)},"0dSR9rDm":function(t,e){t.exports=function(t){var e,n,i="undefined"!=typeof _encodeHTML?_encodeHTML:(e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},n=/&(?!#?\w+;)|<|>|"|'|\//g,function(t){return t?t.toString().replace(n,function(t){return e[t]||t}):""}),o="";if(t.categories.length>0){o+=' <div class="panel-title"> <strong>'+tb_i18n.get("bookkeeping.home.fields.category")+'</strong> </div> <ul class="list"> ';var r=t.categories;if(r)for(var s,a=-1,c=r.length-1;a<c;)o+=' <li> <a class="category" data-id="'+(s=r[a+=1])._id+'">'+i(s.title)+'</a> <span class="icon icon-tick"></span> </li> ';o+=" </ul>"}return o}},"1S5HL+ok":function(t,e,n){"use strict";var i=n("mrSGxOB2"),o=n("q1tIBJhx"),r=n("TSYQbtd+"),s=n.n(r),a=n("tLZJUYWX"),c=n("XhpHwZVN"),l=n("Pm6yRo3w"),p=n("0ZfGkaWP"),u=n("EFIOe9De"),d=n("ob9kWEi7"),h=n("uQN6Cr2k").isProperType,f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.d(e,t),e.prototype.renderCheckFrame=function(){return o.createElement(p.a,{checked:this.props.selected,disabled:this.props.isDisabled,onCheckClick:this.props.onSelectClick},o.createElement("div",{className:"library-grid-item-content",onClick:this.props.onClick},this.renderAvatar(),this.renderHandlers()))},e.prototype.render=function(){var t=s()("library-grid-item","library-grid-"+this.props.type);return o.createElement("li",{className:t},this.renderCheckFrame(),this.renderTitlebar())},e}(o.PureComponent),v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onOpenClick=function(){e.props.onOpenClick()},e.extMatchType=function(){return h(e.props.item)},e.getName=function(){var t=e.props.item.fileName;if(e.props.isEditing&&e.extMatchType()){var n=t.split(".").pop()||"";t=t.substring(0,t.length-n.length-1)}return t},e.onSubmit=function(t){e.extMatchType()&&(t=t+"."+e.props.item.fileName.split(".").pop());return e.props.onSubmit(t)},e}return i.d(e,t),e.prototype.renderThumbnail=function(t){var e={backgroundImage:"url("+t+")"};return o.createElement("div",{className:"grid-item-thumbnail",style:e})},e.prototype.renderAvatar=function(){var t=this.props.item,e=t.thumbnail,n=t.thumbnailUrl;return e||n?this.renderThumbnail(e||n):o.createElement(c.WorkIcon,i.a({},this.props.item))},e.prototype.renderVisible=function(){return"involves"===this.props.item.visible&&o.createElement("span",{className:"icon icon-lock hinted","data-title":a.get("visible.to.involve")})},e.prototype.renderTitlebar=function(){return o.createElement(l.a,{name:this.getName(),onSubmit:this.onSubmit,triggerOnClick:!0,editable:this.props.item.canModify,editing:this.props.isEditing,onEnterEditing:this.props.onEnterEditing,onClose:this.props.onQuitEditing},this.renderVisible())},e.prototype.renderHandlers=function(){var t=this.props.item,e=t.canDownload,n=t.isFileLocalExist;return o.createElement(u.a,{type:"work",downloadOnly:!0,showDownload:e,onEditClick:this.props.onEnterEditing,onOpenClick:this.props.onOpenClick,onDownloadClick:this.props.onDownloadClick,onMenuOpen:this.props.onMenuOpen,isFileLocalExist:n})},e}(f),y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.d(e,t),e.prototype.renderTitlebar=function(){return o.createElement(l.a,{name:this.props.item.title,onSubmit:this.props.onSubmit,creating:!1,editing:this.props.isEditing,onEnterEditing:this.props.onEnterEditing,onClose:this.props.onQuitEditing,triggerOnClick:!0,editable:this.props.item.canModify})},e.prototype.renderHandlers=function(){var t=this.props.item,e=t.canModify,n=t.canArchive,i=t.canMove,r=t.canDelete,s=t.canDownload,a=t.canChangeVisible,c=e||n||i||r||a;return this.props.isDisabled?o.createElement("noscript",null):o.createElement(u.a,{type:"collection",downloadOnly:!0,showMenu:c,showDownload:s,onEditClick:this.props.onEnterEditing,onDownloadClick:this.props.onDownloadClick,onMenuOpen:this.props.onMenuOpen})},e.prototype.renderAvatar=function(){return o.createElement(c.CollectionIcon,i.a({},this.props.item))},e}(f),g=Object(d.a)(v,y),m=function(t){return o.createElement("div",{className:"library-grid-collection-creator library-grid-item"},o.createElement(p.a,{disabled:!0},o.createElement("div",{className:"library-grid-item-content"},Object(c.CollectionIcon)())),o.createElement(l.a,{creating:!0,onSubmit:t.onSubmit,onClose:t.onClose,rootClass:"library-grid-collection-creator"}))};n.d(e,"b",function(){return g}),n.d(e,"a",function(){return m}),n("nQmsKn43")},"1tVQcfxV":function(t,e,n){var i,o,r,s,a,c,l,p,u={}.hasOwnProperty;c=n("GESwhXbR").Toast,r=n("7+ovutzo"),a=n("6XSa3ffj"),s=n("ypWNgh6R"),p=n("+h7VEZku").VisibilityController,l=n("RLD3BeS/").ToastWithObject,o=n("6FlLi7Do"),i=n("V6kXVEK8"),e.Constructor=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,a),e.prototype.viewName="EntryMenuView",e.prototype.popoverTitle="",e.prototype.events={"click .edit-entry-handler":"openEditor","click .revoke-entry-handler":"revokeEntry","click .approve-entry-handler":"approveEntry","click .favorite-entry-handler":"favoriteEntry","click .unarchive-entry-handler":"unarchiveEntry","click .archive-entry-handler":"enterArchiveSubMenu","submit .entry-archive-form":"submitArchive"},e.prototype.initialize=function(t){return this._projectId=t.entryModel.get("_projectId"),this.popoverTitle=tb_i18n.get("entry.menu.title"),this.entryModel=t.entryModel,this.listen(),e.__super__.initialize.apply(this,arguments)},e.prototype.listen=function(){return this.listenTo(this.entryModel,"change:visible",this.renderVisible)},e.prototype.render=function(){var t;return this.unmountReactViews(),this.bookkeepingModel=this.options.bookkeepingModel,t=this.entryModel.toJSON(),"list"!==this.options.status&&(t.approveRight=this.bookkeepingModel.get("approveRight")),t.permissions=this.entryModel.hasPermissions("put","put.archive"),t.canModifyVisibility=this.entryModel.canModifyVisibility(),this.$el.html(o(t)),this.$visibleSwitchers=this.$(".switch-visible-handler"),this.renderVisible(),this.setupPlugins({_projectId:this._projectId}),this},e.prototype.renderVisible=function(){if(this.entryModel.canModifyVisibility())return this.requestReactView(this.$visibleSwitchers.get(0),p,{visibility:this.entryModel.get("visible"),onChange:this.switchVisible.bind(this)})},e.prototype.openEditor=function(t){var e,n;return this.hide(),e=-1===(n=this.entryModel.get("type"))?tb_i18n.get("entry.creator.expense.title"):tb_i18n.get("entry.creator.income.title"),this.parentView.requestSubView(s,{width:600,title:e,modalClass:"entry-creator-modal-view"}).open(r,{_entryId:this.entryModel.id,type:n}),this.remove()},e.prototype.approveEntry=function(){var t;return this.entryModel.approve({success:(t=this,function(){return t.remove(),c.success({message:tb_i18n.get("entry.menu.success.approve")})})}),this},e.prototype.revokeEntry=function(){var t;return this.entryModel.revoke({success:(t=this,function(){return t.remove(),c.success({message:tb_i18n.get("entry.menu.success.revoke")})})}),this},e.prototype.enterArchiveSubMenu=function(t){var e;return this.enterSubMenu(tb_i18n.get("archive"),(e=this,function(){return e.$el.html(i())})),this},e.prototype.submitArchive=function(t){var e;return t.preventDefault(),this.entryModel.archive({success:(e=this,function(){return e.remove(),l.archive()})}),this},e.prototype.unarchiveEntry=function(){var t,e;return(t=this.entryModel).unarchive({success:(e=this,function(){return l.unarchive(t),e.remove()})}),this},e.prototype.favoriteEntry=function(){var t,e;return t=this.entryModel.get("isFavorite"),this.entryModel[t?"unFavorite":"doFavorite"]({success:(e=this,function(t){var n;if(e.entryModel.set("isFavorite",t.isFavorite),e.render(),!t.isFavorite&&e.options.onUnfavorite)return"function"==typeof(n=e.options).onUnfavorite&&n.onUnfavorite(e.entryModel.get("_id")),e.parentView.close()})}),this},e.prototype.switchVisible=function(t){return this.entryModel.saveAttr("visible",t)},e.prototype.unmountReactViews=function(){if(this.$visibleSwitchers)return this.unmountReact(this.$visibleSwitchers.get(0))},e.prototype.onHidden=function(){return this.unmountReactViews(),e.__super__.onHidden.apply(this,arguments)},e}()},"1tpV5y6A":function(t,e,n){var i,o,r,s,a,c,l,p,u,d,h,f,v,y,g,m,b,k,w,_={}.hasOwnProperty;m=n("a+N5u/Cl"),w=n("sa1Ed382"),f=n("vmWJWrVe"),p=n("GESwhXbR").Toast,h=n("3eMzznN/"),u=n("RLD3BeS/").ToastWithObject,y=n("BvQw3fHc"),n("OmupbwLD"),c=n("tGfyIDI3"),g=n("o4N9kv/m"),o=n("fnRWEXeT"),v=n("OmupbwLD"),d=n("eubUSX4T"),l=n("77NnVLwu"),a=n("0FRv5rrl"),r=n("2IoZvthL").MyFilesContainer,i=n("cZTZA4fV").BackboneMap,k=n("ctsD9mWH").store,b=n("cZTZA4fV").myFilesClearSelections,s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)_.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,f),e.prototype.viewName="MyFilesView",e.prototype.className="my-files-view my-content-view library-view clearfix fade",e.prototype.initialize=function(t){return null==t&&(t={}),this.category="create",this.render(),m.delay((e=this,function(){return e.$el.addClass("in")}));var e},e.prototype.getGtaCategory=function(){return"create"===this.category?"created":"follower"},e.prototype.getLibraryMode=function(){return w.PREFERENCE.get("libraryMode")},e.prototype.switchSortMethod=function(t){return this.sendGtaEvent({action:"change view order",sortMethod:t}),w.PREFERENCE.toggleMyFileOrder(t)},e.prototype.sendGtaEvent=function(t){return w.gta.event(Object.assign({type:"work",page:"Me Page",segment:"files list",category:this.getGtaCategory(),control:this.getLibraryMode()},t))},e.prototype.openCollectionPicker=function(t){var e,n,i;return null!=(n=this.picker)&&n.remove(),e=m.extend({_projectId:null!=(i=w.APP.getClosestProject())?i.id:void 0,isForkOrMove:"fork"},t),this.picker=this.requestSubView(v).open(o,e)},e.prototype.onMoveWork=function(t){var e,n;return this.sendGtaEvent({action:"move content"}),n=i[t],e=m.escape(n.get("fileName")),this.openCollectionPicker({isForkOrMove:"move",isNoCollectionSelected:!0,_organizationId:n.get("_organizationId"),title:tb_i18n.get("work.move.message",e),disabled:[n.get("_parentId")],select:function(t){return t.id===n.get("_parentId")?p.info({message:tb_i18n.get("work.move.current.collection")}):n.moveToCollection(t.id,{success:function(){return u.moveWork(t)}})}})},e.prototype.onRemoveWork=function(t){var e;return i[t].destroy({wait:!0,success:(e=this,function(){var t;return e.sendGtaEvent({action:"delete content"}),p.success({message:tb_i18n.get("delete.success")}),null!=(t=e.$workMenuPopover)?t.remove():void 0})})},e.prototype.onArchiveWork=function(t){var e;return i[t].archive({success:(e=this,function(){var t;return e.sendGtaEvent({action:"archive"}),u.archive(),null!=(t=e.$workMenuPopover)?t.remove():void 0})})},e.prototype.onFavoriteWork=function(t,e){var n,o,r;return null==e&&(e=!1),o=(r=i[t]).get("isFavorite"),e&&o?Promise.resolve():(n=!e&&o?"unFavorite":"doFavorite",new Promise(function(t,e){return r[n]({success:function(e){return r.set("isFavorite",e.isFavorite),t(e)},error:e})}))},e.prototype.onForkWork=function(t){var e,n,o,r;if(!(o=i[t]).get("isArchived"))return e=m.escape(o.get("fileName")),n=tb_i18n.get("work.copy.message",e),this.openCollectionPicker({title:n,isNoCollectionSelected:!0,_organizationId:o.get("_organizationId"),disabled:[o.get("_parentId")],select:(r=this,function(t){return t.id===o.get("_parentId")?p.info({message:tb_i18n.get("work.copy.current.collection")}):o.forkToCollection(t.id,{success:function(){return r.sendGtaEvent({action:"copy"}),u.forkWork(t)}})})})},e.prototype.onSwitchVisibility=function(t,e){var n;return n=i[t],this.sendGtaEvent({action:"toggle visibility"}),n.saveAttr("visible",e)},e.prototype.onComponentUnmount=function(){var t;return null!=(t=this.$workMenuPopover)?t.remove():void 0},e.prototype.openWorkMenu=function(t,e){var n,o,r,s;if(o=$(t),n=o.closest("li"),!o.data("bs.popover"))return r=i[e],this.$workMenuPopover=this.requestSubView(y,{$toggler:o,inGridView:"grid"===this.getLibraryMode(),workModel:r,onForkClick:(s=this,function(){return s.onForkWork(e)}),onFavoriteClick:function(t){return function(){return t.sendGtaEvent({action:"add to favorite"}),t.onFavoriteWork(e)}}(this),onArchiveClick:function(t){return function(){return t.onArchiveWork(e)}}(this),onRemoveClick:function(t){return function(){return t.onRemoveWork(e)}}(this),onMoveClick:function(t){return function(){return t.onMoveWork(e)}}(this),onUpdateClick:function(t){return function(){return t.onUpdateClick(e)}}(this),onSwitchVisibility:function(t){return function(n){return t.onSwitchVisibility(e,n)}}(this),onHidden:function(){return n.removeClass("open")},onShown:function(){return n.addClass("open")}}).show()},e.prototype.onModifyWork=function(t,e,n){var o,r,s;return null==n&&(n=!1),r=i[t],e&&(o=r.get("fileName")),e&&h.filenameReservedRegex(e)?(p.error(tb_i18n.get("work.rename.reserved.string")),Promise.reject()):new Promise((s=this,function(i,a){return r.save(null,{attrs:{fileName:e},success:function(){return s.sendGtaEvent({action:"edit title"}),n||u.rename(function(){return s.onModifyWork(t,o,!0)}),i()}})}))},e.prototype.onOpenWork=function(t){var e,n;return n=i[t],null!=(e=window.WebExtensionWin10)&&"function"==typeof e.openFile?e.openFile(n.get("fileKey")):void 0},e.prototype.batchFavorite=function(t){var e,n;return this.sendBatchEvent({action:"favorite content"}),e=t.map((n=this,function(t){return n.onFavoriteWork(t,!0)})),Promise.all(e).then(function(){return p.success(tb_i18n.get("library.batch.favorite.toast",t.length))})},e.prototype.batchUnfavorite=function(t){var e,n;return this.sendBatchEvent({action:"unfavorite content"}),e=t.map((n=this,function(t){return n.onFavoriteWork(t)})),Promise.all(e).then(function(){return p.success(tb_i18n.get("library.batch.unfavorite.toast",t.length))})},e.prototype.batchArchive=function(t){var e;return this.sendBatchEvent({action:"archive content"}),e=t.map(function(t){return new Promise(function(e,n){return i[t].archive({success:e,error:n})})}),Promise.all(e).then(function(){return u.archive()})},e.prototype.batchFork=function(t){return this.sendBatchEvent({action:"copy content"}),this.batchMoveOrFork("fork",t)},e.prototype.batchMove=function(t){return this.sendBatchEvent({action:"move content"}),this.batchMoveOrFork("move",t)},e.prototype.batchMoveOrFork=function(t,e){var n,o,r,s,a;return null!=(o=this.picker)&&o.remove(),s=e.map(function(t){return i[t]}),n=tb_i18n.get("library.works.count",e.length),r=function(){switch(t){case"fork":return tb_i18n.get("library.fork.to",n);case"move":return tb_i18n.get("library.move.to",n)}}(),this.openCollectionPicker({isForkOrMove:t,isNoCollectionSelected:!0,_organizationId:s[0].get("_organizationId"),title:r,select:(a=this,function(e){return k.dispatch(b()),a.forkOrMoveToCollection(t,e,s)})})},e.prototype.forkOrMoveToCollection=function(t,e,n){return Promise.all(m.map(n,function(n){return new Promise(function(i,o){return n.forkOrMoveToCollection(e.id,t,{success:i,error:o})})})).then((i=this,function(){var o;return"move"===t&&i.sendBatchEvent({action:"added content"}),o=function(){switch(t){case"move":return"moveWork";case"fork":return"forkWork"}}(),u[o](e,n.length)})).catch(function(t){return p.error((null!=t?t.message:void 0)||t)});var i},e.prototype.onDownloadWork=function(t){var e,n,o;return n=t._id,e=t.fileKey,t.downloadUrl,o=i[n],this.sendGtaEvent({action:"open detail",method:"download"}),null!=window.WebExtensionWin10&&"&filekey="+e+"&workid="+n,h.downloadFile(o.toJSON())},e.prototype.fetchTargetModel=function(t){return t.get("_projectId")?new Promise(function(e,n){return l.fetch(t.get("_projectId"),{success:e,error:n})}):t.get("_organizationId")?new Promise(function(e,n){return a.fetch(t.get("_organizationId"),{success:e,error:n})}):Promise.resolve()},e.prototype.onUpdateClick=function(t){var e,n;return this.sendGtaEvent({action:"update file",method:"update",type:"file"}),e=i[t],this.fetchTargetModel(e).then((n=this,function(t){return n.requestSubView(g,{targetModel:t,collection:new d([],{_boundToObjectId:e.get("_parentId")}),isBackground:!0,onComplete:function(t,n){return e.createVersion(t,{success:function(t){return n.model.set(Object.assign(e.toJSON(),t,{thumbnail:"",isUpdateVersion:!0,completed:!0}))}})}}).uploader.triggerUpload()}))},e.prototype.openPreviewer=function(t,e){var n,o;return n=i[t],o=e.map(function(t){return i[t]}),this.sendGtaEvent({action:"open detail",type:"file"}),this.requestSubView(v).open(c,{workModels:o,workModel:n})},e.prototype.checkSelectPermission=function(t,e){return e.every(function(e){return e.hasPermission(t)})},e.prototype.getPermissions=function(t){var e,n,o,r,s,a,c,l;return s=(l=t.map(function(t){return i[t]})).length,!1,c=this.checkSelectPermission("put.version",l)&&1===s,r=this.checkSelectPermission("put.move",l)&&s,o=this.checkSelectPermission("del",l)&&s,n=this.checkSelectPermission("put.fork",l)&&s,e=this.checkSelectPermission("put.archive",l),a=l.every(function(t){return t.get("isFavorite")}),{download:!1,update:c,move:r,del:o,copy:n,archive:e,favorite:l.some(function(t){return!t.get("isFavorite")}),unfavorite:a}},e.prototype.sendBatchEvent=function(t){return w.gta.event(Object.assign({type:"work",page:"Me Page",segment:"files list",category:this.getGtaCategory(),control:"batch"},t))},e.prototype.render=function(){return this.requestReactView(this.el,r,{onSwitchViewMode:(t=this,function(e){return w.gta.event({action:"switch file view",control:e,segment:"files list",category:t.getGtaCategory()}),w.PREFERENCE.toggleLibraryMode(e)}),onRefreshSection:function(t){return function(e){return t.category=e,w.gta.event({action:"open file list",segment:"files list",category:t.getGtaCategory(),page:"Me Page"})}}(this),onMoveWork:this.onMoveWork.bind(this),onModifyWork:this.onModifyWork.bind(this),onWorkClick:this.openPreviewer.bind(this),onDownloadWork:this.onDownloadWork.bind(this),onOpenWorkClick:this.onOpenWork.bind(this),onUpdateClick:this.onUpdateClick.bind(this),onOpenWorkMenu:this.openWorkMenu.bind(this),onComponentUnmount:this.onComponentUnmount.bind(this),onBatchFavorite:this.batchFavorite.bind(this),onBatchUnfavorite:this.batchUnfavorite.bind(this),onBatchArchive:this.batchArchive.bind(this),onBatchCopy:this.batchFork.bind(this),onBatchMove:this.batchMove.bind(this),getPermissions:this.getPermissions.bind(this),sortByName:this.switchSortMethod.bind(this,"name"),sortBySize:this.switchSortMethod.bind(this,"size"),sortByUpdated:this.switchSortMethod.bind(this,"updated")},{redux:!0});var t},e}(),t.exports=s},"2FjqrY7D":function(t,e){t.exports=function(t){var e="";return t.isLast?e+=' <p class="edit-info muted"> '+tb_i18n.get("tasklist.menu.last.cannot.edit")+". </p>":e+=' <form class="tasklist-archive-form"> <p>'+tb_i18n.get("tasklist.menu.confirm.archive",t.name)+'</p> <button class="btn btn-danger" type="submit">'+tb_i18n.get("archive")+"</button> </form>",e}},"2IoZvthL":function(t,e,n){"use strict";n.r(e);var i=n("mrSGxOB2"),o=n("q1tIBJhx"),r=n("/MKjzBat"),s=n("tLZJUYWX"),a=n("a+N5u/Cl"),c=n("TSYQbtd+"),l=n.n(c),p=n("QHFeugHF"),u=n("DOZCBSCZ"),d=n("YqUJfXDr"),h=n("v9kTbSr6"),f=n("1S5HL+ok"),v=n("NqPR4Rud"),y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.d(e,t),e.prototype.renderFileItems=function(){var t=this,e="grid"===this.props.viewMode?f.b:v.b;return this.props.files.map(function(n){return o.createElement(e,{key:n._id,isRoot:!0,isCreating:!1,list:t.props.files,viewMode:t.props.viewMode,showCreator:"create"!==t.props.section,item:n,type:"work",onComponentUnmount:t.props.onComponentUnmount,onDownloadWork:t.props.onDownloadWork,onModifyWork:t.props.onModifyWork,onMoveWork:t.props.onMoveWork,onOpenWorkClick:t.props.onOpenWorkClick,onOpenWorkMenu:t.props.onOpenWorkMenu,onSelect:t.props.onSelect,onWorkClick:t.props.onWorkClick,onUpdateClick:t.props.onUpdateClick,onComponentUpdated:a.noop,onMoveCollection:a.noop,onDownloadCollection:a.noop,onOpenCollectionMenu:a.noop,addLibraryUploaderBtn:a.noop,onCollectionClick:a.noop,initDragHandler:a.noop,initDropHandler:a.noop,onLeaveCreating:a.noop})})},e.prototype.render=function(){var t=l()("library-field","library-"+this.props.viewMode);return o.createElement("ul",{className:t},this.renderFileItems())},e}(o.PureComponent),g=n("cZTZA4fV");n.d(e,"MyFilesContainer",function(){return w});var m=n("sa1Ed382");n("D543+7QT");var b={onChangeSection:g.myFilesChangeSection,onUpdateSort:g.myFilesUpdateSort,onLoadMore:g.getMyFilesLoadMore,onUnmount:g.myFilesClose,onSelect:g.myFilesSelectOne},k=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onChangeSection=function(t){return function(){e.props.onRefreshSection(t),e.props.onChangeSection(t)}},e.onSortByName=function(){e.props.sortByName(),e.props.onUpdateSort()},e.onSortBySize=function(){e.props.sortBySize(),e.props.onUpdateSort()},e.onSortByUpdated=function(){e.props.sortByUpdated(),e.props.onUpdateSort()},e.onWorkClick=function(t){e.props.onWorkClick(t,e.props.files.map(function(t){return t._id}))},e.onUpdateClick=function(t){e.props.onUpdateClick(t)},e.onBatchUpdateClick=function(){m.gta.event({action:"update content",type:"work",segment:"files list",category:"create"===e.props.section?"created":"follower",control:"batch"}),e.props.onUpdateClick(e.props.selections[0])},e.onBatchFavorite=function(){e.props.onBatchFavorite(e.props.selections)},e.onBatchUnfavorite=function(){e.props.onBatchUnfavorite(e.props.selections)},e.onBatchArchive=function(){e.props.onBatchArchive(e.props.selections)},e.onBatchCopy=function(){e.props.onBatchCopy(e.props.selections)},e.onBatchMove=function(){e.props.onBatchMove(e.props.selections)},e}return i.d(e,t),e.prototype.componentDidMount=function(){this.props.onChangeSection("create")},e.prototype.componentWillUnmount=function(){this.props.onUnmount()},e.prototype.renderPlaceholder=function(){return o.createElement("div",{className:"my-files-placeholder flex-vert"},o.createElement("div",{className:"my-files-placeholder-image"}),o.createElement("span",{className:"my-files-placeholder-hint"},s.get("my.files.placeholder")))},e.prototype.renderLoadMore=function(){return this.props.isLoading||0===this.props.files.length?null:o.createElement(d.LoadMore,{hasMore:this.props.hasMore,onEnter:this.props.onLoadMore,clause:!this.props.isLoadingMore})},e.prototype.renderHeader=function(){var t=l()({"is-active":"create"===this.props.section}),e=l()({"is-active":"involve"===this.props.section}),n=[o.createElement("li",{key:"created",className:t,onClick:this.onChangeSection("create")},s.get("my.tasks.tab.created")),o.createElement("li",{key:"joined",className:e,onClick:this.onChangeSection("involve")},s.get("my.tasks.tab.joined"))];return o.createElement("header",{className:"my-tab-header"},o.createElement("ul",{className:"my-header-tabs"},n))},e.prototype.renderFileHandler=function(){var t=this.props.getPermissions(this.props.selections);return o.createElement(h.a,i.a({},t,{viewMode:this.props.viewMode,onSwitchViewMode:this.props.onSwitchViewMode,sortMethod:this.props.sortMethod,asc:this.props.asc,selectCount:this.props.selections.length,selectFileCount:this.props.selectFileCount,selectCollectionCount:0,showCreator:"create"!==this.props.section,onSelectAll:a.noop,sortByName:this.onSortByName,sortBySize:this.onSortBySize,sortByUpdated:this.onSortByUpdated,onArchiveClick:this.onBatchArchive,onCopyClick:this.onBatchCopy,onDownloadClick:a.noop,onFavoriteClick:this.onBatchFavorite,onMoveClick:this.onBatchMove,onUnfavoriteClick:this.onBatchUnfavorite,onUpdateClick:this.onBatchUpdateClick}))},e.prototype.renderMainSection=function(){return this.props.isLoading?o.createElement(u.a,null):0===this.props.files.length?this.renderPlaceholder():o.createElement(y,{section:this.props.section,files:this.props.files,viewMode:this.props.viewMode,onComponentUnmount:this.props.onComponentUnmount,onDownloadWork:this.props.onDownloadWork,onModifyWork:this.props.onModifyWork,onMoveWork:this.props.onMoveWork,onOpenWorkClick:this.props.onOpenWorkClick,onOpenWorkMenu:this.props.onOpenWorkMenu,onSelect:this.props.onSelect,onWorkClick:this.onWorkClick,onUpdateClick:this.onUpdateClick})},e.prototype.render=function(){return o.createElement("div",{className:"my-files"},this.renderHeader(),this.renderFileHandler(),o.createElement("div",{className:"my-files-content"},this.renderMainSection(),this.renderLoadMore()))},e}(o.PureComponent),w=Object(r.connect)(function(t){var e=t.ui.myFiles,n=Object(g.getSelections)(e),o=Object(g.getSelectItems)(e),r=Object(p.getMyFileOrder)(t);return i.a({viewMode:t.preference.libraryMode},r,{section:e.section,files:Object(g.getFiles)(e),selections:n,selectFileCount:o.work.length,selectCollectionCount:o.collection.length,hasMore:e.hasMore,isLoadingMore:e.isLoadingMore,isLoading:e.isLoading})},b)(k)},"2NbHbpfv":function(t,e,n){var i,o,r,s;r=n("a+N5u/Cl"),s=n("yiO17FlF"),i=n("q1z7EYOi"),o=n("bZr3G77e"),t.exports=function(){function t(t){this.datas={},r.extend(this,i.Events),this.url="tasks/me",t.type&&(this.url=this.url+":"+t.type),this.nextPageToken=null,t=r.omit(t,"type"),this.setLoadData(t),this.listen()}return t.prototype.state=null,t.prototype.hasMoreTask=!0,t.prototype.listen=function(){var t,e,n,i,o;for(o=[],t=0,e=(i=["task"]).length;t<e;t++)n=i[t],this.listenTo(s,":change:"+n,function(t){var e;return e=t.toJSON(),this.doMerge(e),this.trigger("merge")}),this.listenTo(s,":destroy:"+n,function(t){return this.removeData(t.id),this.trigger("merge")}),o.push(this.listenTo(s,":new:"+n,function(t){var e;return e=t.toJSON(),this.doMerge(e),this.trigger("merge")}));return o},t.prototype.load=function(t){var e,n;if("loading"!==this.state)return this.datas={},this.setState("loading"),e=this.setLoadData(t||this.loadData),this.loadMyTask(e).then((n=this,function(t){return n.mergeDatas(t),n.setState("loaded")}))},t.prototype.loadMore=function(){var t,e,n;if("loading"!==(e=this.state)&&"loadingMore"!==e&&this.hasMore())return this.setState("loadingMore"),t=this.setLoadData(this.loadData),this.loadMyTask(t).then((n=this,function(t){return n.mergeDatas(t),n.setState("loaded")}))},t.prototype.loadMyTask=function(t){return this.hasMoreTask?this.doLoadMyTask(t).then((e=this,function(t){var n;return n=t.result,e.nextPageToken=t.nextPageToken,e.hasMoreTask=!!n.length&&e.nextPageToken,n})):[];var e},t.prototype.doLoadMyTask=function(t){return o.ajax(this.url,{data:t})},t.prototype.setLoadData=function(t){return this.loadData=r.extend(t,{pageToken:this.nextPageToken,pageSize:30}),this.loadData},t.prototype.mergeDatas=function(t){var e,n,i;for(n=0,i=t.length;n<i;n++)e=t[n],this.doMerge(e);return this.trigger("merge")},t.prototype.doMerge=function(t){var e,n,i;if(null!=t?t._id:void 0)return e=this.datas[t._id]||{},!(null!=(n=(i=r.extend({},e,t)).task)?n._id:void 0)&&e.task&&(i.task=e.task),this.datas[t._id]=i},t.prototype.removeData=function(t){return this.datas[t]=null,r.values(this.datas).forEach((e=this,function(n){var i;if((null!=n&&null!=(i=n.task)?i._id:void 0)===t)return e.datas[n._id]=null}));var e},t.prototype.setState=function(t){if(this.state!==t)return this.state=t,this.trigger("changeState",t)},t.prototype.getWorksByFilter=function(t){var e,n,i,o;for(n in o=[],i=this.datas)(e=i[n])&&!e.isArchived&&t(e)&&o.push(r.clone(e));return o},t.prototype.getById=function(t){return this.datas[t]},t.prototype.hasMore=function(){return this.hasMoreTask},t.prototype.remove=function(){return this.stopListening()},t}()},"2YhbCXuM":function(t,e){t.exports=function(t){return'<ul class="link-items-list"></ul><div class="link-column-loading"></div><p class="link-column-placeholder"> '+tb_i18n.get("object.picker.link.column.placeholder")+"</p>"}},"2kwr2b1U":function(t,e){t.exports=function(t){var e='<div class="tasklist-task-field-config-wrapper"> <p class="set-task-field-config-hint"> '+tb_i18n.get("tasklist.menu.set.default.taskFieldConfig.hint")+' </p> <ul class="task-field-config-list list thin-scroll"> ',n=t;if(n)for(var i,o=-1,r=n.length-1;o<r;)e+=' <li class="task-field-config" data-id="'+(i=n[o+=1])._id+'"> <svg class="field-config-icon" aria-hidden=\'true\'> <use xlink:href='+i.svgIcon+' /> </svg> <div class="name">'+i.name+'</div> <span class="icon icon-tick"></span> </li> ';return e+=' </ul> <button class="btn btn-primary confirm-task-field-config">'+tb_i18n.get("confirm")+"</button></div>"}},"39qKmnej":function(t,e){t.exports=function(t){var e,n,i="undefined"!=typeof _encodeHTML?_encodeHTML:(e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},n=/&(?!#?\w+;)|<|>|"|'|\//g,function(t){return t?t.toString().replace(n,function(t){return e[t]||t}):""}),o="";if(t.creators.length>0){o+=' <div class="panel-title"> <strong>'+tb_i18n.get("bookkeeping.home.fields.creator")+'</strong> </div> <ul class="list"> ';var r=t.creators;if(r)for(var s,a=-1,c=r.length-1;a<c;)o+=" ",(s=r[a+=1])._id&&(o+=' <li> <a class="member" data-id="'+s._id+'"> <div class="avatar img-circle img-24" style="background-image:url('+s.avatarUrl+');"></div> '+i(s.name)+' </a> <span class="icon icon-tick"></span> </li> '),o+=" ";o+=" </ul>"}return o}},"3RxqbJG2":function(t,e){t.exports=function(t){var e,n,i="undefined"!=typeof _encodeHTML?_encodeHTML:(e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},n=/&(?!#?\w+;)|<|>|"|'|\//g,function(t){return t?t.toString().replace(n,function(t){return e[t]||t}):""}),o="";if(t.tags.length>0){o+=' <div class="panel-title"> <strong>'+tb_i18n.get("bookkeeping.home.fields.tags")+'</strong> </div> <ul class="list"> ';var r=t.tags;if(r)for(var s,a=-1,c=r.length-1;a<c;)o+=' <li> <a class="tag" data-id="'+(s=r[a+=1])._id+'"> <span class="tag-label tag-label-'+s.color+'"></span> <span class="tag-name">'+i(s.name)+'</span> </a> <span class="icon icon-tick"></span> </li> ';o+=" </ul>"}return o}},"3xRTerdf":function(t,e,n){var i,o={}.hasOwnProperty;i=n("vmWJWrVe"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,i),e.prototype.viewName="DividerView",e.prototype.className="divider plugin-divider",e.prototype.tagName="li",e}()},"4Cw+wkJz":function(t,e){t.exports=function(t){return'<div class="settings-navigation"> <ul class="settings-switcher-set nav nav-tabs"> <li class="settings-switcher-wrap active"> <a class="settings-switcher" data-type="1">'+tb_i18n.get("bookkeeping.settings.income.tips")+'</a> </li> <li class="settings-switcher-wrap"> <a class="settings-switcher" data-type="-1">'+tb_i18n.get("bookkeeping.settings.expense.tips")+'</a> </li> </ul></div><div class="settings-input-wrap clearfix"> <a class="icon icon-plus-sign pull-left"></a> <input class="add-input form-control pull-left" placeholder="'+tb_i18n.get("entry.creator.other.add.placeholder")+'" /> <button class="btn btn-link link-add-handler pull-right">'+tb_i18n.get("create")+'</button></div><ul class="settings-list"></ul>'}},"4Yqmu9QS":function(t,e,n){var i,o={}.hasOwnProperty;i=n("GsAQlUN+"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,i),e.prototype.viewName="EventConfirmArchiveView",e.prototype.initialize=function(){var t,n,i;return e.__super__.initialize.apply(this,arguments),i=tb_i18n.get("archive"),n=tb_i18n.get("event.confirm.archive.description"),t=["current","next","all"],"danger",this.render({title:i,description:n,btns:t,color:"danger"})},e}()},"4djJg61A":function(t,e,n){var i,o,r,s,a,c,l,p,u,d,h,f,v,y,g,m,b,k,w={}.hasOwnProperty,_=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};b=n("a+N5u/Cl"),u=n("qHH6+g6Q"),g=n("3eMzznN/"),m=n("vmWJWrVe"),o=n("+ToXT53j"),c=n("OTplxZeS"),l=n("m+Dzs2wV"),v=n("PjENi0m4"),d=n("sBJ0DUAr"),h=n("EjqNFBXm"),f=n("schKCMXe"),p=n("ypWNgh6R"),i=n("JjUg/YRZ"),r=n("0dSR9rDm"),s=n("39qKmnej"),y=n("3RxqbJG2"),a=n("GESwhXbR").DatePicker,k=n("gh8QIhMV").throwError,t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)w.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,m),e.prototype.viewName="BookkeepingPanelView",e.prototype.tagName="div",e.prototype.className="bookkeeping-panel-view",e.prototype.events={"click .bookkeeping-panel-toggler":"hide","click a.bookkeeping-panel-settings-toggler":"toggleSettings","keyup .filter-query-input":"setQuery","click .tag":"setTagIds","click .member":"setCreatorId","click .category":"setCategoryId","click .filter-approved-handler":"toggleIsFilterApproved","click .filter-clear-handler":"resetFilter","click .bookkeeping-panel-settings-handler":"settingsHandler","mousewheel .scrollable":g.mousewheel},e.prototype.initialize=function(t){if(!t._projectId)throw new Error(this.viewName+":options should have _projectId");var n;return this.options=t,this._projectId=t._projectId,this._organizationId=t._organizationId,this.load().then((n=this,function(){return n.resetFilter().listen().renderBasic().renderCategories().renderCreators().renderTags().refreshStatus()})).catch(function(t){return k(t)}),b.delay(function(t){return function(){return t.layout()}}(this),100),e.__super__.initialize.apply(this,arguments)},e.prototype.load=function(){return Promise.all([new Promise((t=this,function(e,n){return o.fetch(t._projectId,{success:function(n){return t.bookkeepingModel=n.at(0),e()},error:n})})),new Promise(function(t){return function(e,n){return c.fetch(t._projectId,{success:function(n){return t.entriesCollection=n,e()},error:n})}}(this)),new Promise(function(t){return function(e,n){return l.fetch(t._projectId,{success:function(n){return t.entryCategoriesCollection=n,e()},error:n})}}(this)),new Promise(function(t){return function(e,n){return v.fetch(t._projectId,{success:function(n){return t.tagsCollection=n,e()},error:n})}}(this)),this.loadOrganizationTags()]);var t},e.prototype.loadOrganizationTags=function(){return this._organizationId?new Promise((t=this,function(e,n){return v.fetch(t._organizationId,{success:function(n){return t.organizationTagsCollection=n,e()},error:n})})):Promise.resolve();var t},e.prototype.resetFilter=function(){return this.filterModel||(this.filterModel=new u),this.filterModel.set({query:"",startDate:null,endDate:null,categoryId:"",tagIds:[],creatorId:"",isFilterApproved:!1}),this},e.prototype.listen=function(){var t;return this.listenTo(this.filterModel,"change",(t=this,function(){return t.refreshStatus(),t.filterEntries()})),this.listenTo(this.entriesCollection,"change:date change:content",function(t){return function(){return t.filterEntries(!0)}}(this)),this.listenTo(this.entriesCollection,"change:_entryCategoryId",function(t){return function(){return t.renderCategories(),t.refreshStatus(),t.filterEntries(!0)}}(this)),this.listenTo(this.entriesCollection,"change:tagIds",function(t){return function(){return t.renderTags(),t.refreshStatus(),t.filterEntries(!0)}}(this)),this.listenTo(this.entriesCollection,"add",function(t){return function(){return t.renderCategories(),t.renderTags(),t.renderCreators(),t.refreshStatus(),t.filterEntries(!0)}}(this)),this.listenTo(this.entriesCollection,"remove",function(t){return function(){return t.renderCategories(),t.renderTags(),t.renderCreators(),t.refreshStatus()}}(this)),this.listenTo(this.entryCategoriesCollection,"remove",function(t){return function(){return t.renderCategories()}}(this)),this},e.prototype.layout=function(){var t,e;return e=(t=$(window)).height()-this.$el.offset().top+t.scrollTop(),this.$el.css("height",e+"px"),this},e.prototype.renderBasic=function(){return this.$el.html(i({permissions:this.bookkeepingModel.hasPermissions("put.approvers","put.categories","put.fields")})),this.renderStartDatePicker(),this.renderEndDatePicker(),this.setupPlugins({_projectId:this._projectId}),this},e.prototype.renderCategories=function(){var t,e,n,i,o,s,a;for(t in s=[],o=!1,a=this.entriesCollection.getEntryCategoryIdsCount())n=a[t],e=this.entryCategoriesCollection.get(t),n>0&&e?s.push(e.toJSON()):n>0&&(o=!0);return o&&s.push(this.entryCategoriesCollection.getCategory().toJSON()),i={categories:s},this.$(".bookkeeping-panel-filter-categories").html(r(i)),this},e.prototype.renderCreators=function(){var t;return t={creators:this.entriesCollection.getCreators()},this.$(".bookkeeping-panel-filter-creators").html(s(t)),this},e.prototype.renderTags=function(){var t,e,n,i,o,r,s,a,c;for(o=[],r=this.entriesCollection.getTagIdsCount(),s=this.organizationTagsCollection?this.organizationTagsCollection.toJSON():[],n=0,i=(a=this.tagsCollection.toJSON().concat(s)).length;n<i;n++)(t=r[(c=a[n])._id])&&(c.count=t,o.push(c));return e={tags:o},this.$(".bookkeeping-panel-filter-tags").html(y(e)),this},e.prototype.refreshStatus=function(){var t,e,n,i,o,r,s;if(e=this.filterModel.toJSON(),this.$("input").val(e.query),this.renderStartDatePicker(),this.renderEndDatePicker(),this.$(".selected").removeClass("selected"),e.categoryId&&this.$(".category[data-id="+e.categoryId+"]").parent().addClass("selected"),e.tagIds.length)for(n=0,r=(s=e.tagIds).length;n<r;n++)i=s[n],this.$(".tag[data-id="+i+"]").parent().addClass("selected");return e.creatorId&&this.$(".member[data-id="+e.creatorId+"]").parent().addClass("selected"),t=this.$(".filter-clear-handler"),e.categoryId||e.tagIds.length||e.creatorId||e.query||e.startDate||e.endDate?t.addClass("active"):t.removeClass("active"),o=this.filterModel.get("isFilterApproved"),this.$(".filter-approved-handler")[o?"addClass":"removeClass"]("active"),this},e.prototype.renderStartDatePicker=function(){var t,e,n,i;return n=(e=this.filterModel.get("startDate"))?null!=(t=g.formatDate(e))?t.dateString:void 0:tb_i18n.get("bookkeeping.panel.filter.start.date"),this.requestReactView(this.$(".filter-start-date")[0],a,{date:e,endDate:this.filterModel.get("endDate"),displayText:n,nested:!1,timepicker:!1,placement:"bottomLeft",onChange:(i=this,function(t){var e;return e=t.date,i.filterModel.set("startDate",e)}),onClear:function(t){return function(){return t.filterModel.set("startDate",null)}}(this)})},e.prototype.renderEndDatePicker=function(){var t,e,n,i;return e=(t=this.filterModel.get("endDate"))?null!=(n=g.formatDate(t))?n.dateString:void 0:tb_i18n.get("bookkeeping.panel.filter.end.date"),this.requestReactView(this.$(".filter-end-date")[0],a,{date:t,startDate:this.filterModel.get("startDate"),displayText:e,nested:!1,timepicker:!1,placement:"bottom",onChange:(i=this,function(t){var e;return e=t.date,i.filterModel.set("endDate",e)}),onClear:function(t){return function(){return t.filterModel.set("endDate",null)}}(this)})},e.prototype.setQuery=function(t){var e;return e=$(t.currentTarget),this.filterModel.set("query",e.val()),this},e.prototype.setTagIds=function(t){var e,n;return e=$(t.currentTarget).data("id"),n=b.clone(this.filterModel.get("tagIds")),_.call(n,e)>=0?n=b.without(n,e):n.push(e),this.filterModel.set("tagIds",n),this},e.prototype.setCategoryId=function(t){var e;return e=$(t.currentTarget).data("id"),this.filterModel.get("categoryId")===e&&(e=""),this.filterModel.set("categoryId",e),this},e.prototype.setCreatorId=function(t){var e;return e=$(t.currentTarget).data("id"),this.filterModel.get("creatorId")===e&&(e=""),this.filterModel.set("creatorId",e),this},e.prototype.toggleIsFilterApproved=function(t){var e;return e=this.filterModel.get("isFilterApproved"),this.filterModel.set("isFilterApproved",!e),this},e.prototype.filterEntries=function(t){var e,n,i,o,r,s,a,c,l,p,u;if(t&&!this.filtering)return this;for(this.filtering=!1,s=this.filterModel.toJSON(),c=0,l=(i=this.entriesCollection.toJSON()).length;c<l;c++)o=i[c],e=this.parentView.$el.find(".entry-view[data-id="+o._id+"]"),a=!1,s.isFilterApproved&&"approved"===o.status&&(a=!0),!a&&s.startDate&&o.date&&(u=new Date(s.startDate).getTime(),new Date(o.date).getTime()<u&&(a=!0)),!a&&s.endDate&&o.date&&(n=new Date(s.endDate).getTime(),new Date(o.date).getTime()>n&&(a=!0)),!a&&s.creatorId&&s.creatorId!==o._creatorId&&(a=!0),!a&&s.categoryId&&this.entryCategoriesCollection.getCategory(o._entryCategoryId).toJSON()._id!==s.categoryId&&(a=!0),a||!s.tagIds.length||b.find(o.tagIds,function(t){return b.contains(s.tagIds,t)})||(a=!0),!a&&(p=s.query)&&(p=p.toLowerCase(),!g.matchString(o.note.toLowerCase(),p)&&!g.matchString(o.content.toLowerCase(),p)&&e.text().toLowerCase().indexOf(p)<0&&(a=!0)),e[a?"addClass":"removeClass"]("hide"),a&&(this.filtering=!0);return r=this.filtering?"filtering":"stopFilter",this.trigger(r),this},e.prototype.refilter=function(){return this.renderCategories(),this.renderTags(),this.renderCreators(),this.refreshStatus(),this.filterEntries(!0)},e.prototype.settingsHandler=function(t){switch($(t.currentTarget).data("type")){case"approve":return this.openSettingsApprover(t);case"displayFields":return this.openSettingsDisplayFields(t);case"category":return this.openSettingsCategory(t)}},e.prototype.openSettingsDisplayFields=function(t){return this.requestSubView(p,"bookkeeping-display-field").open(f,{bookkeepingModel:this.bookkeepingModel})},e.prototype.openSettingsApprover=function(t){return this.requestSubView(p,"bookkeeping-approver").open(d,{bookkeepingModel:this.bookkeepingModel})},e.prototype.openSettingsCategory=function(t){return this.requestSubView(p,"bookkeeping-category").open(h,{_projectId:this._projectId})},e.prototype.toggleSettings=function(){return this.$el.toggleClass("open"),this},e.prototype.hide=function(t){return this.$el.removeClass("panel-active"),this.trigger("hide"),!1},e.prototype.show=function(t){return this.$el.addClass("panel-active"),this.trigger("show"),!1},e.prototype.toggle=function(t){return this.$el.hasClass("panel-active")?this.hide():this.show(),!1},e.prototype.remove=function(){return this.resetFilter(),e.__super__.remove.apply(this,arguments)},e}()},"5S+Vx6yD":function(t,e){t.exports=function(t){return'<div class="task-placeholder placeholder muted"> <span class="icon icon-board"></span> <br /> '+tb_i18n.get("task.placeholder")+"</div>"}},"6FlLi7Do":function(t,e){t.exports=function(t){var e='<ul class="list entry-menu-list"> ';return t.approveRight&&(e+=" <li> ","confirmed"==t.status?e+=' <a class="approve-entry-handler" data-gta="event" data-label="bkp menu approve"> <span class="icon icon-share"></span>'+tb_i18n.get("entry.menu.action.approve")+" </a> ":e+=' <a class="revoke-entry-handler" data-gta="event" data-label="bkp menu revoke"> <span class="icon icon-repeat"></span>'+tb_i18n.get("entry.menu.action.revoke")+" </a> ",e+=" </li> "),e+=" ",t.permissions.put&&(e+=' <li> <a class="edit-entry-handler" data-gta="event" data-label="bkp menu edit"> <span class="icon icon-pencil"></span>'+tb_i18n.get("entry.menu.action.edit")+" </a> </li> "),e+=' <li> <a class="favorite-entry-handler" data-gta="event" data-label="entry detail|favorite entry"> <span class="icon icon-favorite ',t.isFavorite&&(e+="favorited"),e+='"></span>',t.isFavorite?e+=""+tb_i18n.get("unfavorite"):e+=""+tb_i18n.get("favorite")+tb_i18n.get("bookkeeping"),e+=" </a> </li> ",t.permissions.putArchive&&(e+=" ",t.isArchived?e+=' <li> <a class="unarchive-entry-handler" data-gta="event" data-label="bkp detail|unarchive bkp"> <span class="icon icon-archive"></span>'+tb_i18n.get("unarchive")+" </a> </li> ":e+=' <li> <a class="archive-entry-handler" data-gta="event" data-label="bkp menu archive"> <span class="icon icon-trash"></span>'+tb_i18n.get("archive")+" </a> </li> ",e+=" "),e+=" ",t.canModifyVisibility&&(e+=' <li class="divider"></li> <li> <a class="switch-visible-handler"></a> </li> '),e+="</ul>"}},"6IrxsRwM":function(t,e,n){var i,o,r,s,a,c,l={}.hasOwnProperty;a=n("a+N5u/Cl"),c=n("sa1Ed382"),s=n("6XSa3ffj"),r=n("9aPZbVuc"),o=n("xa0Lr1Lz"),i=n("cNNGxnSV"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)l.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,s),e.prototype.viewName="CollectionMenuView",e.prototype.popoverTitle="",e.prototype.events={"click .color":"changeColor","click .move-collection-handler":"moveCollection","click .fork-collection-handler":"forkCollection","click .archive-collection-handler":"enterArchiveSubMenu","click .change-collection-visibility-handler":"changeCollectionVisibility","submit .collection-archive-form":"submitArchive"},e.prototype.initialize=function(t){return this.inGridView=t.inGridView,this.collectionModel=t.collectionModel,this.onArchiveClick=t.onArchiveClick,this.onRemoveClick=t.onRemoveClick,this.modifyCollection=t.modifyCollection,this.onMoveClick=t.onMoveClick,this.onForkClick=t.onForkClick,this.onVisibilityEditClick=t.onVisibilityEditClick,this.popoverTitle=tb_i18n.get("collection.menu.title"),e.__super__.initialize.apply(this,arguments)},e.prototype.render=function(){var t,e,n,i;return n=this.collectionModel.toJSON(),i=c.config.HOST+"/project/"+n._projectId+"/works/"+n._id,e="gray"===n.color?"cyan":n.color,n=a.extend(n,{color:e,permissions:this.collectionModel.hasPermissions("put","put.archive","put.move","put.fork","put.visible"),inGridView:this.inGridView,objectLinkUrl:i}),c.user.id===n._creatorId&&(n.permissions.putVisible=!0),this.$el.html(o(n)),t=n._projectId,this.setupPlugins({_projectId:t}),r.initCopyLinkHandler(this.$(".copy-object-link-handler"),{type:"folder",control:"More Menu"}),this},e.prototype.changeColor=function(t){var e,n;return e={color:$(t.currentTarget).data("color")},this.modifyCollection(e).then((n=this,function(){return n.render()}))},e.prototype.moveCollection=function(){return this.onMoveClick(),this.hide()},e.prototype.forkCollection=function(){return this.onForkClick(),this.hide()},e.prototype.enterArchiveSubMenu=function(){return this.enterSubMenu(tb_i18n.get("archive"),(t=this,function(){return t.$el.html(i())}));var t},e.prototype.changeCollectionVisibility=function(){return"function"==typeof this.onVisibilityEditClick&&this.onVisibilityEditClick(),this.hide()},e.prototype.submitArchive=function(t){return t.preventDefault(),this.onArchiveClick()},e}()},"6T6NA009":function(t,e,n){var i,o,r,s={}.hasOwnProperty;r=n("sa1Ed382"),o=n("7gS+SwzT"),i=n("C5OQKKhx"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,o),e.prototype.container=".my-tab-wrap",e.prototype.pluginType="app_for_me",e.prototype.createPlugin=function(t){return this.requestSubView(i,{view:this.view,pluginModel:t,data:r.user.toJSON()})},e.prototype.checkPluginIsEnabled=function(){return!0},e}()},"6VSOqmo8":function(t,e,n){var i,o;o=n("bZr3G77e"),i=n("IssmDVnT").EventSDK,t.exports={getMyEvents:function(t){var e;return e=Object.assign({count:100},t),new Promise(function(t,n){return o.get("events/me",e,{headers:{"x-timezone":o.timezone()},success:function(e){if(Array.isArray(e))return t(e.map(i.marshaler.parse))},error:n})})},getEventGroups:function(t){var e;return e=Object.assign({},t),new Promise(function(t,n){return o.get("events/me/count/group-by",e,{headers:{"x-timezone":o.timezone()},success:t,error:n})})}}},"6kdBHtJD":function(t,e,n){var i,o,r,s,a,c,l,p,u,d,h,f,v,y,g,m,b,k,w,_,M={}.hasOwnProperty;g=n("a+N5u/Cl"),_=n("sa1Ed382"),u=n("GESwhXbR").Toast,k=n("RLD3BeS/"),d=k.ToastMessageWithUrl,h=k.ToastWithObject,m=n("2qRnoGmE"),a=n("HDJEOtNh").OrganizationAccess,c=n("6XSa3ffj"),l=n("RFllHK7R"),v=n("OmupbwLD"),y=n("ZiyDPH8B"),o=n("TfBVyIQA"),i=n("THzQ0rgs"),f=n("+h7VEZku").VisibilityController,p=n("H72dUcNY").ProjectSelectorWithHint,w=n("RTj5z5YX"),r=w.CommonShare,s=w.InviteLink,b=w.isReadonlyShare,t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)M.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,c),e.prototype.viewName="PostMenuView",e.prototype.popoverTitle="",e.prototype.events={"click .edit-handler":"openPostCreator","click .pin-handler":"pinPost","click .copy-handler":"copyPost","click .move-handler":"movePost","click .favorite-post-handler":"favoritePost","click .share-post-handler":"sharePost","click .archive-handler":"enterArchiveSubMenu","click .unarchive-handler":"unarchivePost","submit .archive-form":"submitArchive","click .invite-handler":"enterInviteSubMenu"},e.prototype.initialize=function(t){return this.projectModel=t.projectModel,this.postModel=t.postModel,this.refer=t.refer,this.postUrl=t.postUrl,this._organizationId=t._organizationId,this._projectId=this.postModel.get("_projectId"),this.popoverTitle=tb_i18n.get("post.menu.title"),this.listen(),e.__super__.initialize.apply(this,arguments)},e.prototype.listen=function(){return this.listenTo(this.postModel,"change:visible",this.renderVisible)},e.prototype.render=function(){var t,e,n,i,r,s,c,l;return this.unmountReactViews(),m.HOST,n=this.postModel,c="teambition"===(l=n.pick("source","visible")).source,l.visible,s=n.getRoleScope()>=0,r=n.canModifyVisibility(),t={editHandler:(i=function(t){return s&&n.hasPermission(t)})("put"),pinHandler:i("put.pin"),copyHandler:c&&s,moveHandler:i("put.move")&&c,shareHandler:m.FEATURES.thirdShare,archiveHandler:i("put.archive"),switchVisibleHandler:r&&s},e=g.extend(this.postModel.toJSON(),{conditionalRender:t,postUrl:this.postUrl,refer:this.postModel.get("source"),isShared:b(this.postModel.get("shareStatus")),showInviteLink:this.projectModel.hasPermission("post.member")&&Boolean(this._organizationId&&a.canAddOuterMember(this._organizationId))}),this.$el.html(o(e)),this.$visibleSwitchers=this.$(".switch-visible-handler"),this.renderVisible(),this.setupPlugins({_projectId:this._projectId}),this},e.prototype.renderVisible=function(){var t;if(t=this.postModel.getRoleScope()>=0,this.postModel.canModifyVisibility()&&t)return this.requestReactView(this.$visibleSwitchers.get(0),f,{visibility:this.postModel.get("visible"),onChange:this.switchVisible.bind(this)})},e.prototype.openPostCreator=function(t){var e,n,i,o;return this.postModel.get("_id"),this.postModel.get("title"),e=(o=$(t.target)).data("postRefer"),n=o.data("postUrl"),this.hide(),i=m.SHIMO_HOST+"/sso/login/teambition?callback="+encodeURIComponent(n)+"&providerUser="+_.user.get("_id"),"shimo"===e?window.open(i):(this.requestSubView(v).open(l,{_projectId:this.postModel.get("_projectId"),backdrop:"static",postModel:this.postModel}),_.gta.event({action:"edit content",control:"More Menu",type:"post"}),this)},e.prototype.pinPost=function(){var t;return t=this.postModel.get("pin"),this.postModel.set("pin",!t),t?this.postModel.unpin():this.postModel.pin(),_.gta.event({action:"pin to the top",control:"More Menu",type:"post",category:t?"off":"on"}),this.render(),this.hide(),this},e.prototype.copyPost=function(){return this.enterCopyOrMoveSubMenu("fork"),_.gta.event({action:"add content",control:"More Menu",type:"post"})},e.prototype.movePost=function(){return this.enterCopyOrMoveSubMenu("move"),_.gta.event({action:"move content",control:"More Menu",type:"post"})},e.prototype.enterCopyOrMoveSubMenu=function(t){var e,n;if(this.checkPostAttachments(t)){switch(t){case"fork":n=tb_i18n.get("fork.to.other.project"),e=tb_i18n.get("post.menu.fork.global.hint");break;case"move":n=tb_i18n.get("move.to.other.project"),e=tb_i18n.get("post.menu.move.global.hint")}return this.enterSubMenu(n,(i=this,function(){return i.requestReactView(i.el,p,{_organizationId:i._organizationId,hideIndieEntry:!0,excludes:"move"===t?[i._projectId]:void 0,classNames:"fork-move-project-list in-post-menu",objectType:"posts",permission:"post.post",hint:e,hintStyle:{margin:"15px 0 -5px"},onConfirm:function(e){return i.copyOrMoveCallback(e.id,t)},containerHeight:i.flexStaticMaxHeight})}));var i}},e.prototype.checkPostAttachments=function(t){var e,n;return"move"!==t||(null==(e=this.postModel.get("attachments"))||!e.length||((n=new y(e).every(function(t){var e,n,i;return e=(null!=(i=t.get("involveMembers"))?i.indexOf(_.user.id):void 0)>-1,n="members"===t.get("visible"),e||n}))||u.error({message:tb_i18n.get("post.menu.move.error.title"),description:tb_i18n.get("post.menu.move.error.hint")}),n))},e.prototype.copyOrMoveCallback=function(t,e){var n,i;return n=this._projectId,this.postModel.forkOrMove(e,t,{success:(i=this,function(t){var o,r;return r=function(){switch(e){case"fork":return tb_i18n.get("post.menu.fork.success");case"move":return tb_i18n.get("post.menu.move.success")}}(),d.success({messageTitle:r,url:"/project/"+t._projectId+"/posts/post/"+t._id,urlTitle:i.postModel.get("title")}),i.hide(),"move"===e&&_.router.navigate("project/"+n+"/posts",{trigger:!0}),o="fork"===e?"added content":"moved content",_.gta.event({action:o,control:"More Menu",type:"post"})}),error:function(){var t;return t=function(){switch(e){case"fork":return tb_i18n.get("post.menu.fork.fail");case"move":return tb_i18n.get("post.menu.move.fail")}}(),u.error(t)}})},e.prototype.enterArchiveSubMenu=function(){var t;return _.gta.event({action:"archive content",control:"More Menu",type:"post"}),this.enterSubMenu(tb_i18n.get("archive"),(t=this,function(){return t.$el.html(i())})),this},e.prototype.submitArchive=function(t){var e;return t.preventDefault(),this.postModel.archive({success:(e=this,function(){return h.archive(),e.hide()})}),this},e.prototype.unarchivePost=function(){var t;return this.postModel.unarchive({success:(t=this,function(){return h.unarchive(t.postModel),t.hide()})}),this},e.prototype.favoritePost=function(){var t,e;return t=this.postModel.get("isFavorite"),this.postModel[t?"unFavorite":"doFavorite"]({success:(e=this,function(n){return e.postModel.set("isFavorite",n.isFavorite),e.render(),_.gta.event({action:"favourite content",control:"More Menu",type:"event",category:t?"off":"on"})})}),this},e.prototype.sharePost=function(){var t;return _.gta.event({action:"share content",control:"More Menu",type:"post"}),this.enterSubMenu(tb_i18n.get("share.via.wechat"),(t=this,function(){return t.requestReactView(t.el,r,{objectType:"post",model:t.postModel})})),_.gta.event({action:"share content",control:"More Menu",type:"post"}),this},e.prototype.enterInviteSubMenu=function(){var t;return _.gta.event({action:"invite project member",control:"More Menu",type:"post"}),this.enterSubMenu(tb_i18n.get("invite.from.link"),(t=this,function(){return t.requestReactView(t.el,s,{objectType:"post",objectId:t.postModel.id})})),this},e.prototype.switchVisible=function(t){return this.postModel.saveAttr("visible",t),_.gta.event({action:"toggle visible",type:"post",control:"More Menu",category:"involves"===t?"on":"off"})},e.prototype.remove=function(){var t;return"ObjectModalView"===(null!=(t=this.parentView)?t.viewName:void 0)&&this.parentView.remove(),e.__super__.remove.apply(this,arguments)},e.prototype.returnMainMenu=function(){return this.unmountReact(this.el),e.__super__.returnMainMenu.apply(this,arguments)},e.prototype.unmountReactViews=function(){if(this.$visibleSwitchers&&this.unmountReact(this.$visibleSwitchers.get(0)),this.el)return this.unmountReact(this.el)},e.prototype.onHidden=function(){return this.unmountReactViews(),e.__super__.onHidden.apply(this,arguments)},e}()},"7+ovutzo":function(t,e,n){var i,o,r,s,a,c,l,p,u,d,h,f,v,y,g,m,b,k,w={}.hasOwnProperty;g=n("a+N5u/Cl"),b=n("sa1Ed382"),p=n("wu4EEviu"),u=n("HYobN8SQ"),f=n("3eMzznN/"),v=n("vmWJWrVe"),m=n("GESwhXbR"),h=m.Toast,o=m.DatePicker,s=n("BVXu+viu"),l=n("77NnVLwu"),r=n("m+Dzs2wV"),c=n("qKYkuTVR"),d=n("NwOfh+fP"),a=n("vNWLjLJF"),i=n("DvVVbUsU"),y=n("+h7VEZku").VisibilityController,k=n("gh8QIhMV").throwError,t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)w.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,v),e.prototype.viewName="EntryCreatorView",e.prototype.tagName="div",e.prototype.className="entry-creator-view fade",e.prototype.events={"click .entry-category-option":"categoryHandler","click .submit-handler":"submit","change input, blur textarea":"parseEntry"},e.prototype.initialize=function(t){if(!((null!=t?t._projectId:void 0)||t._entryId&&t.type))throw new Error(this.viewName+":wrong options");var n;return this.options=t,this.isEdit=Boolean(this.options._entryId),this.type=t.type||1,this._projectId=t._projectId,this.localCache=u.namespace("temp").namespace("entry_creator"),this.localCacheId=t._projectId+"_"+b.user.id+"_"+this.type,this.render(),g.delay((n=this,function(){return n.$el.addClass("in")}),100),e.__super__.initialize.apply(this,arguments)},e.prototype.render=function(){return this.load().then((t=this,function(){return t.reset(),t.listen(),t.renderBasic(),t.renderCategory(),t.renderVisible(),t.initCategoryPicker(),t.initInvolve(),t.initTagPicker()})).catch(function(t){return k(t)});var t},e.prototype.load=function(t){return new Promise((e=this,function(t,n){if(e.isEdit)return s.fetch(e.options._entryId,{success:function(n){return e.entryModel=n,e._projectId=e.entryModel.get("_projectId"),t()},error:n});t()})).then(function(t){return function(){return new Promise(function(e,n){return r.fetch(t._projectId,{success:function(n){return t.entryCategoriesCollection=n,e()},error:n})})}}(this)).then(function(t){return function(){return new Promise(function(e,n){return l.fetch(t._projectId,{success:function(n){return t.projectModel=n,e()},error:n})})}}(this));var e},e.prototype.reset=function(){var t,e;return this.model&&this.stopListening(this.model),this.isEdit?this.model=this.entryModel.clone():(e=this.localCache(this.localCacheId)||{},t=g.extend({type:this.type,_projectId:this._projectId,_boundToObjectId:this._projectId,_entryCategoryId:this.entryCategoriesCollection.getDefaultId(this.type),content:"",amount:"",date:new Date,note:"",involveMembers:[b.user.id],tagsId:[],visible:"members"},e),this.model=new s(t)),this},e.prototype.listen=function(){return this.listenTo(this.model,"change:_entryCategoryId",this.renderCategory),this.listenTo(this.model,"change:date",this.renderDatePicker),this.listenTo(this.model,"change:visible",this.renderVisible),this.listenTo(this.model,"change",this.cacheEntry)},e.prototype.renderBasic=function(){var t;return!0,(t=this.model.toJSON()).defaultCategories=this.entryCategoriesCollection.getCategories(this.type,!0),t.isEdit=this.isEdit,this.$el.html(i(t)),this.$el.find(".entry-note-input").flexText(),this.$submit=this.$el.find(".submit-handler"),this.$category=this.$el.find(".entry-category"),this.$amountInput=this.$el.find(".entry-amount-input"),this.$contentInput=this.$el.find(".entry-content-input"),this.$noteInput=this.$el.find(".entry-note-input"),this.$visibleSwitchers=this.$el.find(".creator-visible"),this.$datePicker=this.$(".entry-date"),this.renderDatePicker(),this},e.prototype.renderCategory=function(){var t,e,n,i;return t=this.model.get("_entryCategoryId"),(e=null!=(i=this.entryCategoriesCollection.get(t))?i.toJSON():void 0)&&(this.$category.find(".active").removeClass("active"),n=e.icon?e.icon:"other",this.$category.find("[data-icon="+n+"]").addClass("active")),this},e.prototype.renderVisible=function(){return this.requestReactView(this.$visibleSwitchers.get(0),y,{visibility:this.model.get("visible"),onChange:this.switchVisible.bind(this)})},e.prototype.initCategoryPicker=function(){var t;return!1,this.typePickerView=this.requestSubView(c,{$toggler:this.$(".entry-category-option.other"),width:240,addPlaceholder:tb_i18n.get("entry.creator.other.add.placeholder"),dataList:this.entryCategoriesCollection.getCategories(this.type,!1),selected:this.model.get("_entryCategoryId"),select:(t=this,function(e){return t.model.set("_entryCategoryId",e)}),add:function(t){return function(e){return t.entryCategoriesCollection.create({title:e,type:t.type,_projectId:t._projectId},{wait:!0,success:function(e){return t.model.set("_entryCategoryId",e.id),t.typePickerView.update(t.entryCategoriesCollection.getCategories(t.type,!1),t.model.get("_entryCategoryId"))}})}}(this)}),this},e.prototype.initInvolve=function(){var t;return this.involveView=this.requestSubView(a,{_projectId:this._projectId,objectModel:this.model,dropArea:this.$el,undeletable:!1,resident:[b.user.id],where:"creator",enableInvite:(null!=(t=this.projectModel)?t.hasPermission("post.member"):void 0)||!1}),this.involveView.$el.prependTo(this.$(".entry-involve-set")),this},e.prototype.initTagPicker=function(){return this.tagPickerView=this.requestSubView(d,{_projectId:this._projectId,objectModel:this.model,withIcon:!0}),this.tagPickerView.$el.prependTo(this.$(".tag-picker-wrapper")),this},e.prototype.categoryHandler=function(t){var e,n,i;if(n=(e=$(t.currentTarget)).data("id"),i=e.data("icon"),n&&"other"!==i)return this.model.set("_entryCategoryId",n)},e.prototype.renderDatePicker=function(){var t,e,n,i;return e=this.model.get("date"),n=f.formatDate(e).dateString,this.requestReactView(this.$datePicker[0],o,{date:"function"==typeof(t=this.model.get("date")).toISOString?t.toISOString():void 0,timepicker:!1,clearable:!1,displayText:"<label class='entry-date-label btn btn-default form-control-select' data-gta='event' data-label='bkp creator date' > "+n+" </label>",onChange:(i=this,function(t){var e;return e=t.date,i.model.set("date",e)})})},e.prototype.parseEntry=function(t){var e,n,i,o,r;return o=[],r=!1,(i=this.$contentInput.val().trim())||(r=!0,o.push("entry-content-input")),(e=+this.$amountInput.val().trim())>0&&/^\d+(\.\d{0,2})?$/.test(e)||(r=!0,o.push("entry-amount-input")),n={content:i,amount:e>=0?e:"",note:this.$noteInput.val().trim()},this.model.set(n),r?o:null},e.prototype.switchVisible=function(t){return this.model.set({visible:t})},e.prototype.updateVisible=function(t){return this.entryModel.saveAttr("visible",t)},e.prototype.submit=function(t){var e,n,i,o,r,s;if(null!=t&&t.preventDefault(),!this.$submit.prop("disabled")){var a;if("validate-error",this.$(".validate-error").removeClass("validate-error"),!(i=this.parseEntry()))return this.disableSubmit(),e=this.model.toJSON(),this.isEdit&&(this.entryModel.set(e),(n=this.entryModel.changed).visible&&(this.updateVisible(n.visible),1===Object.keys(n).length))?this.close():this.model.save(null,{attrs:this.isEdit?n:e,wait:!0,error:(a=this,function(t,e){return a.enableSubmit(),h.error(e)}),success:function(t){return function(e){return t.isEdit||t.localCache.remove(t.localCacheId),t.close(),p.trigger(":new:"+e.urlRoot+"/"+e.get("_projectId"),e.toJSON())}}(this)});for(o=0,s=i.length;o<s;o++)r=i[o],this.$("."+r).addClass("validate-error");this.$(".validate-error").first().focusAtEnd()}},e.prototype.disableSubmit=function(){return this.$submit.attr("disabled","disabled")},e.prototype.enableSubmit=function(){return this.$submit.removeAttr("disabled")},e.prototype.cacheEntry=function(){var t;return t=this.model.toJSON(),this.localCache(this.localCacheId,t),this},e.prototype.close=function(){var t;return null!=(t=this.parentView)&&t.remove(),this},e}()},"7fdVgQwj":function(t,e,n){var i,o,r,s,a,c,l,p,u={}.hasOwnProperty;p=n("sa1Ed382"),r=n("GESwhXbR").Toast,s=n("XbrdCDrd"),o=n("pbzP9iSs"),i=n("R81d6RG8").PLUGIN_URL,a=n("RUL1qgth").getAppNameByTargetUrl,c=n("WMI0/nUp").getPluginId,l=function(t){var e;return"teambition://",e="teambition://".length,t.slice(e)},t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,s),e.prototype.viewName="ProjectTabPluginView",e.prototype.className="menu-plugin",e.prototype.tagName="li",e.prototype.events={"click a.plugin-handler":"onPluginClick"},e.prototype.initialize=function(t){var n;return this.nativePluginConfig=t.nativePluginConfig,e.__super__.initialize.apply(this,arguments),this.listenTo(this.pluginModel,"remove",(n=this,function(){return n._destroy()})),this.listenTo(this.pluginModel,"change",function(t){return function(){if(!t.pluginModel.isEnabled())return t._destroy()}}(this))},e.prototype.render=function(){var t,e,n,i,r,s,a;if(t=(i=this.getAppNameAndPluginId()).appName,n=i.pluginId,e=(null!=(r=this.nativePluginConfig)?r.html:void 0)?null!=(s=this.nativePluginConfig)?s.html:void 0:o(Object.assign({},this.pluginModel.toJSON(),{appName:t,projectId:null!=(a=this.data)?a._id:void 0})),this.$el.html(e),this.isActive({appName:t,pluginId:n}))return this.$el.addClass("active")},e.prototype.getAppNameAndPluginId=function(){var t,e,n;return t=(e=this.pluginModel.pick("mode","url")).mode,n=e.url,{appName:"native"===t&&l(n)||i,pluginId:this.pluginModel.getPluginId()}},e.prototype.isActive=function(t){var e,n,o,r,s;return e=t.appName,o=t.pluginId,!(null==(r=this.$el)||!r.hasClass("active"))||(s=p.router.getUrl(),(n=a(s))!==i?e===n:s.indexOf(o)>=0)},e.prototype.onPluginClick=function(){return this.handle(this.pluginModel.toJSON(),this.data)},e.prototype.handleIframe=function(t,e,n){var o,r;return o=c(e),r="project/"+n._id+"/"+i+"/"+o,p.router.navigate(r,{trigger:!0}),this.view.refreshAppActive()},e.prototype._destroy=function(){var t,e,n;return this.isActive(this.getAppNameAndPluginId())&&(r.info(tb_i18n.get("project.app.plugin.remove.essage")),t="projects",(e=null!=(n=this.data)?n._id:void 0)&&(t="project/"+e),p.router.navigate(t,{trigger:!0,replace:!0})),this.remove()},e}()},"7gS+SwzT":function(t,e,n){var i,o,r,s,a={}.hasOwnProperty,c=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};r=n("a+N5u/Cl"),o=n("vmWJWrVe"),s=n("gh8QIhMV").throwError,i=n("//SEpMEE"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,o),e.prototype.container=".list",e.prototype.pluginType="",e.prototype.initialize=function(t){return this.view=t.view,this.collection=t.collection,this._pluginStore={},this.listen(this.collection),this.render()},e.prototype.listen=function(t){return this.listenTo(t,"add",this.renderPlugin),this.listenTo(t,"remove",this.removePlugin),this.listenTo(t,"change",this.checkPlugin)},e.prototype.render=function(){var t,e;return t=this.collection.models.filter((e=this,function(t){return e.shouldShowPlugin(t)})),this.getOrderedPlugins(t).forEach(function(t){return function(e){return t.renderPlugin(e)}}(this))},e.prototype.getOrderedPlugins=function(t){var e,n,o,s,a;return s=i.getScrumAppNames(),e=(o=r.partition(t,function(t){var e;return e=t.get("_appName"),c.call(s,e)>=0&&0===t.get("order")}))[0],n=o[1],e.length?(a=i.getScrumApps(),r.sortBy(e,function(t){var e;return null!=(e=a.find(function(e){return e.name===t.get("_appName")}))?e.order:void 0}).concat(n)):t},e.prototype.renderPlugin=function(t){var e;return e=this.createPlugin(t),this.afterRenderPlugin(t,e)},e.prototype.createPlugin=function(t){return s("This method must be override")},e.prototype.afterRenderPlugin=function(t,e){return this.view.$el.find(this.container).append(e.$el),this.saveNail(t,e)},e.prototype.removePlugin=function(t){var e;return null!=(e=this.findNail(t))&&e.remove(),this._pluginStore[t.id]=null},e.prototype.checkPlugin=function(t){return this.shouldShowPlugin(t)?this.findNail(t)?void 0:this.renderPlugin(t):this.removePlugin(t)},e.prototype.saveNail=function(t,e){return this._pluginStore[t.id]=e},e.prototype.findNail=function(t){return this._pluginStore[t.id]},e.prototype.getPluginModels=function(){return this.collection.models.filter(this.shouldShowPlugin.bind(this))},e.prototype.shouldShowPlugin=function(t){return this.checkPluginIsEnabled(t)&&this.checkPluginType(t)},e.prototype.checkPluginType=function(t){return!this.pluginType||t.get("type")===this.pluginType},e.prototype.checkPluginIsEnabled=function(t){return 1===t.get("status")},e}()},"9558JHAV":function(t,e,n){var i,o,r,s,a,c,l;r=n("a+N5u/Cl"),o=n("wd/RKGTj"),c=n("zsrTy1Hg"),a="todo",l="priority",s="undone",i=function(){function t(){}return t.prototype.getTypeSortKey=function(){return{todo:"myTaskExecuteSort",created:"myTaskCreatedSort",joined:"myTaskInvolvesSort"}[a]},t.prototype.getFilterType=function(){return a},t.prototype.isTodoFilterType=function(){return"todo"===a},t.prototype.setFilterType=function(t){return a=t,this.setDoneType("undone")},t.prototype.getFilterList=function(){var t,e,n,i,o;for(o=[],t=0,n=(i=["todo","created","joined"]).length;t<n;t++)e=i[t],o.push({_id:e,title:this.getFilterTitle(e)});return o},t.prototype.getFilterTitle=function(t){switch(t||(t=this.getFilterType()),t){case"todo":return tb_i18n.get("my.tasks.tab.todo");case"joined":return tb_i18n.get("my.tasks.tab.joined");case"created":return tb_i18n.get("my.tasks.tab.created")}},t.prototype.getFilterGta=function(t){switch(t||(t=this.getFilterType()),t){case"todo":return"assignee";case"joined":return"follower";case"created":return"created"}},t.prototype.getDoneType=function(){return s},t.prototype.isDoneType=function(){return"done"===s},t.prototype.setDoneType=function(t){return s=t},t.prototype.getDoneList=function(){var t,e,n,i,o;for(o=[],t=0,n=(i=["undone","done"]).length;t<n;t++)e=i[t],o.push({_id:e,title:this.getDoneTitle(e)});return o},t.prototype.getDoneTitle=function(t){switch(t||(t=this.getDoneType()),t){case"done":return tb_i18n.get("my.task.doneType");case"undone":return tb_i18n.get("my.task.undoneType")}},t.prototype.getDoneTypeGta=function(t){switch(t||(t=this.getDoneType()),t){case"done":return"finished";case"undone":return"unfinished"}},t.prototype.getSortType=function(){return l},t.prototype.isSortByProject=function(){return"project"===l},t.prototype.setSortType=function(t){return l=t},t.prototype.getSortList=function(){var t,e,n,i,o;for(i=[],o=["priority","dueDate","created"],"todo"===a&&o.push("project"),t=0,n=o.length;t<n;t++)e=o[t],i.push({_id:e,title:this.getSortTitle(e)});return i},t.prototype.getSortTitle=function(t){switch(t||(t=this.getSortType()),t){case"priority":return tb_i18n.get("my.task.sortByPriorityType");case"dueDate":return tb_i18n.get("my.task.sortByDueDate");case"created":return tb_i18n.get("my.task.sortByCreateDate");case"project":return tb_i18n.get("my.task.sortByProject")}},t.prototype.sortTask=function(t){return this.isDoneType()?this.sortByDoneDate(t):(this.getFilterType(),this.sortBySortType(t))},t.prototype.sortBySortType=function(t){switch(l=this.getSortType()){case"priority":case"project":return this.sortByPriority(t);case"dueDate":return this.sortByDueDate(t);case"createDate":return this.sortByCreateDate(t);default:return t}},t.prototype.sortByPriority=function(t){return t.sort(c(function(t){return t.priority?-t.priority:Number.MIN_VALUE}).thenBy((e=this,function(t){return t.dueDate?e.getSortDate(t.dueDate):Number.MAX_VALUE})).thenBy(function(t){return function(e){return e.startDate?t.getSortDate(e.startDate):Number.MAX_VALUE}}(this)).thenBy(function(t){return-new Date(t.created)}));var e},t.prototype.sortByDueDate=function(t){return t.sort(c((e=this,function(t){return t.dueDate?e.getSortDate(t.dueDate):Number.MAX_VALUE})).thenBy(function(t){return t.priority?-t.priority:Number.MIN_VALUE}).thenBy(function(t){return function(e){return e.startDate?t.getSortDate(e.startDate):Number.MAX_VALUE}}(this)).thenBy(function(t){return-new Date(t.created)}));var e},t.prototype.sortByCreateDate=function(t){return t.sort(c(function(t){return-new Date(t.created)}))},t.prototype.sortByDoneDate=function(t){return t.sort(c(function(t){return t.accomplished?-new Date(t.accomplished):Number.MAX_VALUE}))},t.prototype.getSortDate=function(t,e){var n;return n=o(t).startOf("minute").toISOString(),e?-new Date(n):+new Date(n)},t.prototype.getProjects=function(t){var e,n,i,o,s,a,c,l;for(a={},n={_id:"indie",count:0},e=0,i=(t=this.sortByDueDate(t)).length;e<i;e++)(s=(l=t[e])._projectId)?(a[s]||(a[s]=r.clone(l.project)||{}),o=a[s]):o=n,o.count||(o.count=0),o.count++;return c=r.chain(a).values().sortBy("name").value(),n.count>0&&(c=[n].concat(c)),c},t.prototype.getSortTypeGta=function(t){switch(t||(t=this.getSortType()),l){case"priority":return"priority";case"dueDate":return"due time";case"created":return"created time";case"project":return"project name"}},t}(),t.exports=new i},"9CJ8r+Bm":function(t,e,n){var i,o,r,s,a,c,l,p,u,d,h,f,v={}.hasOwnProperty;h=n("a+N5u/Cl"),f=n("sa1Ed382"),d=n("vmWJWrVe"),u=n("HYobN8SQ"),o=n("qHH6+g6Q"),c=n("P8oS2WJf"),r=n("IIuQdINc"),p=n("wBtFGHUK"),s=n("VHLhWugQ"),a=n("1tpV5y6A"),n("gh8QIhMV").throwError,i=n("WBka3RlP"),l={recent:{name:"recent",view:c,lang:"my.recent",segment:"recent list"},tasks:{name:"tasks",view:p,lang:"my.tasks",segment:"tasks list"},events:{name:"events",view:r,lang:"my.events",segment:"events list"},files:{name:"files",view:a,lang:"my.files"},favorites:{name:"favorites",view:s,lang:"my.favorites"}},t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)v.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,d),e.prototype.viewName="MyView",e.prototype.className="my-view",e.prototype.events={"click .close-float-handler":"clear","click .my-tab:not(.plugin-handler)":"enterSection","setRecentCount .recent-count":"onSetRecentCount"},e.prototype.initialize=function(t){var e;return this.options=t||{},this.renderBasic(),this.tabModel=new o({}),this.listenTo(this.tabModel,"change",function(){return this.renderSection()}),h.delay((e=this,function(){return e.enterSection()})),$("#navigator .my-handler").addClass("active"),this.localCache=u.namespace("temp").namespace("my-view-tab"),this.localCacheId=f.user.id,this},e.prototype.renderBasic=function(){var t;return t=h.values(l),this.$el.html(i({tabs:t})),this.setupPlugins(),this.$content=this.$(".my-content"),this.$myTabs=this.$(".my-tab"),this},e.prototype.renderSection=function(t,e){var n,i,o,r,s;return null==e&&(e={}),t&&(this.viewType="plugin"),t||(t=l[this.viewType].view),e=h.extend(e,{$scrollElement:this.$(".my-content-wrap")}),this.$(".my-content-wrap").attr("data-type",this.viewType),null!=(o=this.currentView)&&o.remove(),this.currentView=this.requestSubView(t,e),this.$content.html(this.currentView.$el),this.$myTabs.removeClass("active"),"plugin"===this.viewType?(i=this.getPluginTabSelector(e.pluginModel),0===(n=this.$myTabs.filter(i)).length&&(this.$myTabs=this.$(".my-tab"),n=this.$myTabs.filter(i)),n.addClass("active")):this.$myTabs.filter("[data-type="+l[this.viewType].name+"]").addClass("active"),$("body").scrollTop(0),(s=null!=(r=l[this.viewType])?r.segment:void 0)&&f.gta.registerProperty("segment",s),this},e.prototype.onSetRecentCount=function(t,e){if(this.$el)return this.isRecentCountGot=!0,this.showCount()},e.prototype.showCount=function(){var t;if(this.isCountGot&&this.isRecentCountGot&&this.isEventCountGot&&!this.isShownCount)return this.isShownCount=!0,t=this.$el,h.delay(function(){return t.addClass("on-count-got")},500)},e.prototype.enterSection=function(t){var e,n;return t&&(n=$(t.target).closest(".my-tab").data("type")),n=n||(null!=(e=this.localCache(this.localCacheId))?e.tab:void 0)||"recent",this.localCache(this.localCacheId,{tab:n}),"plugin"===this.viewType&&n===this.tabModel.get("active")?(this.viewType=n,this.renderSection()):(this.viewType=n,this.tabModel.set("active",this.viewType))},e.prototype.getPluginTabSelector=function(t){return"[data-plugin-id='"+t.get("_id")+"']"},e.prototype.removePlugin=function(t){var e;return e=this.getPluginTabSelector(t),this.$myTabs=this.$(".my-tab").not(e),this.enterSection()},e.prototype.clear=function(){return f.APP.Float.close(),f.gta.event({action:"close my tab",control:"Close Button"}),this},e.prototype.remove=function(){return e.__super__.remove.apply(this,arguments),f.gta.unregisterProperty("segment"),$("#navigator .my-handler").removeClass("active")},e}(),tb_i18n.get("my.recent"),tb_i18n.get("my.tasks"),tb_i18n.get("my.events"),tb_i18n.get("my.files"),tb_i18n.get("my.favorites")},"9Nam0gw1":function(t,e,n){var i,o,r,s,a,c,l,p,u={}.hasOwnProperty;p=n("a+N5u/Cl"),a=n("vmWJWrVe"),s=n("eubUSX4T"),c=n("5CiSxGri"),r=n("ypWNgh6R"),l=n("WRIFfSP1"),o=n("p5Ufk1Ob"),i=n("IIKHnkqe"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,a),e.prototype.viewName="PostMdEditorView",e.prototype.className="post-md-editor",e.prototype.tagName="section",e.prototype.events={"input .editor-input":"handleTextInput","click .editor-input":"saveCaretPos","click .add-work-handler":"toggerWorksPicker","click li.work":"clickToInsertImage","click .md-help-handler":"openMdHelper"},e.prototype.initialize=function(t){return this.options=t,this._projectId=t._projectId,this.attachments=t.attachments||new s,this.renderBasic(),this.renderMD(),this.renderAttachments(),this.listen()},e.prototype.listen=function(){return this.listenTo(this.attachments,"remove add",this.renderAttachments),this.listenTo(this.attachments,"change:completed",(t=this,function(e,n){if(n)return t.insertImage(e)}));var t},e.prototype.renderBasic=function(){var t;return this.$el.html(i({content:this.options.content||""})),this.$editorBarWrap=this.$(".editor-bar-wrap"),this.$textareaset=this.$(".editor-input"),this.$mdWrap=this.$(".editor-md-wrap"),this.$attachmentsWrap=this.$(".editor-attachments"),this.$textareaset.flexText((t=this,function(){return t.options.onchange(t.get())})),this.caretPos=this.get().length},e.prototype.renderMD=function(){return this.$mdWrap.html(window._encodeHTML(this.get(),"MD"))},e.prototype.renderAttachments=function(){var t,e;return t=this.$attachmentsWrap.empty(),this.attachments.each((e=this,function(n){return e.requestSubView(c,{workModel:n,thirdtitle:!0}).$el.prependTo(t)}))},e.prototype.setProjectId=function(t){return this._projectId=t},e.prototype.toggerWorksPicker=function(t){var e;if(e=$(t.currentTarget),!this.worksPicker||this._projectId!==this.worksPicker._projectId)return this.worksPicker=this.requestSubView(l,{container:this.$el,_projectId:this._projectId,collection:this.attachments,$toggler:e,placement:"right"}).show()},e.prototype.openMdHelper=function(){var t;return null!=(t=this.markdownHelperView)&&t.remove(),this.markdownHelperView=this.requestSubView(r,"markdown-helper").open(o),this},e.prototype.clickToInsertImage=function(t){var e,n;return n=(e=$(t.currentTarget)).data("id")||e.data("cid"),this.insertImage(this.attachments.get(n)),this},e.prototype.insertImage=function(t){var e,n,i;if(i=this.getPreviewUrl(t))return n=" !["+(t.get("fileName")||i)+"]("+i+") ",e=(e=this.get().replace(/\r/,"")).slice(0,this.caretPos)+n+e.slice(this.caretPos),this.set(e),this.caretPos+=n.length,this.$textareaset[0].selectionStart=this.caretPos,this.$textareaset[0].selectionEnd=this.caretPos,this},e.prototype.saveCaretPos=function(t){return this.caretPos=this.$textareaset[0].selectionStart,this},e.prototype.handleTextInput=function(t){return this.saveCaretPos(t),this.renderMD(),this},e.prototype.getPreviewUrl=function(t){var e,n,i,o,r;if(t)return o=t.get("thumbnailUrl")||"",r=t.get("imageWidth"),e=t.get("imageHeight"),i=r<400?200:r<600?400:r<800?600:800,n=Math.ceil(i*e/r),o=o.replace("w/200/h/200","w/"+i+"/h/"+n)},e.prototype.get=function(){return this.$textareaset.val().trim()},e.prototype.set=function(t){return this.$textareaset.val(t),this},e.prototype.focus=function(){return p.delay((t=this,function(){if(t.$el)return t.$textareaset.focusAtEnd()}),100);var t},e}()},"9jwhecMQ":function(t,e,n){var i,o,r={}.hasOwnProperty;o=n("7gS+SwzT"),i=n("0IQem2k4"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,o),e.prototype.pluginType="plugin_for_relate",e.prototype.container=".object-picker-menu",e.prototype.createPlugin=function(t){return this.requestSubView(i,{view:this.view,pluginModel:t})},e}()},AE3SznHA:function(t,e){t.exports=function(t){var e='<div class="favorites-header"> <div class="favorites-filter clearfix"> <div class="filter type-filter"> <a class="type-toggler" data-toggle="dropdown"> <span class="active-type">'+t.typeName+'</span> <span class="icon icon-chevron-down"></span> </a> <div class="type-selector dropdown-menu card"> <ul class="type-list"> <li class="type-item ';return t.type||(e+="active"),e+='"> <a class="clearfix"> <span class="icon icon-favorite"></span> '+tb_i18n.get("favorites.all")+' </a> </li> <li class="type-item ',"task"==t.type&&(e+="active"),e+='" data-type="task"> <a class="clearfix"> <span class="icon icon-board"></span> '+tb_i18n.get("navigation.task")+' </a> </li> <li class="type-item ',"post"==t.type&&(e+="active"),e+='" data-type="post"> <a class="clearfix"> <span class="icon icon-wall"></span> '+tb_i18n.get("navigation.sharing")+' </a> </li> <li class="type-item ',"work"==t.type&&(e+="active"),e+='" data-type="work"> <a class="clearfix"> <span class="icon icon-file"></span> '+tb_i18n.get("navigation.work")+' </a> </li> <li class="type-item ',"event"==t.type&&(e+="active"),e+='" data-type="event"> <a class="clearfix"> <span class="icon icon-calendar"></span> '+tb_i18n.get("navigation.event")+' </a> </li> <li class="type-item ',"entry"==t.type&&(e+="active"),e+='" data-type="entry"> <a class="clearfix"> <span class="icon icon-bookkeeping-logo"></span> '+tb_i18n.get("bookkeeping")+' </a> </li> </ul> </div> </div> </div> <div class="search-wrap"> <span class="icon icon-search"></span> <input class="form-control search-input" type="search" placeholder="'+tb_i18n.get("favorites.search")+'" maxlength="100"> </div></div><div class="favorites-body"> <ul class="favorites-list"></ul> <div class="normal-placeholder favorites-placeholder placeholder muted"> <span class="icon icon-favorite"></span> <br> '+tb_i18n.get("favorites.placeholder")+' </div> <div class="noresult-placeholder favorites-placeholder placeholder muted"> <span class="icon icon-search-warning"></span> <br> <div class="search-placeholder-content"></div> </div></div>'}},AmP5WYKx:function(t,e,n){var i,o,r,s,a,c,l={}.hasOwnProperty;i=n("+2RfZ2TT"),a=n("a+N5u/Cl"),c=n("wd/RKGTj"),s=n("3eMzznN/"),o=n("VuB9cZyl"),r=n("JqCZnOZG"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)l.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,o),e.prototype.name="favorites",e.prototype.model=r,e.prototype.pageNum=20,e.prototype.comparator=!1,e.prototype.parse=function(t){var e,n,o;return e=[],n=null!=t.results?t.results:t,a.each(n||[],(o=this,function(t,n){var r,c,l,p,u;switch((t=a.extend(t,a.omit(t.data,"created"))).type=t.refType,t._projectId=null!=(c=t.project)?c._id:void 0,t.projectName=null!=(l=t.project)?l.name:void 0,t.type){case"work":null!=t.fileSize&&(t.fileSize=s.formatFileSize(t.fileSize)),t.title=t.fileName;break;case"task":t.avatarUrl=(null!=(p=t.executor)?p.avatarUrl:void 0)||(null!=(u=t.creator)?u.avatarUrl:void 0),t.dueDate&&(t.dueDate=s.formatDate(t.dueDate)),t.accomplished&&(t.accomplished=s.formatDate(t.accomplished)),t.title=t.content,t.content=t.note;break;case"post":r=a.unescape(t.content);try{t.content=i("<textarea>"+r+"</textarea>").text()}catch(d){t.content=a.escape(r)}break;case"event":t.dateStr=o.formatDate(t.startDate),t.eventDateString=o.getEventDateString(t);break;case"entry":t._type=t.data.type,-1===t._type&&(t.amount="-"+t.amount),t.title=t.content,t.content=t.note}return t.createdDate=o.formatDate(t.created),e.push(t)})),e},e.prototype.formatDate=function(t){var e,n;return n=c(),e=c(t).isSame(n,"year")?"en"===tb_i18n.getLanguage()?"MMM D":"MMMDo":"ll",c(t).format(e)},e.prototype.getEventDateString=function(t){var e,n,i;return t.startDate?(i=(n=s.formatDate(new Date(t.startDate)).dateString)+" "+c(t.startDate).format("LT"),t.endDate&&(i+=" -",(e=s.formatDate(new Date(t.endDate)).dateString)!==n&&(i+=" "+e),i+=" "+c(t.endDate).format("LT")),i):""},e}()},B5ZbuE3m:function(t,e){t.exports=function(t){var e,n,i="undefined"!=typeof _encodeHTML?_encodeHTML:(e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},n=/&(?!#?\w+;)|<|>|"|'|\//g,function(t){return t?t.toString().replace(n,function(t){return e[t]||t}):""}),o='<li class="event" data-id="'+t._id+'" data-type="event"  data-gta=\'event\' data-label=\'open event detail\'> <i class="icon icon-calendar"></i> <div class="event-content"> <span class="event-title">'+i(t.title)+"</span> ";return t.project&&t.project.name&&t.project._id&&(o+=' <a class="event-tag" data-tag="project" data-id="'+t.project._id+'" data-gta="event" data-label="event|go to project"> '+i(t.project.name)+" </a> "),o+=' </div> <div class="event-time"> <time>'+t.startDateString+"</time> ",t.endDateString&&(o+=" - <time>"+t.endDateString+"</time> "),o+=" </div></li>"}},BVpVtTsR:function(t,e,n){},BkEQiL1U:function(t,e,n){},BoyioCAF:function(t,e,n){var i,o,r={}.hasOwnProperty;o=n("zBkMzjyh"),i=n("OZDTLQvo"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,o),e.prototype.pluginType="plugin_for_collection",e.prototype.createPlugin=function(t){var e,n;return n=this.onPluginHandle.bind(this),e=this.view.collectionModel.toJSON(),this.requestSubView(i,{view:this.view,pluginModel:t,data:e,onPluginHandle:n})},e.prototype.onPluginHandle=function(){return this.view.hide()},e}()},BvQw3fHc:function(t,e,n){var i,o,r,s,a,c,l,p,u,d,h,f,v,y={}.hasOwnProperty;d=n("a+N5u/Cl"),v=n("sa1Ed382"),r=n("9aPZbVuc"),l=n("HDJEOtNh").OrganizationAccess,p=n("6XSa3ffj"),s=n("E86Oiqt3"),o=n("xSDGjIzx"),i=n("rU2aduZM"),u=n("+h7VEZku").VisibilityController,f=n("RTj5z5YX"),a=f.CommonShare,c=f.InviteLink,h=f.isReadonlyShare,t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)y.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,p),e.prototype.viewName="WorkMenuView",e.prototype.events={"click .copy-work-handler":"forkWork","click .favorite-work-handler":"favoriteWork","click .share-work-handler":"shareWork","click .move-work-handler":"moveWork","click .update-work-handler":"updateWork","click .archive-work-handler":"enterArchiveSubMenu","submit .work-archive-form":"submitArchive","click .invite-handler":"enterInviteSubMenu"},e.prototype.initialize=function(t){var n;return this.inGridView=t.inGridView,this.workModel=t.workModel,this.onForkClick=t.onForkClick,this.onFavoriteClick=t.onFavoriteClick,this.onArchiveClick=t.onArchiveClick,this.onRemoveClick=t.onRemoveClick,this.onMoveClick=t.onMoveClick,this.onUpdateClick=t.onUpdateClick,this.onSwitchVisibility=t.onSwitchVisibility,this.projectModel=t.projectModel,this._projectId=this.workModel.get("_projectId"),this._organizationId=this.workModel.get("_organizationId")||(null!=(n=this.projectModel)?n.get("_organizationId"):void 0),this.popoverTitle=tb_i18n.get("work.menu.title"),this.listen(),e.__super__.initialize.apply(this,arguments)},e.prototype.listen=function(){return this.listenTo(this.workModel,"change:visible",this.renderVisible)},e.prototype.render=function(){return this.unmountReactViews(),this.renderBasic(),this.$visibleSwitchers=this.$(".switch-visible-handler"),this.renderVisible(),this._projectId&&this.setupPlugins({_projectId:this._projectId}),this},e.prototype.renderBasic=function(){var t,e,n,i,a,c;return e=v.config.HOST,t=this.workModel.get("_parentId"),a=e+"/project/"+this._projectId+"/works/"+t+"/work/"+this.workModel.get("_id"),n=s.find(t),i=d.extend(this.workModel.getFormatData(),{objectLinkUrl:a,permissions:this.workModel.hasPermissions("put.fork","put.move","put.archive","put.version"),inGridView:this.inGridView,canModifyVisibility:this.workModel.canModifyVisibility(),showLink:!!this._projectId,showShare:!!this._projectId,showInviteLink:!!this._projectId&&(null!=(c=this.projectModel)?c.hasPermission("post.member"):void 0)&&Boolean(this._organizationId&&l.canAddOuterMember(this._organizationId)),parentVisible:null!=n?n.get("visible"):void 0,parentPermissions:null!=n?n.hasPermissions("put.visible"):void 0,isShared:h(this.workModel.get("shareStatus"))}),this.$el.html(o(i)),r.initCopyLinkHandler(this.$(".copy-object-link-handler"),{type:"file",control:"More Menu"})},e.prototype.renderVisible=function(){if(this.workModel.canModifyVisibility())return this.requestReactView(this.$visibleSwitchers.get(0),u,{visibility:this.workModel.get("visible"),onChange:this.onSwitchVisibility.bind(this)})},e.prototype.forkWork=function(){return this.onForkClick(),this.hide()},e.prototype.moveWork=function(){return this.onMoveClick(),this.hide()},e.prototype.favoriteWork=function(){return this.onFavoriteClick().then((t=this,function(e){var n;if(t.render(),!e.isFavorite&&t.options.onUnfavorite)return"function"==typeof(n=t.options).onUnfavorite?n.onUnfavorite(t.workModel.get("_id")):void 0}));var t},e.prototype.shareWork=function(){return v.gta.event({action:"share content",control:"More Menu",type:"work"}),this.enterSubMenu(tb_i18n.get("share.via.wechat"),(t=this,function(){return t.requestReactView(t.el,a,{objectType:"work",model:t.workModel})}));var t},e.prototype.enterInviteSubMenu=function(){return v.gta.event({action:"invite project member",control:"More Menu",type:"work"}),this.enterSubMenu(tb_i18n.get("invite.from.link"),(t=this,function(){return t.requestReactView(t.el,c,{objectType:"work",objectId:t.workModel.id})}));var t},e.prototype.updateWork=function(){return this.onUpdateClick(),this.hide()},e.prototype.enterArchiveSubMenu=function(){return this.enterSubMenu(tb_i18n.get("archive"),(t=this,function(){return t.$el.html(i())}));var t},e.prototype.submitArchive=function(t){return t.preventDefault(),this.onArchiveClick()},e.prototype.returnMainMenu=function(){return this.unmountReact(this.el),e.__super__.returnMainMenu.apply(this,arguments)},e.prototype.unmountReactViews=function(){if(this.unmountReact(this.el),this.$visibleSwitchers)return this.unmountReact(this.$visibleSwitchers.get(0))},e.prototype.onHidden=function(){return this.unmountReactViews(),e.__super__.onHidden.apply(this,arguments)},e}()},ByKekhNl:function(t,e,n){var i,o,r={}.hasOwnProperty;o=n("7fdVgQwj"),i=n("Q64OfkAh"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,o),e.prototype.viewName="ProjectOverviewTabPluginView",e.prototype.initialize=function(t){return this.nativePluginConfig=t.nativePluginConfig,e.__super__.initialize.apply(this,arguments),this.listenTo(this.view.projectModel,"change:unreadCount change:unreadMessageCount change:pushStatus",this.render)},e.prototype.render=function(){var t,e,n,o,r,s,a,c,l,p;if(t=(r=this.getAppNameAndPluginId()).appName,n=r.pluginId,(null!=(s=this.nativePluginConfig)?s.html:void 0)?e=null!=(a=this.nativePluginConfig)?a.html:void 0:(p=(c=this.view.projectModel.toJSON()).unreadCount,o=c.pushStatus,e=i(Object.assign({},this.pluginModel.toJSON(),{appName:t,projectId:null!=(l=this.data)?l._id:void 0,unreadCount:p,pushStatus:o}))),this.$el.html(e),this.isActive({appName:t,pluginId:n}))return this.$el.addClass("active")},e}()},C5OQKKhx:function(t,e,n){var i,o,r,s={}.hasOwnProperty;o=n("GESwhXbR").Toast,r=n("XbrdCDrd"),i=n("Jmm2Isea"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,r),e.prototype.viewName="MyTabPluginView",e.prototype.className="plugin-handler my-tab",e.prototype.tagName="a",e.prototype.events={click:"onPluginClick"},e.prototype.initialize=function(){return e.__super__.initialize.apply(this,arguments),this.listenTo(this.pluginModel,"remove",this._destroy)},e.prototype.render=function(){var t,e;return e=this.pluginModel.toJSON(),(t=this.$el).attr("data-plugin-id",e._id),t.attr("data-gta","{action: 'use plugin', control: '"+e.type+"', pluginId: '"+e._id+"'}"),t.text(e.name)},e.prototype.onPluginClick=function(){return this.handle(this.pluginModel.toJSON(),this.data)},e.prototype.handleIframe=function(t,e,n){return this.view.renderSection(i,{view:this.view,pluginModel:this.pluginModel,data:this.data})},e.prototype._destroy=function(){return this.$el.hasClass("active")&&o.info(tb_i18n.get("project.app.plugin.remove.essage")),this.view.removePlugin(this.pluginModel),this.remove()},e}()},CDzwcJ2U:function(t,e,n){var i,o;i=n("PdZWjpiS"),o=function(){function t(){}return t.prototype.api=null,t.prototype.cache=(new Date).valueOf(),t.prototype.create=function(){var t,e;return t=(e=(new Date).valueOf())-this.cache>0,this.api&&!t||(this.cache=e,this.api=new i),this.api},t}(),t.exports=new o},CKx1hZTz:function(t,e){t.exports=function(t){return'<div class="future-events"></div>'}},"D543+7QT":function(t,e,n){},DvVVbUsU:function(t,e){t.exports=function(t){var e,n,i="undefined"!=typeof _encodeHTML?_encodeHTML:(e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},n=/&(?!#?\w+;)|<|>|"|'|\//g,function(t){return t?t.toString().replace(n,function(t){return e[t]||t}):""}),o='<form class="entry-creator-form"> <div class="entry-category"> <ul class="entry-category-select ';1==t.type?o+="income":o+="expense",o+='"> ';var r=t.defaultCategories;if(r)for(var s,a=-1,c=r.length-1;a<c;)o+=" ","other"!=(s=r[a+=1]).icon&&(o+=' <li class="entry-category-option " data-icon="'+s.icon+'" data-id="'+s._id+'"> <span class="entry-icon icon icon-'+s.iconStr+'"></span> <span class="entry-category-title">'+i(s.title)+"</span> </li> "),o+=" ";return o+=' <li class="entry-category-option other" data-icon="other"> <span class="entry-icon icon icon-more"></span> <span class="entry-category-title">'+tb_i18n.get("entry.creator.other.category")+'</span> </li> </ul> </div> <div class="entry-content"> <input class="entry-content-input form-control" placeholder="'+tb_i18n.get("entry.creator.placeholder.content")+'" value="'+i(t.content)+'" /> </div> <div class="entry-amount-date clearfix"> <div class="entry-amount"> <input class="entry-amount-input form-control" type="number" min="1" placeholder="'+tb_i18n.get("entry.creator.placeholder.amount")+'" value="'+t.amount+'" /> </div> <div class="entry-date"></div> </div> <div class="entry-note"> <textarea class="entry-note-input" placeholder="'+tb_i18n.get("entry.creator.placeholder.note")+'">'+t.note+'</textarea> </div> <div class="entry-tags-set"> <div class="tag-picker-header"> <span class="icon icon-tag"></span> <span class="text">'+tb_i18n.get("tags")+'</span> </div> <div class=\'tag-picker-wrapper\'></div> </div> <div class="entry-involve-set"></div> <div class="submit-set clearfix"> <a class="creator-visible"></a> <button class="btn btn-primary submit-handler pull-right" data-gta="event" data-label="bkp creator submit"> ',t.isEdit?o+=""+tb_i18n.get("save"):o+=""+tb_i18n.get("create"),o+=" </button> </div></form>"}},EFIOe9De:function(t,e,n){"use strict";var i=n("mrSGxOB2"),o=n("q1tIBJhx"),r=n("tLZJUYWX"),s=function(){return{work:{download:r.get("library.download"),move:r.get("work.move.title"),edit:r.get("work.rename.title")},collection:{download:r.get("collection.download.title"),move:r.get("collection.move.title"),edit:r.get("collection.rename.title")}}},a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.getMenuHandler=function(t){e.menuHandler=t},e.onMenuOpen=function(){e.props.onMenuOpen&&e.props.onMenuOpen(e.menuHandler)},e.onOpenClick=function(){e.props.onOpenClick&&e.props.onOpenClick()},e}return i.d(e,t),e.prototype.stopPropagation=function(t){t.stopPropagation()},e.prototype.renderDownload=function(){return this.props.showDownload?this.props.isFileLocalExist?o.createElement("a",{className:"open-handler icon icon-file3 hinted","data-title":r.get("open.file"),onClick:this.onOpenClick}):o.createElement("a",{className:"work-download-handler icon icon-circle-arrow-down-o hinted","data-title":s()[this.props.type].download,onClick:this.props.onDownloadClick}):null},e.prototype.renderUpdate=function(){return this.props.showUpdate&&!this.props.downloadOnly&&o.createElement("a",{onClick:this.props.onUpdateClick,className:"update-handler icon icon-circle-arrow-up-o hinted","data-title":r.get("update.file")})},e.prototype.renderMove=function(){return this.props.showMove&&!this.props.downloadOnly&&o.createElement("a",{className:"move-handler icon icon-file-move2 hinted","data-title":s()[this.props.type].move,onClick:this.props.onMoveClick})},e.prototype.renderEdit=function(){return this.props.showEdit&&!this.props.downloadOnly&&o.createElement("a",{className:"edit-handler icon icon-pencil hinted","data-title":s()[this.props.type].edit,onClick:this.props.onEditClick})},e.prototype.renderDropdown=function(){return this.props.showMenu&&o.createElement("a",{ref:this.getMenuHandler,className:"menu-toggler icon icon-chevron-down hinted","data-title":r.get("more.operations"),onClick:this.onMenuOpen})},e.prototype.render=function(){return o.createElement("div",{className:"library-item-handler",onClick:this.stopPropagation},this.renderDownload(),this.renderUpdate(),this.renderMove(),this.renderEdit(),this.renderDropdown())},e.defaultProps={showDownload:!0,showUpdate:!0,showMove:!0,showEdit:!0,showMenu:!0,downloadOnly:!1,isFileLocalExist:!1},e}(o.PureComponent);n.d(e,"a",function(){return a}),n("PXZyboM/")},EjqNFBXm:function(t,e,n){var i,o,r,s,a,c,l,p,u={}.hasOwnProperty;l=n("a+N5u/Cl"),i=n("4Cw+wkJz"),o=n("GECagZoP"),r=n("OTplxZeS"),s=n("m+Dzs2wV"),c=n("vmWJWrVe"),a=n("GESwhXbR").Toast,p=n("gh8QIhMV").throwError,t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,c),e.prototype.viewName="BookkeepingSettingsCategoriesView",e.prototype.tagName="div",e.prototype.className="bookkeeping-settings-categories-view",e.prototype.type=1,e.prototype.events={"keyup .add-input":"keyupAddInput","click .link-add-handler":"createCategory","click .settings-switcher":"switchType","click .settings-event-source":"triggerEvent","keyup .category-input":"keyeupCategoryInput","deleteCategory .category":"deleteCategory","enterEditing .category":"enterEditing","updateCategory .category":"updateCategory","exitEditing .category":"exitEditing"},e.prototype.initialize=function(t){if(!t._projectId)throw new Error(this.viewName+":options should have _projectId");var n;return this.options=t,this._projectId=t._projectId,this.render(),l.delay((n=this,function(){return n.$el.addClass("in")}),100),e.__super__.initialize.apply(this,arguments)},e.prototype.render=function(){return this.$el.html(i()),this.$list=this.$(".settings-list"),this.load().then((t=this,function(){return t.listen(),t.renderCategories()})).catch(function(t){return p(t)});var t},e.prototype.load=function(){return new Promise((t=this,function(e,n){return s.fetch(t._projectId,{success:function(n){return t.entryCategoriesCollection=n,e()},error:n})})).then(function(t){return function(){return new Promise(function(e,n){return r.fetch(t._projectId,{success:function(n){return t.entriesCollection=n,e()},error:n})})}}(this));var t},e.prototype.listen=function(){var t;return this.listenTo(this.entryCategoriesCollection,"remove destroy",this.removeCategory),this.listenTo(this.entryCategoriesCollection,"add change",(t=this,function(e){return t.renderCategory(e.toJSON(),!0)})),this},e.prototype.renderCategories=function(){var t,e;return this.$list.empty(),!1,t=this.entryCategoriesCollection.getCategories(this.type,!1),l.each(t,(e=this,function(t){return e.renderCategory(t)})),this},e.prototype.renderCategory=function(t,e){var n,i;return i=t.id||t._id,t.toJSON&&(t=t.toJSON()),(n=this.$(".category[data-id="+i+"]")).length?n.replaceWith(o(t)):this.$list[e?"prepend":"append"](o(t)),this},e.prototype.removeCategory=function(t){var e;return e=t.id||t._id,this.$(".category[data-id="+e+"]").remove()},e.prototype.switchType=function(t){var e,n;if(e=$(t.currentTarget),(n=parseInt(e.data("type")))&&n!==this.type)return this.type=n,this.$(".settings-switcher-wrap").removeClass("active"),this.$(".settings-switcher[data-type="+n+"]").parent().addClass("active"),this.renderCategories(),this},e.prototype.keyupAddInput=function(t){return 13===t.keyCode?this.createCategory():this.filterCategory()},e.prototype.filterCategory=function(){var t;return(t=this.$(".add-input").val())?this.entryCategoriesCollection.each(function(e){var n,i,o;return i=e.toJSON(),o=(n=this.$(".category[data-id="+i._id+"]")).text(),n[o.indexOf(t)<0?"addClass":"removeClass"]("hide")}):this.$(".category").removeClass("hide"),this},e.prototype.createCategory=function(t){var e,n,i;return(n=(e=this.$(".add-input")).val())?(this.entryCategoriesCollection.create({title:n,type:this.type,_projectId:this._projectId},{wait:!0,success:(i=this,function(t){return e.val(""),i.filterCategory()}),error:function(t,e){return a.error(e)}}),this):this},e.prototype.keyeupCategoryInput=function(t){var e;return e=$(t.currentTarget),13===t.keyCode&&e.trigger("updateCategory"),this},e.prototype.triggerEvent=function(t){var e,n;return(e=$(t.currentTarget)).prop("disabled"),e.hasClass("disabled")?this:((n=e.data("type"))&&e.trigger(n),this)},e.prototype.deleteCategory=function(t){var e,n;return n=$(t.currentTarget).data("id"),(e=this.entryCategoriesCollection.get(n))&&e.destroy(),this},e.prototype.enterEditing=function(t){var e,n,i,o,r;return e=(n=$(t.currentTarget)).find("input"),o=n.data("id"),i=null!=(r=this.entryCategoriesCollection.get(o))?r.toJSON():void 0,"editing",this.$(".editing").removeClass("editing"),n.addClass("editing"),e.val(i.title),e.focusAtEnd(),this},e.prototype.exitEditing=function(t){return $(t.currentTarget).removeClass("editing"),this},e.prototype.updateCategory=function(t){var e,n,i,o;return i=(e=$(t.currentTarget)).data("id"),n=this.entryCategoriesCollection.get(i),"updating",o=e.find("input").val(),e.find("input").focusAtEnd(),e.hasClass("updating")||!o?this:(e.addClass("updating"),n.save(null,{wait:!0,attrs:{title:o},success:function(){return e.removeClass("updating")},error:function(t,e){return a.error(e)}}),this)},e.prototype.close=function(){var t;return null!=(t=this.parentView)&&t.remove(),this},e}()},FIZ2RGag:function(t,e,n){var i,o,r={}.hasOwnProperty;o=n("zBkMzjyh"),i=n("OZDTLQvo"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,o),e.prototype.pluginType="plugin_for_bookkeeping",e.prototype.createPlugin=function(t){var e;return e=this.view.bookkeepingModel.toJSON(),this.requestSubView(i,{view:this.view,pluginModel:t,data:e})},e}()},GECagZoP:function(t,e){t.exports=function(t){var e,n,i="undefined"!=typeof _encodeHTML?_encodeHTML:(e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},n=/&(?!#?\w+;)|<|>|"|'|\//g,function(t){return t?t.toString().replace(n,function(t){return e[t]||t}):""});return'<li class="category" data-id="'+t._id+'"> <span class="icon icon-menu pull-left"></span> <div class="settings-handlers-editing clearfix"> <input type="text" class="form-control pull-left category-input" placeholder="'+tb_i18n.get("bookkeeping.settings.category.edit.placeholder")+'" value=""> <button class="btn btn-primary btn-small settings-event-source pull-left" data-type="updateCategory">'+tb_i18n.get("save")+'</button> <button class="btn btn-link btn-small settings-event-source pull-left" data-type="exitEditing">'+tb_i18n.get("cancel")+'</button> </div> <div class="settings-handlers-without-state clearfix"> <span class="settings-category-case">'+i(t.title)+'</span> <a class="icon icon-trash settings-event-source pull-right" data-type="deleteCategory" ></a> <a class="icon icon-pencil settings-event-source pull-right" data-type="enterEditing"></a> </div></li>'}},H3uka4wv:function(t,e,n){t.exports=[{type:"project",ViewConstructor:n("4djJg61A"),PluginConstructor:n("FIZ2RGag")},{type:"project",ViewConstructor:n("1tVQcfxV"),PluginConstructor:n("RO++zyUi")},{type:"project",ViewConstructor:n("MKB6FaaL"),PluginConstructor:n("mOEK7NOi")},{type:"project",ViewConstructor:n("6kdBHtJD"),PluginConstructor:n("i/aZTl2y")},{type:"project",ViewConstructor:n("W3m4F8eF"),PluginConstructor:n("oPKpjxwr")},{type:"project",ViewConstructor:n("BvQw3fHc"),PluginConstructor:n("oPKpjxwr")},{type:"project",ViewConstructor:n("+pMB8BsN"),PluginConstructor:n("+ChHpCVR")},{type:"project",ViewConstructor:n("UpxbwU5/").BackboneView,PluginConstructor:n("UzGj+rmU")},{type:"project",ViewConstructor:n("4GkEO0HF"),PluginConstructor:n("b++ooxIa")},{type:"project",ViewConstructor:n("zvO9CzUp"),PluginConstructor:n("g/Kdugr/")},{type:"project",ViewConstructor:n("6IrxsRwM"),PluginConstructor:n("BoyioCAF")},{type:"my",ViewConstructor:n("9CJ8r+Bm"),PluginConstructor:n("6T6NA009")},{type:"project",ViewConstructor:n("mm5OMB1B"),PluginConstructor:n("+QYKsXiA")},{type:"project",ViewConstructor:n("NqvaD/lL"),PluginConstructor:n("9jwhecMQ")}]},I60qZbaE:function(t,e){t.exports=function(t){var e,n,i="undefined"!=typeof _encodeHTML?_encodeHTML:(e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},n=/&(?!#?\w+;)|<|>|"|'|\//g,function(t){return t?t.toString().replace(n,function(t){return e[t]||t}):""}),o="",r=t.item;return o+='<li class="favorite-item '+i(r.type)+"-wrapper ",r.isVisible||(o+="not-visible"),o+='" data-type="'+i(r.type)+'" data-id="'+i(r._refId)+'"> <div class="item-header flex-horiz"> ',t.projectName&&(o+='<p class="project-name flex-fill">'+i(r.projectName)+"</p>"),o+=' <div class="flex-static"> <div class="create-date">'+r.createdDate+'</div> <div class="unfavorite">'+tb_i18n.get("unfavorite")+'</div> </div> </div> <div class="item-title clearfix"> <span class="icon icon-'+i(r.iconName)+" ","entry"!=r.type&&(o+="title-icon"),o+=" ","work"==r.type&&(o+="is-work"),o+=' pull-left"></span> ',"task"==r.type?(o+=' <span class="img img-24 img-circle no-avatar pull-left" ',r.avatarUrl&&(o+='style="background-image:url('+r.avatarUrl+')"'),o+="></span> "):"work"==r.type&&(o+=' <span class="react-file-item" data-type="'+r.fileType+'"></span> '),o+=' <div class="title ',"work"==r.type&&(o+="work-title"),o+='"> <p> <span class="title-text">'+i(r.title)+"</span> ","work"==r.type&&(o+=' <span class="file-size"> ('+r.fileSize+") </span> "),o+=" ",r.isArchived&&(o+=' <span class="label archived"> <span class="icon icon-trash"></span> '+tb_i18n.get("search.archived")+" </span> "),o+=" ","task"===r.type&&(o+=' <span class="task-id-placeholder"></span> '),o+=' </p> </div> <div class="badges"> ',"updated"==r.status?o+=' <span class="label update-icon hinted" data-title="'+tb_i18n.get("favorites.updated")+'"> <span class="icon icon-file-update"></span> '+tb_i18n.get("favorites.new")+" </span> ":"archived"==r.status?o+=' <span class="label"> <span class="icon icon-trash"></span> '+tb_i18n.get("search.archived")+" </span> ":"invisible"==r.status?o+=' <span class="label"> <span class="icon icon-lock"></span> '+tb_i18n.get("favorites.invisible")+" </span> ":"deleted"==r.status&&(o+=' <span class="label"> <span class="icon icon-trash"></span> '+tb_i18n.get("favorites.deleted")+" </span> "),o+=" ","task"==r.type&&(o+=" ",!r.isDone&&r.dueDate?(o+=' <time class="task-duedate label ',"overdue"===r.dueDate.dateClass?o+="label-important":"today"===r.dueDate.dateClass?o+="label-warning":"upcoming"===r.dueDate.dateClass&&(o+="label-info"),o+='"> <span class="icon icon-calendar ',"normal"!==r.dueDate.dateClass&&(o+="icon-white"),o+='"></span> ',r.dueDate.dateIsToday?o+=" <span>"+r.dueDate.dateTimeString+"</span> ":o+=" <span>"+r.dueDate.dateString+"</span> ",o+=" </time> "):r.isDone&&r.accomplished&&(o+=' <time class="label task-accomplished-date"> <span class="icon icon-calendar icon-white"></span> '+r.accomplished.dateString+" </time> "),o+=" "),o+=" </div> ","entry"==r.type&&(o+=' <div class="entry-amount ',1==r._type?o+="income":o+="expense",o+='">'+r.amount+"</div> "),o+=" </div> \x3c!-- end of `.item-title`--\x3e ","event"==r.type&&(o+=' <time class="event-date">'+r.eventDateString+"</time> ",r.location&&(o+=' <div class="address">'+i(r.location)+"</div> "),o+=" "),o+=" ","work"!=r.type&&r.content&&(o+=' <div class="item-content"> <div class="'+i(r.type)+'-content">'+i(r.content)+"</div> </div> "),o+='</li><div class="underscore"></div>'}},IIKHnkqe:function(t,e){t.exports=function(t){return'<header> <div class="editor-bar-wrap"></div></header><section> <div class="editor-content clearfix"> <textarea class="editor-input" autofocus placeholder="'+tb_i18n.get("wall.view.post.creator.placeholder")+'">'+t.content+'</textarea> <div class="editor-md-wrap"></div> </div></section><footer> <div class="post-editor-info"> <a class="add-work-handler pull-left" data-gta="event" data-label="activity add works"> <span class="icon icon-paperclip"></span>'+tb_i18n.get("activity.timeline.add.attachment")+' </a> <span class="post-creator-mdhelper muted pull-right"> '+tb_i18n.get("post.creator.markdown.tips")+' </span> </div> <ul class="editor-attachments clearfix"></ul></footer>'}},IIuQdINc:function(t,e,n){var i,o,r,s,a,c,l,p,u={}.hasOwnProperty;l=n("a+N5u/Cl"),p=n("sa1Ed382"),a=n("vmWJWrVe"),c=n("OmupbwLD"),r=n("g09zqn9P"),s=n("OEc9sPz7"),o=n("PBoGXsPv"),i=n("/f0zoIw5"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,a),e.prototype.viewName="MyEventsView",e.prototype.tagName="section",e.prototype.className="my-events-view my-content-view fade",e.prototype.events={"click .events-tab":"triggerEventsType","click .icalendar":"showICalendar","click .event":"gtaOpenEvent"},e.prototype.initialize=function(t){return this.options=l.extend({},t),this.options.title=tb_i18n.get("my.events"),this.options.subTitle=tb_i18n.get("my.events.icalendar.title"),this.options.webcal=p.user.get("calLink"),this.eventType="future",this.renderBasic(),this.renderFutureEvents(),l.delay((e=this,function(){return e.$el.addClass("in")}));var e},e.prototype.renderBasic=function(){return this.$el.html(i(this.options)),this.$eventsType=this.$(".my-header-tabs"),this.$scheduleWrap=this.$(".schedule-wrap")},e.prototype.triggerEventsType=function(t){var e;if((e=$(t.currentTarget).data("type"))!==this.eventType)return"future"===e?(this.renderFutureEvents(),p.gta.event({action:"open future event"})):"past"===e&&(this.renderPastEvents(),p.gta.event({action:"open past event"})),this.eventType=e,this.updateEventHeader(e)},e.prototype.renderFutureEvents=function(){var t;return null!=(t=this.futureEventsView)&&t.remove(),this.futureEventsView=this.requestSubView(o),this.$scheduleWrap.html(this.futureEventsView.$el)},e.prototype.renderPastEvents=function(){var t;return null!=(t=this.pastEventsView)&&t.remove(),this.pastEventsView=this.requestSubView(s),this.$scheduleWrap.html(this.pastEventsView.$el)},e.prototype.updateEventHeader=function(t){return this.$eventsType.find("li").removeClass("is-active"),this.$eventsType.find("li[data-type='"+t+"']").addClass("is-active")},e.prototype.showICalendar=function(){return this.requestSubView(c).open(r,this.options)},e.prototype.gtaOpenEvent=function(){var t;return t="future"===this.eventType?"future event":"past event",p.gta.event({action:"open detail",type:"event",control:t})},e}()},"Jd7u/zMm":function(t,e){t.exports=function(t){var e,n,i="undefined"!=typeof _encodeHTML?_encodeHTML:(e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},n=/&(?!#?\w+;)|<|>|"|'|\//g,function(t){return t?t.toString().replace(n,function(t){return e[t]||t}):""}),o='<a class="object-nav" data-type="'+t._id+'"> ';return t.avatarUrl?o+=' <span class="icon icon-avatar" style="background-image: url('+i(t.avatarUrl)+')"></span> ':o+=' <span class="icon icon-link"></span> ',o+=' <span class="object-copy">'+i(t.name)+"</span></a>"}},"JjUg/YRZ":function(t,e){t.exports=function(t){var e='<div class="bookkeeping-panel-wrap scrollable"> <div class="bookkeeping-panel-header"> ';return t.permissions.putApprovers||t.permissions.putCategories||t.permissions.putFields?e+=' <a class="bookkeeping-panel-settings-toggler" data-type="approve" data-gta="event" data-label="bkp panel settings toggle"> <strong>'+tb_i18n.get("bookkeeping.panel.title.settings")+'</strong> <span class="icon icon-chevron-down pull-right"></span> </a> ':e+=' <span class="bookkeeping-panel-settings-toggler"> <strong>'+tb_i18n.get("bookkeeping.panel.title.settings")+"</strong> </span> ",e+=' <a class="icon icon-remove pull-right bookkeeping-panel-toggler"></a> </div> <ul class="bookkeeping-panel-settings-set list"> ',t.permissions.putApprovers&&(e+=' <li> <a class="bookkeeping-panel-settings-handler" data-type="approve" data-gta="event" data-label="bkp panel settings approve"> '+tb_i18n.get("bookkeeping.settings.approver.title")+" </a> </li> "),e+=" ",t.permissions.putFields&&(e+=' <li> <a class="bookkeeping-panel-settings-handler" data-type="displayFields" data-gta="event" data-label="bkp panel settings displayFields"> '+tb_i18n.get("bookkeeping.settings.fields.title")+" </a> </li> "),e+=" ",t.permissions.putCategories&&(e+=' <li> <a class="bookkeeping-panel-settings-handler" data-type="category" data-gta="event" data-label="bkp panel settings category"> '+tb_i18n.get("bookkeeping.settings.category.title")+" </a> </li> "),e+=' </ul> <div class="bookkeeping-panel-filter-set panel-set"> <div class="panel-title"> <strong>'+tb_i18n.get("bookkeeping.panel.title.filter")+'</strong> <a class="filter-clear-handler pull-right" data-gta="event" data-label="bkp panel filter clear">'+tb_i18n.get("bookkeeping.panel.title.filter.clear")+'</a> </div> <div class="filter-input-wrap"> <input class="form-control filter-query-input" placeholder="'+tb_i18n.get("bookkeeping.panel.input.placeholder")+'" /> </div> <div class="filter-date-wrap"> <a class="filter-start-date filter-date-hanlder" data-gta="event" data-label="bkp panel filter startDate"></a> <div class="filter-date-line"></div> <a class="filter-end-date filter-date-hanlder" data-gta="event" data-label="bkp panel filter endDate"></a> </div> </div> <div class="bookkeeping-panel-filter-categories panel-set"></div> <div class="bookkeeping-panel-filter-tags panel-set"></div> <div class="bookkeeping-panel-filter-creators panel-set"></div> <div class="bookkeeping-panel-filter-approved-wrap"> <a class="filter-approved-handler" data-gta="event" data-label="bkp panel approve handler"> <div class="check-box pull-left"> <span class="icon icon-tick"></span> </div> <span>'+tb_i18n.get("bookkeeping.panel.filter.hide.approved")+'</span> </a> </div></div><div class="bookkeeping-panel-layer"></div>'}},Jmm2Isea:function(t,e,n){var i,o,r={}.hasOwnProperty;o=n("XbrdCDrd"),i=n("V8m3grrn").PluginIframe,t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,o),e.prototype.viewName="MyPluginView",e.prototype.className="my-plugin-view",e.prototype.render=function(){var t;return t=this.translateUrl(this.pluginModel.toJSON(),this.data),this.requestReactView(this.el,i,{url:t,className:"my-iframe",needLayerManager:!0,injectedStyle:{paddingTop:"116px"},mountNode:document.getElementsByClassName("my-view")[0],mountNodeZIndex:"101"})},e}()},JqCZnOZG:function(t,e,n){var i,o,r,s,a,c,l,p,u={}.hasOwnProperty,d=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};p=n("a+N5u/Cl"),r=n("qHH6+g6Q"),c=n("oq1bWpp9"),o=n("1fU+e3+7"),l=n("8N+zwa3A"),s=n("Rb7YhHxV"),i=n("BVXu+viu"),a={task:c,event:o,work:l,post:s,entry:i},t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,r),e.prototype.name="favorite",e.prototype.urlRoot="favorites",e.prototype.idAttribute="_refId",e.prototype.initialize=function(t,n){return n||(n={}),n.bindByMatrix=!1,e.__super__.initialize.apply(this,arguments)},e.prototype.doFavorite=function(t,e){var n,i,o,r;if(null==e&&(e={}),!(d.call(p.keys(a),t)<0))return n=p.extend(this.get("data"),{_id:this.id}),i=new a[t](n,{bindByMatrix:!1}),o=e.success,e.success=(r=this,function(t){var e,n;if("function"==typeof o&&o(),e=null!=(n=r.collection)?n.parse([t])[0]:void 0)return e.status="",r.set(e)}),i.doFavorite(e),this},e.prototype.unFavorite=function(t,e){var n;if(!(d.call(p.keys(a),t)<0))return n=p.extend(this.get("data"),{_id:this.id}),new a[t](n).unFavorite(e),this},e}()},K57AZvoY:function(t,e,n){t.exports=function(t){var e="",i=n("2qRnoGmE");return e+='<ul class="list event-menu-list"> <li> <a class="copy-event-handler"> <span class="icon icon-copy"></span>'+tb_i18n.get("event.menu.copy")+" </a> </li> ",t.showShare&&i.FEATURES.thirdShare&&(e+=' <li> <a class="share-event-handler"> <div class="main-mode main-mode-title"> <span class="icon icon-wechat"></span> <span class="mode">'+tb_i18n.get("share.via.wechat")+"</span> ",t.isShared?e+=' <span class="ifClose">'+tb_i18n.get("share.link.open")+"</span> ":e+=' <span class="ifCloseDisabled">'+tb_i18n.get("share.link.closed")+"</span> ",e+=' </div> <div class="main-mode-description"> '+tb_i18n.get("share.via.wechat.description")+" </div> </a> </li> "),e+=" ",t.showInviteLink&&i.FEATURES.qrLinkInvite&&(e+=' <li> <a class="invite-handler"> <div class="main-mode main-mode-title"> <span class="icon icon-share-chain"></span> <span class="mode">'+tb_i18n.get("invite.from.link")+'</span> </div> <div class="main-mode-description"> '+tb_i18n.get("invite.from.link.description")+" </div> </a> </li> "),e+=" ",t.permissions.putMove&&(e+=' <li> <a class="move-event-handler"> <span class="icon icon-move-task"></span>'+tb_i18n.get("event.menu.move")+" </a> </li> "),e+=' <li> <a class="favorite-event-handler"> <span class="icon icon-favorite ',t.isFavorite&&(e+="favorited"),e+='"></span>',t.isFavorite?e+=""+tb_i18n.get("unfavorite"):e+=""+tb_i18n.get("favorite")+tb_i18n.get("navigation.event"),e+=" </a> </li> ",t.permissions.putArchive&&(e+=" <li> ",t.isArchived?e+=' <a class="unarchive-event-handler"> <span class="icon icon-archive"></span>'+tb_i18n.get("unarchive")+" </a> ":e+=' <a class="archive-event-handler"> <span class="icon icon-trash"></span>'+tb_i18n.get("archive")+" </a> ",e+=" </li> "),e+=" ",t.canModifyVisibility&&(e+=' <li class="divider"></li> <li> <a class="switch-visible-handler"></a> </li> '),e+="</ul>"}},KYwmZVTe:function(t,e){t.exports=function(t){var e='<ul class="list"> ';return t.permissions.put&&(e+=' <li> <a class="edit-tasklist-handler" data-gta="event" data-label="open tasklist editor"> <span class="icon icon-pencil"></span> '+tb_i18n.get("tasklist.menu.edit.title")+" </a> </li> "),e+=" ",t.permissions.put&&(e+=' <li> <a class="set-tasklist-task-field-config"> <span class="icon icon-cog"></span> '+tb_i18n.get("tasklist.menu.set.default.taskFieldConfig")+" </a> </li> "),e+=" ",t.isTaskflowProject||(e+=' <li> <a class="stage-template-handler" data-gta="event" data-label="create stage template"> <span class="icon icon-plus"></span> '+tb_i18n.get("tasklist.menu.add.templates")+" </a> </li> "),e+=" ",t.canCopyOrMove&&(e+=' <li> <a class="copy-tasklist-handler" data-action="fork" data-gta="event" data-label="open tasklist editor"> <span class="icon icon-copy"></span> '+tb_i18n.get("tasklist.menu.copy.title")+' </a> </li> <li> <a class="move-tasklist-handler" data-action="move" data-gta="event" data-label="open tasklist editor"> <span class="icon icon-move-task"></span> '+tb_i18n.get("tasklist.menu.move.title")+" </a> </li> "),e+=" ",t.permissions.putArchive&&t.tasklistCount>1&&(e+=' <li> <a class="archive-tasklist-handler" data-gta="event" data-label="archive tasklist"> <span class="icon icon-trash"></span> '+tb_i18n.get("archive")+" </a> </li> "),e+=" ",t.showPlaceholder&&(e+=' <li class="tasklist-placeholder"> '+tb_i18n.get("tasklist.menu.no.permission")+" </li> "),e+="</ul>"}},MKB6FaaL:function(t,e,n){var i,o,r,s,a,c,l,p,u,d,h,f,v,y,g,m,b,k,w={}.hasOwnProperty;y=n("a+N5u/Cl"),k=n("sa1Ed382"),c=n("HDJEOtNh").OrganizationAccess,u=n("GESwhXbR").Toast,m=n("RLD3BeS/"),d=m.ToastMessageWithUrl,h=m.ToastWithObject,l=n("6XSa3ffj"),v=n("OmupbwLD"),r=n("K57AZvoY"),o=n("+4sY5OxF"),i=n("4Yqmu9QS"),f=n("+h7VEZku").VisibilityController,p=n("H72dUcNY").ProjectSelectorWithHint,b=n("RTj5z5YX"),s=b.CommonShare,a=b.InviteLink,g=b.isReadonlyShare,t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)w.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,l),e.prototype.viewName="EventMenuView",e.prototype.popoverTitle="",e.prototype.events={"click .copy-event-handler":"forkEvent","click .move-event-handler":"moveEvent","click .favorite-event-handler":"favoriteEvent","click .share-event-handler":"shareEvent","click .archive-event-handler":"enterArchiveSubMenu","click .unarchive-event-handler":"unarchiveEvent","submit .archive-form":"archiveEvent","click .invite-handler":"enterInviteSubMenu"},e.prototype.initialize=function(t){return this._projectId=t.eventModel.get("_projectId"),this._organizationId=t._organizationId,this.projectModel=t.projectModel,this.eventModel=t.eventModel,this.popoverTitle=tb_i18n.get("event.menu.title"),this.listen(),e.__super__.initialize.apply(this,arguments)},e.prototype.listen=function(){return this.listenTo(this.eventModel,"change:visible",this.renderVisible)},e.prototype.render=function(){var t,e;return this.unmountReactViews(),e=this.options.eventModel,k.config.HOST,t=y.extend(e.toJSON(),{permissions:this.options.eventModel.hasPermissions("put","put.move","put.archive"),canModifyVisibility:this.options.eventModel.canModifyVisibility(),isShared:g(this.options.eventModel.get("shareStatus")),showShare:!!this._projectId,showInviteLink:!!this._projectId&&this.projectModel.hasPermission("post.member")&&Boolean(this._organizationId&&c.canAddOuterMember(this._organizationId))}),this.$el.html(r(t)),this.$visibleSwitchers=this.$(".switch-visible-handler"),this.renderVisible(),this._projectId&&this.setupPlugins({_projectId:this._projectId}),this},e.prototype.renderVisible=function(){if(this.options.eventModel.canModifyVisibility())return this.requestReactView(this.$visibleSwitchers.get(0),f,{visibility:this.eventModel.get("visible"),onChange:this.switchVisible.bind(this)})},e.prototype.forkEvent=function(){return this.copyOrMoveEvent("fork"),k.gta.event({action:"add content",control:"More Menu",type:"event"})},e.prototype.moveEvent=function(){return this.copyOrMoveEvent("move"),k.gta.event({action:"move content",control:"More Menu",type:"event"})},e.prototype.copyOrMoveEvent=function(t){var e,n,i,o;switch(t){case"fork":i=tb_i18n.get("fork.to.other.project"),e=tb_i18n.get("event.fork.hint"),n=!1;break;case"move":i=tb_i18n.get("move.to.other.project"),e=tb_i18n.get("event.move.hint"),n=!!this.eventModel.isIndie()}return this.enterSubMenu(i,(o=this,function(){return o.requestReactView(o.el,p,{_organizationId:o._organizationId,hideIndieEntry:n,excludes:"move"===t?[o._projectId]:void 0,classNames:"fork-move-project-list in-event-menu",objectType:"events",permission:"event.post",hint:e,hintStyle:{margin:"15px 0 -5px"},onConfirm:function(e){var n;return n="default"===e.id?{_organizationId:o._organizationId}:{_projectId:e.id},o.copyOrMoveCallback(n,t)},containerHeight:o.flexStaticMaxHeight})}))},e.prototype.copyOrMoveCallback=function(t,e){var n,i;return n=this.options.eventModel.get("title"),this.options.eventModel.forkOrMove(e,y.extend(t,{success:(i=this,function(t){var o,r;if(o=function(){switch(e){case"fork":return tb_i18n.get("event.menu.fork.success");case"move":return tb_i18n.get("event.menu.move.success")}}(),r=t._projectId?"/project/"+t._projectId+"/events/event/"+t._id:"/event/"+t._id,d.success({messageTitle:o,url:r,urlTitle:n}),k.gta.event({action:"fork"===e?"added content":"moved content",control:"More Menu",type:"event"}),"fork"===e)return i.hide()}),error:function(){var t;return t=function(){switch(e){case"fork":return tb_i18n.get("event.menu.fork.fail");case"move":return tb_i18n.get("event.menu.move.fail")}}(),u.error(t)}}))},e.prototype.enterArchiveSubMenu=function(){var t,e;return(t=this.options.eventModel).isRecurrenceEventInstance()?(this.parentView.requestSubView(v).open(i,{onConfirm:function(e){return t.archiveEvent(e).then(function(){return h.archive(),k.gta.event({action:"archive content",type:"event",control:"More Menu"})})}}),this.hide()):(this.enterSubMenu(tb_i18n.get("archive"),(e=this,function(){return e.$el.html(o())})),k.gta.event({action:"archive content",type:"event",control:"More Menu"})),this},e.prototype.archiveEvent=function(t){var e;return t.preventDefault(),this.options.eventModel.archive({success:(e=this,function(){return h.archive(),e.hide()})}),this},e.prototype.unarchiveEvent=function(){var t,e;return(t=this.options.eventModel).unarchive({success:(e=this,function(){return h.unarchive(t),k.gta.event({action:"unarchive content",type:"event",control:"More Menu"}),e.hide()})}),this},e.prototype.favoriteEvent=function(){var t,e;return t=this.options.eventModel.get("isFavorite"),this.options.eventModel[t?"unFavorite":"doFavorite"]({success:(e=this,function(n){var i;return e.options.eventModel.set("isFavorite",n.isFavorite),e.render(),!n.isFavorite&&e.options.onUnfavorite&&("function"==typeof(i=e.options).onUnfavorite&&i.onUnfavorite(e.options.eventModel.get("_id")),e.parentView.close()),k.gta.event({action:"favourite content",control:"More Menu",type:"event",category:t?"off":"on"})})}),this},e.prototype.shareEvent=function(){var t;return k.gta.event({action:"share content",control:"More Menu",type:"event"}),this.enterSubMenu(tb_i18n.get("share.via.wechat"),(t=this,function(){return t.requestReactView(t.el,s,{objectType:"event",model:t.options.eventModel})})),k.gta.event({action:"share content",control:"More Menu",type:"event"}),this},e.prototype.enterInviteSubMenu=function(){var t;return k.gta.event({action:"invite project member",control:"More Menu",type:"event"}),this.enterSubMenu(tb_i18n.get("invite.from.link"),(t=this,function(){return t.requestReactView(t.el,a,{objectType:"event",objectId:t.options.eventModel.id})})),this},e.prototype.switchVisible=function(t){return this.options.eventModel.saveAttr("visible",t),k.gta.event({action:"toggle visible",type:"event",control:"More Menu",category:"involves"===t?"on":"off"})},e.prototype.returnMainMenu=function(){return this.unmountReact(this.el),e.__super__.returnMainMenu.apply(this,arguments)},e.prototype.unmountReactViews=function(){if(this.$visibleSwitchers&&this.unmountReact(this.$visibleSwitchers.get(0)),this.el)return this.unmountReact(this.el)},e.prototype.onHidden=function(){return this.unmountReactViews(),e.__super__.onHidden.apply(this,arguments)},e}()},NqPR4Rud:function(t,e,n){"use strict";var i=n("mrSGxOB2"),o=n("q1tIBJhx"),r=n("wd/RKGTj"),s=n.n(r),a=n("TSYQbtd+"),c=n.n(a),l=n("tLZJUYWX"),p=n("XhpHwZVN"),u=n("Pm6yRo3w"),d=n("0ZfGkaWP"),h=n("EFIOe9De"),f=n("ob9kWEi7"),v=n("uQN6Cr2k").isProperType,y=n("3eMzznN/"),g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.d(e,t),e.prototype.renderCheckFrame=function(){return o.createElement(d.a,{checked:this.props.selected,disabled:this.props.isDisabled,onCheckClick:this.props.onSelectClick},o.createElement("div",{className:"list-item-content",onClick:this.props.onClick},this.renderContent(),this.renderInfo()))},e.prototype.renderInfo=function(){var t=this.getData(),e=t.fileSizeFix,n=t.creatorName,i=t.updated,r=t.updatedDateString,s=this.props.showCreator?o.createElement("span",{className:"info-creator"},n):null;return o.createElement("div",{className:"list-item-info"},o.createElement("span",{className:"info-size"},e),s,o.createElement("span",{className:"info-updated hinted","data-title":i},r))},e.prototype.renderContent=function(){return o.createElement("div",{className:"list-item-display"},this.renderThumbnail(),this.renderTitlebar())},e.prototype.render=function(){var t=c()("library-list-item","library-list-"+this.props.type);return o.createElement("li",{className:t},this.renderCheckFrame(),this.renderHandler())},e}(o.PureComponent),m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.extMatchType=function(){return v(e.props.item)},e.getName=function(){var t=e.props.item.fileName;if(e.props.isEditing&&e.extMatchType()){var n=t.split(".").pop()||"";t=t.substring(0,t.length-n.length-1)}return t},e.onSubmit=function(t){e.extMatchType()&&(t=t+"."+e.props.item.fileName.split(".").pop());return e.props.onSubmit(t)},e}return i.d(e,t),e.prototype.getData=function(){var t=this.props.item,e=y.formatFileSize(t.fileSize||0),n=t.creator&&t.creator.name,i=t.updated;s()(i).isSame("2014-02-11T06:30:00.000Z","day")&&(i=t.created);var o=y.formatDate(i,{isUsePref:!0}).dateString;return{fileSizeFix:e,creatorName:n,updated:s()(i).format("YYYY-MM-DD HH:mm"),updatedDateString:o}},e.prototype.renderThumbnail=function(){return o.createElement(p.WorkIcon,i.a({},this.props.item))},e.prototype.renderVisible=function(){return"involves"===this.props.item.visible&&o.createElement("span",{className:"icon icon-lock hinted","data-title":l.get("visible.to.involve")})},e.prototype.renderTitlebar=function(){return o.createElement(u.a,{name:this.getName(),onSubmit:this.onSubmit,editable:this.props.item.canModify,editing:this.props.isEditing,onEnterEditing:this.props.onEnterEditing,onClose:this.props.onQuitEditing,rootClass:"frame-content"},this.renderVisible())},e.prototype.renderHandler=function(){var t=this.props.item,e=t.canModify,n=t.canMove,i=t.canUpdate,r=t.canDownload,s=t.isFileLocalExist;return!this.props.isDisabled&&o.createElement(h.a,{type:"work",showDownload:r,showMove:n,showUpdate:i,showEdit:e,showMenu:!0,onMoveClick:this.props.onMoveClick,onEditClick:this.props.onEnterEditing,onOpenClick:this.props.onOpenClick,onDownloadClick:this.props.onDownloadClick,onUpdateClick:this.props.onUpdateClick,isFileLocalExist:s,onMenuOpen:this.props.onMenuOpen})},e}(g),b=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.d(e,t),e.prototype.getData=function(){var t=this.props.item;return{fileSizeFix:"-",creatorName:t.creator&&t.creator.name,updatedDateString:y.formatDate(t.updated,{isUsePref:!0}).dateString,updated:s()(t.updated).format("YYYY-MM-DD HH:mm")}},e.prototype.renderTitlebar=function(){return o.createElement(u.a,{name:this.props.item.title,onSubmit:this.props.onSubmit,editable:this.props.item.canModify,editing:this.props.isEditing,onEnterEditing:this.props.onEnterEditing,onClose:this.props.onQuitEditing,rootClass:"frame-content"})},e.prototype.renderHandler=function(){var t=this.props.item,e=t.canModify,n=t.canMove,i=t.canDownload,r=t.canArchive,s=t.canDelete,a=t.canChangeVisible;return!this.props.isDisabled&&o.createElement(h.a,{type:"collection",showUpdate:!1,showMove:n,showEdit:e,showMenu:e||r||s||a,showDownload:i,onDownloadClick:this.props.onDownloadClick,onMoveClick:this.props.onMoveClick,onEditClick:this.props.onEnterEditing,onMenuOpen:this.props.onMenuOpen})},e.prototype.renderThumbnail=function(){return o.createElement(p.CollectionIcon,i.a({},this.props.item))},e}(g),k=Object(f.a)(m,b),w=function(t){return o.createElement("div",{className:"library-list-collection-creator library-list-item"},o.createElement(d.a,{disabled:!0},o.createElement("div",{className:"list-item-content"},o.createElement("div",{className:"list-item-display"},Object(p.CollectionIcon)(),o.createElement(u.a,{creating:!0,onClose:t.onClose,onSubmit:t.onSubmit,rootClass:"library-list-collection-creator"})))))};n.d(e,"b",function(){return k}),n.d(e,"a",function(){return w}),n("BkEQiL1U")},OEc9sPz7:function(t,e,n){var i,o,r,s,a,c,l,p,u,d,h={}.hasOwnProperty;u=n("a+N5u/Cl"),c=n("wd/RKGTj"),l=n("3eMzznN/"),p=n("vmWJWrVe"),s=n("llwZnbxj"),r=n("IssmDVnT").EventSDK,a=n("L3Znt4sw"),o=n("o/BVWMhV"),i=n("6VSOqmo8"),d=n("gh8QIhMV").throwError,t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)h.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,p),e.prototype.viewName="PastEventsView",e.prototype.className="past-events-view accordion",e.prototype.events={"show.bs.collapse":"loadPastEvents","hidden.bs.collapse":"clearPastEvents"},e.prototype.initialize=function(t){return this.loadPastEventGroups()},e.prototype.loadPastEventGroups=function(){return this.showLoadingIndicator(this.$el,{isPrepend:!1}),l.promiseChain((t=this,function(){return!t.el}))(function(){return i.getEventGroups({endDate:c().startOf("day").toISOString()})},function(t){return function(e){return t.pastEventsGroups=e,t.hideLoadingIndicator(),t.renderBasic()}}(this)).catch(function(t){return d(t)});var t},e.prototype.renderBasic=function(){var t;return t=[],0,u.each(this.pastEventsGroups,function(e){if(e.count)return e.count,e.monthString=c(e.month,"YYYYMM").format(tb_i18n.get("moment.MMMMYYYY")),t.push(e)}),t.sort(function(t,e){return e.month-t.month}),this.$el.html(o({groups:t}))},e.prototype.loadPastEvents=function(t){var e,n,o,r;if(this.clearPastEvents(t),e=$(t.target),this.$eventList=e.find(".events-list"),n=e.data("month"),this.hideLoadingIndicator(),this.showLoadingIndicator(this.$eventList,{isPrepend:!1}),this.fromDate=c(n,"YYYYMM").startOf("month"),this.toDate=this.fromDate.clone().add(1,"month"),(o=c().startOf("day")).isBefore(this.toDate)&&(this.toDate=o),this.fromDate.isBefore(this.toDate))return this.currentMonth=n,l.promiseChain((r=this,function(){return!r.el||r.currentMonth!==n}))(function(t){return function(){return i.getMyEvents({startDate:t.fromDate.toISOString(),endDate:t.toDate.toISOString()})}}(this),function(t){return function(e){return t.hideLoadingIndicator(),t.renderEvents(e)}}(this)).catch(function(t){return d(t)})},e.prototype.renderEvents=function(t){var e,n,i;return(n=this.fromDate&&this.toDate&&t.map((i=this,function(t){return new r.Generator(t).takeFrom(i.fromDate.toDate(),i.toDate.toDate(),i.toDate.toDate())})).reduce(function(t,e){return t.concat(e)},[]).sort(function(t,e){return new Date(e.startDate)-new Date(t.startDate)}))||(n=[]),e=this.requestSubView(a,{isPastEvents:!0,eventsCollection:new s(n)}),this.$eventList.html(e.$el)},e.prototype.clearPastEvents=function(t){return $(t.target).find(".events-list").empty()},e}()},OZDTLQvo:function(t,e,n){var i,o,r,s={}.hasOwnProperty;n("t6Fy+YvB"),r=n("a+N5u/Cl"),o=n("XbrdCDrd"),i=n("nSCNZlGQ"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,o),e.prototype.viewName="MenuPluginView",e.prototype.className="menu-plugin",e.prototype.tagName="li",e.prototype.events={"click .plugin-handler":"onPluginClick"},e.prototype.render=function(){var t,e;return t=this.pluginModel.toJSON(),this.$el.html(i(r.extend({},t,{projectId:null!=(e=this.data)?e._id:void 0})))},e.prototype.onPluginClick=function(){return this.handle(this.pluginModel.toJSON(),this.data)},e}()},P8oS2WJf:function(t,e,n){var i,o,r,s,a,c,l,p,u,d,h,f,v,y={}.hasOwnProperty;f=n("a+N5u/Cl"),v=n("sa1Ed382"),d=n("3eMzznN/"),h=n("vmWJWrVe"),l=n("YdqH4v7N"),i=n("CDzwcJ2U"),p=n("oq1bWpp9"),r=n("1fU+e3+7"),u=n("ELMSE2ES"),c=n("HHtVDBJc"),o=n("x6JOqOc9"),s=n("B5ZbuE3m"),a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)y.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,h),e.prototype.viewName="MyRecentView",e.prototype.tagName="section",e.prototype.className="my-recent-view my-content-view fade",e.prototype.events={"click .task-content-set":"gtaShowTaskDetail","click .event":"showEventDetail","click .task-tag":"onClickTaskTag","click .event-tag":"onClickEventTag"},e.prototype.initialize=function(t){var e;return this.recentTasks={},this.options=f.extend({},t),this.setupScroll(this.options.$scrollElement||this.$el),this.api=i.create(),this.api.load(),this.render(),this.listen(),f.delay((e=this,function(){return e.$el.addClass("in")})),this},e.prototype.listen=function(){return this.listenTo(this.api,"merge remove",f.debounce((t=this,function(){return t.render()}),100));var t},e.prototype.render=function(){var t,e,n;if(this.$el){if("loaded"===this.api.state){for(t in e=this.recentTasks)null!=(n=e[t])&&n.remove();return this.recentTasks={},this.renderBasic(),this.renderTodayWorks(),this.renderTomorrowWorks(),this.renderNextDaysWorks()}return this.$el.empty(),this.showLoadingIndicator()}},e.prototype.renderBasic=function(){return this.$el.html(o()),this.$todayTasks=this.$(".today-tasks"),this.$tomorrowTasks=this.$(".tomorrow-tasks"),this.$futureTasks=this.$(".week-tasks"),this.$placeholder=this.$(".placeholder")},e.prototype.renderTodayWorks=function(){var t,e;return t=this.$todayTasks,e=this.api.getTodayWorks(),this.renderWorks(t,e)},e.prototype.renderTomorrowWorks=function(){var t,e;return t=this.$tomorrowTasks,e=this.api.getTomorrowWorks(),this.renderWorks(t,e)},e.prototype.renderNextDaysWorks=function(){var t,e;return t=this.$futureTasks,e=this.api.getNextDaysWorks(),this.renderWorks(t,e)},e.prototype.renderWorks=function(t,e){var n,i,o,r;for(t.show(),n=t.find(".task-list").empty(),i=0,o=e.length;i<o;i++)switch((r=e[i]).type||r.objectType){case"task":this.renderTask(n,r);break;case"event":this.renderEvent(n,r)}return this.refreshCount()},e.prototype.renderTask=function(t,e){var n;return(n=this.requestSubView(u,{model:new p(e,{bindByMatrix:!0}),isUseProjectName:!e.ancestorIds.length,noExecutor:!0})).$el.appendTo(t),this.recentTasks[e._id]=n},e.prototype.renderEvent=function(t,e){var n;return t.find("[data-id="+e._id+"]").remove(),n=d.parseEventDateString(e),t.append(s(n))},e.prototype.refreshCount=function(){var t,e,n,i,o;for(n=0,i=(o=[this.$(".today-tasks"),this.$(".tomorrow-tasks"),this.$(".week-tasks")]).length;n<i;n++)e=(t=o[n]).find(".task-view").length+t.find(".event").length,t.find(".count").text(e),t[e?"show":"hide"]();return e=this.$(".task-view").length+this.$(".event").length,$(".my-view .recent-count").text(e),$(".my-view .recent-count").trigger("setRecentCount",e),this.$placeholder[e?"hide":"show"]()},e.prototype.gtaShowTaskDetail=function(t){var e;return e=$(t.currentTarget),v.gta.event({action:"open detail",control:"Me Recent",series:e.data("series")||0,type:e.data("type")||"task"})},e.prototype.showEventDetail=function(t){var e,n,i;return v.gta.event({action:"open detail",type:"event",control:"Me Recent"}),e=$(t.currentTarget).data("id"),n=this.api.getById(e),c.isFakeEvent(n)&&(i=new r(c.resetEventId(n,{clone:!0}),{bindByMatrix:!1})),v.APP.openEventPreviewer(i||e),this},e.prototype.onClickTaskTag=function(t){return v.gta.event({action:"open detail",type:"project",control:"original project",category:"task"})},e.prototype.onClickEventTag=function(t){var e;return v.gta.event({action:"open detail",type:"project",control:"original project",category:"event"}),t.stopPropagation(),(e=$(t.currentTarget).data("id"))&&v.router.navigate("project/"+e+"/events",{trigger:!0}),this},e.prototype.remove=function(){return this.api.remove(),e.__super__.remove.apply(this,arguments)},e}(),f.extend(a.prototype,l),t.exports=a},PBoGXsPv:function(t,e,n){var i,o,r,s,a,c,l,p,u,d,h,f={}.hasOwnProperty;u=n("a+N5u/Cl"),l=n("3eMzznN/"),p=n("vmWJWrVe"),c=n("wd/RKGTj"),r=n("IssmDVnT").EventSDK,n("1fU+e3+7"),s=n("llwZnbxj"),a=n("L3Znt4sw"),d=n("zB/8RwQ+").getNextEventsFrom,o=n("CKx1hZTz"),i=n("6VSOqmo8"),h=n("gh8QIhMV").throwError,t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)f.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,p),e.prototype.viewName="FutrueEventsView",e.prototype.className="futrue-events-view",e.prototype.initialize=function(t){var e,n;return this.eventsCollection=new s,this.showLoadingIndicator(this.$el),e=c().startOf("day").toISOString(),l.promiseChain((n=this,function(){return!n.el}))(function(){return i.getMyEvents({endDate:e})},function(t){return function(n){return u.each(n,function(n){var i;return i=d(new r.Generator(n),c(e)),t.eventsCollection.add(i)})}}(this),function(t){return function(){return t.hideLoadingIndicator(),t.renderBasic()}}(this)).catch(function(t){return h(t)})},e.prototype.renderBasic=function(){return this.$el.html(o()),this.renderEvents()},e.prototype.renderEvents=function(){return this.eventsCollection.checkScopes(["today","future"]),this.requestSubView(a,{groupBy:!0,showGroupCount:!0,eventsCollection:this.eventsCollection}).$el.appendTo(this.$(".future-events"))},e}()},"PXZyboM/":function(t,e,n){},PdZWjpiS:function(t,e,n){var i,o,r,s,a,c,l,p,u,d,h,f,v,y,g=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};l=n("a+N5u/Cl"),h=n("sa1Ed382"),y=n("yiO17FlF"),i=n("q1z7EYOi"),s=n("wd/RKGTj"),r=n("bZr3G77e"),a=n("HHtVDBJc"),c=n("3eMzznN/"),o=n("IssmDVnT").EventSDK,u=function(t,e){return new Date(t.startDate)-new Date(e.startDate)},p=function(t,e,n,i){var o,r,a,c,l,p;return l=h.user.id,"task"===(t.type||t.objectType)?!t.isDone&&(t._executorId===l&&(t.startDate?(p=s(t.startDate).valueOf(),i?p<=n:e<=p&&p<=n):!!t.dueDate&&(o=s(t.dueDate).valueOf(),i?o<=n:e<=o&&o<=n))):(c=t.involveMembers||[],!(g.call(c,l)<0)&&(a=s(t.startDate).valueOf(),r=s(t.endDate).valueOf(),s().valueOf(),e<r&&a<n))},f=function(t){var e,n;return n=s().startOf("day").valueOf(),e=s().endOf("day").valueOf(),p(t,n,e,!0)},v=function(t){var e,n;return n=s().add(1,"day").startOf("day").valueOf(),e=s().add(1,"day").endOf("day").valueOf(),p(t,n,e)},d=function(t){var e,n;return n=s().add(2,"day").startOf("day"),e=s().add(6,"day").endOf("day"),p(t,n,e)},t.exports=function(){function t(){var t,e,n,o;for(l.extend(this,i.Events),this.state=null,this.datas={},t=0,e=(o=["task","event"]).length;t<e;t++)n=o[t],this.listenTo(y,":change:"+n,function(t){return this.mergeData(t.toJSON())}),this.listenTo(y,":destroy:"+n,function(t){var e;return e=t.get("type")||t.get("objectType"),this.removeData(t.id,"event"===e)}),this.listenTo(y,":new:"+n,function(t){return this.mergeData(t.toJSON())})}return t.prototype.load=function(t){var e,n;return this.state?"function"==typeof t?t():void 0:(e=s().add(7,"day").endOf("day").toISOString(),this.setState("loading"),r.ajax("users/recent",{data:{dueDate:e},headers:{"x-timezone":r.timezone()},success:(n=this,function(t){return n.setState("loaded"),n.mergeDatas(t)}),error:function(t){return function(){return t.setState("error")}}(this)}))},t.prototype.removeFakeEvents=function(t){var e,n,i,o;for(n in o=[],i=this.datas)(null!=(e=i[n])?e._originEventId:void 0)===t?o.push(this.datas[n]=null):o.push(void 0);return o},t.prototype.mergeDatas=function(t){var e,n,i;for(n=0,i=t.length;n<i;n++)e=t[n],this.doMerge(e);return this.trigger("merge",t)},t.prototype.mergeData=function(t){return this.doMerge(t),this.trigger("merge",t)},t.prototype.doMerge=function(t){var e,n,i,r,s,c;if(null!=t?t._id:void 0){if("event"===(c=t.type||t.objectType)&&(t=o.marshaler.parsePatch(t,this.datas[t._id])),"event"===c&&o.isRecurrent(t)){for(this.datas[t._id]=null,this.removeFakeEvents(t._id),s=[],i=0,r=(n=a.fakeWeek([t])).length;i<r;i++)e=n[i],s.push(this.doMergeOne(e));return s}return this.doMergeOne(t)}},t.prototype.doMergeOne=function(t){var e,n,i;return e=this.datas[t._id]||{},!(null!=(n=(i=l.extend({},e,t)).task)?n._id:void 0)&&e.task&&(i.task=e.task),this.datas[t._id]=i},t.prototype.removeData=function(t,e){var n;return this.datas[t]=null,e&&this.removeFakeEvents(t),l.values(this.datas).forEach((n=this,function(e){var i;if((null!=e&&null!=(i=e.task)?i._id:void 0)===t)return n.datas[e._id]=null})),this.trigger("remove",t)},t.prototype.setState=function(t){return this.state=t},t.prototype.getTodayWorks=function(){return this.getWorksByFilter(f)},t.prototype.getTomorrowWorks=function(){return this.getWorksByFilter(v)},t.prototype.getNextDaysWorks=function(){return this.getWorksByFilter(d)},t.prototype.getWorksByFilter=function(t){var e,n,i,o,r,s;for(i in r=[],s=[],n=[],o=this.datas)(e=o[i])&&!e.isArchived&&t(e)&&("event"===(e.type||e.objectType)?n.push(l.clone(e)):s.push(l.clone(e)));return s.sort(c.compareTask).map(function(t){return r.push(t)}),n.sort(u).map(function(t){return r.push(t)}),r},t.prototype.getById=function(t){return this.datas[t]},t.prototype.remove=function(){return this.stopListening()},t}()},Q64OfkAh:function(t,e){t.exports=function(t){var e,n,i="undefined"!=typeof _encodeHTML?_encodeHTML:(e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},n=/&(?!#?\w+;)|<|>|"|'|\//g,function(t){return t?t.toString().replace(n,function(t){return e[t]||t}):""}),o='<a class="plugin-handler app" data-app="'+i(t.appName)+'" data-plugin-id="'+i(t._pluginId)+"\" data-gta=\"{action: 'use plugin', control: '"+i(t.type)+"', pluginid: '"+i(t._pluginId)+"', projectid: '"+i(t.projectId)+"'}\"> "+i(t.name)+"</a>";return t.unreadCount&&t.pushStatus?(o+=' <span class="nav-badge" data-mark="activity">',t.unreadCount>99?o+="99+":o+=""+t.unreadCount,o+="</span>"):t.unreadCount&&(o+=' <span class="nav-badge" data-mark="activity"></span>'),o}},RFllHK7R:function(t,e,n){var i,o,r,s,a,c,l,p,u,d,h,f,v,y,g,m,b,k,w,_,M,C=function(t,e){return function(){return t.apply(e,arguments)}},S={}.hasOwnProperty;w=n("a+N5u/Cl"),_=n("sa1Ed382"),f=n("GESwhXbR").Toast,o=n("/e+Ob7oW"),h=n("HYobN8SQ"),g=n("3eMzznN/"),m=n("vmWJWrVe"),v=n("RLD3BeS/").ToastMessageWithUrl,p=n("Rb7YhHxV"),s=n("odY26VIi"),d=n("nL4olqOP"),y=n("eubUSX4T"),u=n("2NlL4uak"),r=n("vNWLjLJF"),c=n("aePTiwey"),l=n("9Nam0gw1"),k=n("o4N9kv/m"),a=n("qKYkuTVR"),b=n("+h7VEZku").VisibilityController,i=n("/VuqkkbT"),M=n("gh8QIhMV").throwError,t.exports=function(t){function e(){return this.enableSubmit=C(this.enableSubmit,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)S.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,m),e.prototype.className="post-creator modal-dialog creator-view",e.prototype.events={"click .creator-location-handler":"showLocationSelector","click .submit-handler":"submit","input .post-title-input":"titleInputChangeHandler","change .post-title-input":"cachePost","keydown .post-creator-editor-wrap":"quickSubmit","click .creator-close":"close","click .restore-draft":"restoreDraft","click .discard-draft":"discardDraft"},e.prototype.saveAttrs=["_projectId","_creatorId","involveMembers","involveTeams","involveGroups","involveAllProjectMembers","content","postMode","title","visible","attachments"],e.prototype.initialize=function(t){var e,n,i,o,r,s;return this.options=t,this.isStatic=t.isStatic,this.isWorkspace=t.isWorkspace,this.isEdit=!!t.postModel,(e=null!=(i=t.parentView)?i.$el:void 0)&&e.hasClass("modal")&&e.css("display","block"),this.projectsCollection=d.get(0),this.options._projectId?this.projectModel=this.projectsCollection.get(t._projectId):this.projectModel=_.APP.getClosestProject(),(null!=(o=this.projectModel)?o.isAppEnabled("posts"):void 0)||(this.projectModel=d.get(0).find(function(t){return t.isAppEnabled("posts")})),this.projectModel?(this.isEdit?this.postMode=null!=(r=t.postModel)?r.get("postMode"):void 0:this.postMode=t.postMode,"md"!==this.postMode&&(this.postMode="html"),"md"===this.postMode?this.postType="markdown":this.postType="normal",this.localCache=h.namespace("temp").namespace("posts_wall"),this.isEdit||(this.localCacheId="post_creator_"+this.projectModel.id),n=this.localCache(this.localCacheId),!this.isEdit&&n&&n._id&&this.clearCache(),this.load({success:(s=this,function(){return s.reset(),s.renderBasic(),s.initUploader(),s.renderLoaction(),s.renderEditor(),s.renderInvolve(),s.renderVisible(),s.listen(),s.bindRefreshAndCloseAlert(),w.delay(function(){if(s.$el)return s.$footerFixed.addClass("on-fixed")},300)})}),this):this.close()},e.prototype.load=function(t){return null==t&&(t={}),s.find(this.projectModel.id)?"function"==typeof t.success?t.success():void 0:s.fetch(this.projectModel.id,{success:function(){return"function"==typeof t.success?t.success():void 0},error:function(t,e){return M(e),this.close()}})},e.prototype.reset=function(){var t,e;return this.membersCollection=s.get(this.projectModel.id),this._defaultCollectionId=this.projectModel.get("_defaultCollectionId"),this.isEdit?this.postModel=this.options.postModel.clone():((t=w.extend({_creatorId:_.user.id,involveMembers:[_.user.id],content:"",title:"",visible:"members",attachments:[]},this.localCache(this.localCacheId),{_projectId:this.projectModel.id})).involveMembers=w.filter(t.involveMembers,(e=this,function(t){return!!e.membersCollection.get(t)})),t.postMode!==this.postMode&&(t.content="",t.postMode=this.postMode),this.postModel=new p(t)),this.attachments=new y(this.postModel.get("attachments"),{_boundToObjectId:this._defaultCollectionId}),this.listen()},e.prototype.listen=function(){return this.listenTo(this.attachments,"change:downloadUrl remove",this.cachePost),this.listenTo(this.postModel,"change",this.cachePost),this.listenTo(this.postModel,"change:visible",this.renderVisible),this},e.prototype.renderBasic=function(){return"md"===this.postMode&&this.$el.addClass("markdown-mode"),this.$el.addClass(tb_i18n.getLanguage()),this.$el.html(i({hasMemCache:this.postModel.getMemCache(),isEdit:this.isEdit,isStatic:this.isStatic,postMode:this.postMode,title:this.postModel.get("title")||"",sourceName:this.getSourceName()})),this.$location=this.$(".creator-location"),this.$submit=this.$(".submit-handler"),this.$titleInput=this.$(".post-title-input"),this.$visibleTitle=this.$(".visible-title"),this.$involveWrap=this.$(".involve-set"),this.$editorWrap=this.$(".post-creator-editor-wrap"),this.$visibleSwitchers=this.$(".creator-visible"),this.$footerFixed=this.$(".post-creator-footer-fixed"),this.checkSubmitState(),this},e.prototype.initUploader=function(){return this.requestSubView(k,{targetModel:this.projectModel,collection:this.attachments,dnd:this.$editorWrap,paste:this.$editorWrap})},e.prototype.renderLoaction=function(){var t;return t=this.projectModel.toJSON(),this.$location.text(t.name),this},e.prototype.renderHtmlOrMdEdit=function(){var t,e,n;return e="html"===this.postMode?"html":"content",t="md"===this.postMode?l:c,this.postEditorView=this.requestSubView(t,{_projectId:this.projectModel.id,content:this.postModel.get(e),attachments:this.attachments,onchange:(n=this,function(t){return n.postModel.set("content",t),n.checkSubmitState()})})},e.prototype.renderEditor=function(){var t;return null!=(t=this.postEditorView)&&t.remove(),this.postEditorView=this.renderHtmlOrMdEdit(),this.$editorWrap.html(this.postEditorView.$el),this},e.prototype.renderInvolve=function(){return this.requestSubView(r,{_projectId:this.projectModel.id,objectModel:this.isEdit?this.options.postModel:this.postModel,resident:[_.user.id],where:this.isEdit?"editor":"creator",enableInvite:this.projectModel.hasPermission("post.member")}).$el.prependTo(this.$involveWrap.empty()),this},e.prototype.renderVisible=function(){return this.requestReactView(this.$visibleSwitchers.get(0),b,{visibility:this.postModel.get("visible"),onChange:this.switchVisible.bind(this)})},e.prototype.switchVisible=function(t){return this.postModel.set({visible:t}),_.gta.event({action:"toggle visibility",type:"post",vontrol:"New Post"})},e.prototype.getProjectList=function(){return this.projectsCollection.getGroupListByStared({isWorkspace:this.isWorkspace,checkAppEnabled:"posts"})},e.prototype.getSourceName=function(){var t;return t=this.postModel.get("source"),function(){switch(t){case"teambition":return"md"===this.postMode?tb_i18n.get("wall.view.markdown.post"):tb_i18n.get("wall.view.html.post");case"shimo":return tb_i18n.get("powerups.shimo");default:return""}}.call(this)},e.prototype.showLocationSelector=function(t){var e,n,i;return(e=$(t.currentTarget)).data("bs.popover")||this.requestSubView(a,{container:this.$el,$toggler:e,searchPlaceholder:tb_i18n.get("task.menu.search.project"),dataList:this.getProjectList(),selected:(null!=(n=this.projectModel)?n.id:void 0)||"",select:(i=this,function(t){var e,n;if(t!==(null!=(e=i.projectModel)?e.id:void 0))return null!=(n=i.postEditorView)&&n.setProjectId(t),i.projectModel=i.projectsCollection.get(t),s.fetch(i.projectModel.get("_id"),{success:function(t){if(i.$el)return i.reset(),i.cachePost(),i.renderLoaction(),i.renderInvolve()}})})}).show(),this},e.prototype.restoreDraft=function(){var t;return(t=this.postModel.getMemCache()||{}).title&&this.$titleInput.val(t.title).focusAtEnd(),t.content&&this.postEditorView.set(t.content).focus(),this.postModel.clearMemCache(),this.$(".draft").remove(),this},e.prototype.discardDraft=function(){return this.postModel.clearMemCache(),this.$(".draft").remove(),this},e.prototype.quickSubmit=function(t){return 13===t.keyCode&&(t.ctrlKey||t.shiftKey||t.metaKey)&&(t.preventDefault(),this.submit()),this},e.prototype.submit=function(){var t;if(!this.submitLock){if(!(t=this.attachments.getUploadingCount()))return this.disableSubmit(),this.postModel.get("content")?(this.isEdit?this.updatePost():(_.gta.event({action:"added content",type:"post",control:this.options.gta_from||"Add Post",method:this.postType}),this.createPost()),this):this.postEditorView.focus();f.warning({message:tb_i18n.get("works.uploader.uploading.total",t)})}},e.prototype.createPost=function(){var t,e;return t=this.getPostAttrs(),this.createAttachments().then((e=this,function(n){return t.attachments=n,e.postModel.save(null,{attrs:t,wait:!0,error:function(){return e.enableSubmit(),e.postEditorView.focus()},success:function(t){var n,i;return e.enableSubmit(),e.clearCache(),e.stopListening(),null!=(i=u.find(t.get("_projectId")))&&i.add(t.toJSON()),!1!==e.options.isEssage&&v.success({messageTitle:tb_i18n.get("create.post.success"),url:"/project/"+t.get("_projectId")+"/posts/post/"+t.id,urlTitle:t.get("description")}),"function"==typeof(n=e.options).onsave&&n.onsave(t),e.close()}})})),this},e.prototype.updatePost=function(){var t,e;return t=w.omit(this.getPostAttrs(),"involveMembers"),this.createAttachments().then((e=this,function(n){var i;return e.options.postModel.set(t),(i=e.options.postModel.changed).attachments=n,i.visible&&e.updatePostVisible(i.visible),e.options.postModel.save(null,{wait:!0,attrs:i,success:function(t){var n;return e.enableSubmit(),e.postModel.clearMemCache(),"function"==typeof(n=e.options).onsave&&n.onsave(t),e.close()}})})),this},e.prototype.updatePostVisible=function(t){return this.options.postModel.saveAttr("visible",t)},e.prototype.createAttachments=function(t){return new Promise((e=this,function(t,n){return e.attachments.length?e.attachments.addWorks(e.attachments.toJSON(),{_parentId:e._defaultCollectionId,_projectId:e.projectModel.id,success:t,error:function(t,e){return n(e)}}):t()})).then(function(t){return function(e){return w.chain(t.attachments.toJSON()).pluck("_id").compact().union(w.pluck(e,"_id")).value()}}(this)).catch(function(t){return M(t)});var e},e.prototype.titleInputChangeHandler=function(){return this.checkSubmitState(),this},e.prototype.checkSubmitState=function(){var t,e;return e=this.$titleInput.val().trim(),t=this.postModel.get("content"),e.length&&t.length?this.enableSubmit():this.disableSubmit(),this},e.prototype.disableSubmit=function(){return this.submitLock=!0,this.$submit.prop("disabled",!0),this},e.prototype.enableSubmit=function(){return this.submitLock=!1,this.$submit.prop("disabled",!1),this},e.prototype.getPostAttrs=function(){var t;return t=w.extend(this.postModel.toJSON(),{title:this.$titleInput.val().trim()||this.getTitleFromContent(),content:this.postEditorView.get()}),w.pick(t,this.saveAttrs)},e.prototype.getTitleFromContent=function(){var t;return t=this.postModel.get("content"),t="html"===this.postMode?w.unescape(t):o(t),t=$("<div>"+t+"</div>").text().trim(),g.cutString(t,120,"...")||tb_i18n.get("post.un.title")},e.prototype.cachePost=function(){var t,e,n,i;return this.localCacheId?(e=w.extend(this.postModel.toJSON(),{title:this.$titleInput.val().trim(),attachments:this.attachments.toJSON().map(function(t){return w.omit(t,"thumbnail")})}),this.localCache(this.localCacheId,e)):(t=null!=(n=this.postEditorView)?n.get():void 0,i=this.$titleInput.val(),t===this.options.postModel.get("content")&&i===this.options.postModel.get("title")||this.postModel.setMemCache({content:t,title:this.$titleInput.val()})),this},e.prototype.clearCache=function(){return this.localCacheId&&this.localCache.remove(this.localCacheId),this},e.prototype.windowBeforeunload=function(t){return t||(t=window.event),t.returnValue=tb_i18n.get("leave.page.alert"),t.returnValue},e.prototype.bindRefreshAndCloseAlert=function(){return window.addEventListener("beforeunload",this.windowBeforeunload,!1)},e.prototype.unbindRefreshAndCloseAlert=function(){return window.removeEventListener("beforeunload",this.windowBeforeunload,!1)},e.prototype.onOpen=function(){return this.$titleInput.focusAtEnd(),this},e.prototype.onscroll=function(){var t;return null!=(t=this.postEditorView)&&"function"==typeof t.checkFixed?t.checkFixed():void 0},e.prototype.close=function(){var t,e;return this.$(".on-fixed").hide(),null!=(null!=(t=this.parentView)?t.close:void 0)?this.parentView.close():null!=(e=this.parentView)&&e.remove(),this},e.prototype.remove=function(){var t;return"function"==typeof(t=this.options).oncancel&&t.oncancel(),this.unbindRefreshAndCloseAlert(),e.__super__.remove.apply(this,arguments)},e}()},"RO++zyUi":function(t,e,n){var i,o,r={}.hasOwnProperty;o=n("zBkMzjyh"),i=n("OZDTLQvo"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,o),e.prototype.pluginType="plugin_for_entry",e.prototype.createPlugin=function(t){var e,n;return n=this.onPluginHandle.bind(this),e=this.view.entryModel.toJSON(),this.requestSubView(i,{view:this.view,pluginModel:t,data:e,onPluginHandle:n})},e.prototype.onPluginHandle=function(){return this.view.hide()},e}()},TEHCgK4p:function(t,e,n){t.exports={hint:"hint__10PY"}},THzQ0rgs:function(t,e){t.exports=function(t){return'<form class="archive-form"> <p>'+tb_i18n.get("post.menu.confirm.archive")+'</p> <button class="btn btn-danger" type="submit">'+tb_i18n.get("archive")+"</button></form>"}},TfBVyIQA:function(t,e,n){t.exports=function(t){var e="",i=n("2qRnoGmE");return e+='<ul class="list post-menu-view"> ',t.conditionalRender.editHandler&&(e+=' <li> <a class="edit-handler" ',t.refer&&(e+=' data-post-refer="'+t.refer+'" data-post-url="'+t.postUrl+'" '),e+='> <span class="icon icon-pencil"></span>'+tb_i18n.get("post.menu.edit")+" </a> </li> "),e+=" ",t.conditionalRender.pinHandler&&(e+=' <li> <a class="pin-handler ',t.pin||(e+="unpin"),e+='"> <span class="icon icon-pin"></span>',t.pin?e+=""+tb_i18n.get("post.menu.unpin.title"):e+=""+tb_i18n.get("post.menu.pin.title"),e+=" </a> </li> "),e+=" ",t.conditionalRender.copyHandler&&(e+=' <li> <a class="copy-handler"> <span class="icon icon-copy"></span>'+tb_i18n.get("post.menu.copy")+" </a> </li> "),e+=" ",t.conditionalRender.shareHandler&&(e+=' <li> <a class="share-post-handler"> <div class="main-mode main-mode-title"> <span class="icon icon-wechat"></span> <span class="mode">'+tb_i18n.get("share.via.wechat")+"</span> ",t.isShared?e+=' <span class="ifClose">'+tb_i18n.get("share.link.open")+"</span> ":e+=' <span class="ifCloseDisabled">'+tb_i18n.get("share.link.closed")+"</span> ",e+=' </div> <div class="main-mode-description"> '+tb_i18n.get("share.via.wechat.description")+" </div> </a> </li> "),e+=" ",t.showInviteLink&&i.FEATURES.qrLinkInvite&&(e+=' <li> <a class="invite-handler"> <div class="main-mode main-mode-title"> <span class="icon icon-share-chain"></span> <span class="mode">'+tb_i18n.get("invite.from.link")+'</span> </div> <div class="main-mode-description"> '+tb_i18n.get("invite.from.link.description")+" </div> </a> </li> "),e+=" ",t.conditionalRender.moveHandler&&(e+=' <li> <a class="move-handler"> <span class="icon icon-move-task"></span>'+tb_i18n.get("post.menu.move")+" </a> </li> "),e+=' <li> <a class="favorite-post-handler" data-gta="event" data-label="post detail|favorite post"> <span class="icon icon-favorite ',t.isFavorite&&(e+="favorited"),e+='"></span>',t.isFavorite?e+=""+tb_i18n.get("unfavorite.post"):e+=""+tb_i18n.get("favorite.post"),e+=" </a> </li> ",t.conditionalRender.archiveHandler&&(e+=" <li> ",t.isArchived?e+=' <a class="unarchive-handler" data-gta="event" data-label="unarchive post"> <span class="icon icon-archive"></span>'+tb_i18n.get("unarchive")+" </a> ":e+=' <a class="archive-handler" data-gta="event" data-label="archive post"> <span class="icon icon-trash"></span>'+tb_i18n.get("archive")+" </a> ",e+=" </li> "),e+=" ",t.conditionalRender.switchVisibleHandler&&(e+=' <li class="divider"></li> <li> <a class="switch-visible-handler"></a> </li> '),e+="</ul>"}},"UpxbwU5/":function(t,e,n){"use strict";n.r(e),n.d(e,"BackboneView",function(){return a}),n.d(e,"PluginsContainer",function(){return c});var i=n("mrSGxOB2"),o=n("vmWJWrVe"),r=n.n(o),s=n("u//1fy1x"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.d(e,t),e.prototype.initialize=function(t){this.props=t,this.stageData=i.a({},t.stage),this.render().setupPlugins({_projectId:t.projectId})},e.prototype.hide=function(){this.props.onHide()},e.prototype.render=function(){return this.$el.html('<ul class="list"></ul>'),this},e}(r.a);a.prototype.className="stage-menu-plugins-container";var c=Object(s.default)(a)},"UzGj+rmU":function(t,e,n){var i,o,r={}.hasOwnProperty;o=n("zBkMzjyh"),i=n("OZDTLQvo"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,o),e.prototype.pluginType="plugin_for_stage",e.prototype.createPlugin=function(t){var e,n;return n=this.onPluginHandle.bind(this),e=this.view.stageData,this.requestSubView(i,{view:this.view,pluginModel:t,data:e,onPluginHandle:n})},e.prototype.onPluginHandle=function(){return this.view.hide()},e}()},V6kXVEK8:function(t,e){t.exports=function(t){return'<form class="entry-archive-form"> <p>'+tb_i18n.get("entry.menu.archive.tips")+'</p> <button class="btn btn-danger" type="submit">'+tb_i18n.get("archive")+"</button></form>"}},VHLhWugQ:function(t,e,n){var i,o,r,s,a,c,l,p,u,d,h,f,v,y={}.hasOwnProperty;h=n("a+N5u/Cl"),v=n("sa1Ed382"),c=n("YdqH4v7N"),p=n("vmWJWrVe"),l=n("GESwhXbR").Toast,r=n("AmP5WYKx"),a=n("PCjZn8k4"),u=n("OmupbwLD"),o=n("dLEQ9ek+"),i=n("AE3SznHA"),d=n("XhpHwZVN").WorkIcon,f=function(){return{task:tb_i18n.get("navigation.task"),post:tb_i18n.get("navigation.sharing"),work:tb_i18n.get("navigation.work"),event:tb_i18n.get("navigation.event"),entry:tb_i18n.get("bookkeeping")}},s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)y.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,p),e.prototype.viewName="FavoritesView",e.prototype.className="favorites-view my-content-view float-view",e.prototype.events={"click .type-item":"filterType","keyup .search-input":"searchFavorite","input .search-input":"onInput","click .favorite-item":"openDetail","click .unfavorite":"unFavorite"},e.prototype.initialize=function(t){var e;return this.options=t||{},this.url="favorites",this.attrs={q:this.query,type:t.type},this.collection=r.get(0),this.renderBasic(),h.delay((e=this,function(){return e.$el.addClass("in")})),this},e.prototype.renderBasic=function(){var t,e,n;return n=f(),e=(t=this.options.type)?n[t]:tb_i18n.get("favorites.all"),this.$el.html(i({type:t,typeName:e})),this.$body=this.$(".favorites-body"),this.$list=this.$(".favorites-list"),this.fetchData(),this},e.prototype.fetchData=function(){return this.load({silent:!0,url:this.url,attrs:this.attrs,beforeSend:(t=this,function(){return t.showLoadingIndicator(t.$list)}),success:function(t){return function(e){if(t.hideLoadingIndicator(),t.renderResults(),t.collection.hasMore)return t.setupScroll(t.$body)}}(this)});var t},e.prototype.renderResult=function(t){return t.forEach((e=this,function(t){return e.$list.append(e.requestSubView(o,{model:t}).$el)}));var e},e.prototype.renderResults=function(t){var e,n,i,o,s;return this.$reactLinkedFileIcons&&this.$reactLinkedFileIcons.each((s=this,function(t,e){return s.unmountReact(e)})),e=t&&null!=(null!=(o=t.results)?o.length:void 0)?new r(t):this.collection,this.renderResult(e),i=this.$(".search-input").val().trim(),n=this.attrs.source&&0===e.length&&""!==i,this.$body[n?"addClass":"removeClass"]("no-result"),this.$body.find(".search-placeholder-content").text(tb_i18n.get("search.no.result",i)),this.renderFileIcon(),this},e.prototype.load=function(t){return this.collection.resetSoft(),this.collection.fetch(t),this},e.prototype.loadMore=function(t){var e;return this.collection.loadMore({silent:!0,url:this.url,attrs:this.attrs,beforeSend:(e=this,function(){return e.showLoadingIndicator(e.$list)}),success:function(e){return function(n,i,o){var r;if(e.$el)return e.hideLoadingIndicator({animated:!0}),(null!=(r=i.results)?r.length:void 0)&&e.renderResults(i),e.collection.hasMore&&"function"==typeof t?t():void 0}}(this)}),this},e.prototype.renderFileIcon=function(){return this.$reactLinkedFileIcons=this.$(".react-file-item"),this.$reactLinkedFileIcons.each((t=this,function(e,n){return t.unmountReact(n),t.requestReactView(n,d,{fileType:$(n).data("type")})}));var t},e.prototype.filterFavorites=function(t){return this.attrs=h.extend(this.attrs,t),this.$list.html(""),this.fetchData(),this},e.prototype.filterType=function(t){var e,n,i;return i=f(),(e=$(t.currentTarget)).siblings("li").removeClass("active"),e.addClass("active"),n=e.data("type"),this.$(".active-type").text(n?i[n]:tb_i18n.get("favorites.all")),this.filterFavorites({type:n}),this},e.prototype.searchFavorite=function(t){var e;return(e=$(t.currentTarget).val().trim())&&13===t.keyCode&&(this.url="favorites/me/search",this.filterFavorites({q:e,source:"search"})),this},e.prototype.onInput=function(t){return $(t.currentTarget).val().trim()||"favorites"===this.url||(this.url="favorites",this.filterFavorites()),this},e.prototype.unFavorite=function(t){var e,n,i,o;if(n=$(t.currentTarget),i=(e=n.closest(".favorite-item")).data("id"),o=e.data("type"),i)return t.stopPropagation(),this.collection.get(i).unFavorite(o,{success:function(){return e.next(".underscore").remove(),e.remove(),l.success({message:tb_i18n.get("favorites.unfavorite.success")})}}),this},e.prototype.openDetail=function(t){var e,n,i,o,r,s;if((e=$(t.currentTarget),!this.$(".type-filter").hasClass("open"))&&(n=e.data("id"),o=e.data("type"),v.gta.event({action:"open detail",type:o,control:"Me Favourites"}),n))return i=this.collection.get(n),e.hasClass("not-visible")?l.warning({message:tb_i18n.get("favorites.not.visible")}):("work"===o?(r=i.get("_refId"),v.APP.openWorksPreviewer(r,[r],{onUnfavorite:(s=this,function(t){return s.onUnfavorite(t)})})):this.requestSubView(u).open(a,{objectType:o,objectId:n,_projectId:i.get("_projectId"),onUnfavorite:function(t){return function(e){return t.onUnfavorite(e)}}(this)}),this)},e.prototype.onUnfavorite=function(t){var e;return(e=this.$(".favorite-item[data-id='"+t+"']")).next(".underscore").remove(),e.remove()},e}(),h.extend(s.prototype,c),t.exports=s},WBka3RlP:function(t,e){t.exports=function(t){var e='<div class="my-header row-flex"> <section class="my-tab-wrap"> ',n=t.tabs;if(n)for(var i,o=-1,r=n.length-1;o<r;){e+=" ";var s=(i=n[o+=1]).name;e+=' <a class="my-tab my-'+s+'-handler" data-type='+s+' data-gta="{action: select '+s+'}"> <span class="my-tab-tip">'+tb_i18n.get(i.lang)+"</span> </a> "}return e+=' </section> <a class="close-float-handler"> <span class="icon icon-remove"></span> </a></div><div class="my-content-wrap"> <div class="my-content card my-wrap"></div></div>'}},WOtenH8b:function(t,e,n){},Xl2NRDob:function(t,e,n){var i,o,r,s,a,c,l,p,u={}.hasOwnProperty;l=n("a+N5u/Cl"),r=n("8yf6doCl").Subject,p=n("9558JHAV"),c=n("vmWJWrVe"),s=n("oq1bWpp9"),a=n("ELMSE2ES"),o=n("5S+Vx6yD"),i=n("2NbHbpfv"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,c),e.prototype.viewName="MyTasksBasicTasks",e.prototype.className="task-list my-list",e.prototype.tagName="ul",e.prototype.dueDate=null,e.prototype.initialize=function(){return this.taskViews={},this.createAPI(i),this.api.load(),this.render(),this.listen(),this._hasMore$$=new r},e.prototype.createAPI=function(t){return this.api=new t},e.prototype.listen=function(){var t;return this.listenTo(this.api,"changeState",(t=this,function(e){if(t.render(),"loaded"===e)return t._hasMore$$.next(t.api.hasMore())})),this.listenTo(this.api,"merge",l.debounce(function(t){return function(){return t.render()}}(this),100))},e.prototype.render=function(){var t,e;if(this.$el)return"loading"!==(t=this.api.state)&&"loadingMore"!==t?(this.hideLoadingIndicator(),e=this.api.getWorksByFilter(this.getTaskFilter()),this.removeTaskViews(),e.length?(e=p.sortTask(e),this.$el.empty(),this.renderList(e)):this.$el.html(o())):this.$(".loading-indicator").length?void 0:this.showLoadingIndicator()},e.prototype.renderList=function(t,e){var n,i,o,r;for(o=[],n=0,i=(t=p.sortTask(t)).length;n<i;n++)r=t[n],o.push(this.renderTask(r,e));return o},e.prototype.renderTask=function(t,e){var n;return e||(e=this.$el),n=this.requestSubView(a,{model:new s(t,{bindByMatrix:!0}),isUseProjectName:!t.ancestorIds.length,noExecutor:p.isTodoFilterType()}),this.taskViews[t._id]=n,n.$el.appendTo(e)},e.prototype.removeTaskViews=function(){var t,e,n;for(t in e=this.taskViews)null!=(n=e[t])&&"function"==typeof n.remove&&n.remove();return this.taskViews={}},e.prototype.loadMore=function(){if(this.api.hasMore())return this.api.loadMore()},e.prototype.observeHasMore=function(){return this._hasMore$$.asObservable()},e.prototype.getTaskFilter=function(){return function(){return!0}},e.prototype.remove=function(){return this.api.remove(),this._hasMore$$.complete(),e.__super__.remove.apply(this,arguments)},e}()},aePTiwey:function(t,e,n){var i,o,r,s,a,c,l,p,u,d,h,f=function(t,e){return function(){return t.apply(e,arguments)}},v={}.hasOwnProperty;p=n("a+N5u/Cl"),a=n("vmWJWrVe"),r=n("iSsLT+9z"),h=n("tLZJUYWX"),s=n("eubUSX4T"),c=n("5CiSxGri"),l=n("WRIFfSP1"),o=n("bFM+GwEk"),i=$(window),d=n("G8QA1dk+"),u={tabIndent:!1,toolbarFloat:!1,toolbar:["title","bold","italic","underline","strikethrough","color","|","ol","ul","blockquote","code","indent","outdent","alignment","|","link","upload","hr","table"]},t.exports=function(t){function e(){return this.insertImageById=f(this.insertImageById,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)v.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,a),e.prototype.viewName="PostEditorView",e.prototype.className="post-editor",e.prototype.tagName="section",e.prototype.initialize=function(t){return this.options=t,this._projectId=t._projectId,this.attachments=t.attachments||new s,this.renderBasic(),this.initSimditor(),this.renderAttachments(),this.listen()},e.prototype.listen=function(){var t;return this.listenTo(this.attachments,"remove add",this.renderAttachments),this.listenTo(this.attachments,"add change:completed",(t=this,function(e,n){if(n)return t.insertImage(e)})),this.editor.off(".post-editor"),this.editor.on("valuechanged.post-editor",function(t){return function(e){var n;return"function"==typeof(n=t.options).onchange&&n.onchange(t.get()),t.checkFixed()}}(this)),this.editor.on("uploadclick.post-editor",function(t){return function(e){return t.toggleWorksPicker(e)}}(this)),i.off("resize.post-editor"),i.on("resize.post-editor",function(t){return function(e){return t.calculateWith(e)}}(this))},e.prototype.renderBasic=function(){return this.$el.html(o({content:this.options.content})),this.$editorBarWrap=this.$(".editor-bar-wrap"),this.$textarea=this.$(".editor-input"),this.$attachmentsWrap=this.$(".editor-attachments")},e.prototype.initSimditor=function(){var t;return d.setup(),t=p.extend(u,this.options,{textarea:this.$textarea[0],placeholder:h.get("wall.view.post.creator.placeholder")}),this.editor=new r(t),this.editor.body.addClass("readable")},e.prototype.renderAttachments=function(){return this.$attachmentsWrap.empty(),this.attachments.each((t=this,function(e){return t.addAttachment(e)}));var t},e.prototype.addAttachment=function(t){var e;return e=this.$attachmentsWrap,this.requestSubView(c,{workModel:t,thirdtitle:!0,onInsertImage:this.insertImageById}).$el.prependTo(e)},e.prototype.removeAttachment=function(t){return this.$attachmentsWrap.find("li[data-cid="+t.cid+"]").remove()},e.prototype.setProjectId=function(t){return this._projectId=t},e.prototype.toggleWorksPicker=function(t){var e;if(!this.worksPicker||this.worksPicker._projectId!==this._projectId)return null!=(e=this.worksPicker)&&e.remove(),this.worksPicker=this.requestSubView(l,{container:this.$el,_projectId:this._projectId,collection:this.attachments,$toggler:this.$(".toolbar-item-upload"),placement:"bottom"})},e.prototype.saveCaretPos=function(){return this.caretPos=this.$textareaset[0].selectionStart,this},e.prototype.insertImageById=function(t){return this.insertImage(this.attachments.get(t))},e.prototype.insertImage=function(t,e){var n;if(n=this.getPreviewUrl(t))return this.editor.toolbar.findButton("upload").insertImage(n,t.get("fileName")),this},e.prototype.refreshImage=function(t){var e,n,i;if(this.getPreviewUrl(t))return n=t.previous("thumbnailUrl"),i=this.getPreviewUrl(t),e=t.get("fileName"),n&&i?(this.$("img").each(function(){if(this.src===n)return $(this).attr({src:i,alt:e,title:e})}),this.set(this.editor.body.html())):void 0},e.prototype.getPreviewUrl=function(t){var e,n,i,o,r;if(t)return o=t.get("thumbnailUrl")||"",r=t.get("imageWidth"),e=t.get("imageHeight"),i=r<400?200:r<600?400:r<800?600:800,n=Math.ceil(i*e/r),o=o.replace("w/200/h/200","w/"+i+"/h/"+n)},e.prototype.checkFixed=function(){var t,e;return(e=(t=this.$(".simditor-toolbar")).parent()[0])&&e.getBoundingClientRect().top<0?(t.addClass("on-fixed"),this.calculateWith()):t.removeClass("on-fixed").removeAttr("style")},e.prototype.calculateWith=function(){var t,e;if((t=this.$(".simditor-toolbar")).hasClass("on-fixed"))return e=this.$el.width(),t.width(e)},e.prototype.get=function(){return this.editor.getValue()},e.prototype.set=function(t){return this.editor.setValue(t),this},e.prototype.focus=function(){return this.editor.focus(),this},e.prototype.remove=function(){return i.off("resize.post-editor"),this.$el.off(),this.editor.destroy(),e.__super__.remove.apply(this,arguments)},e}()},"b++ooxIa":function(t,e,n){var i,o,r={}.hasOwnProperty;o=n("zBkMzjyh"),i=n("OZDTLQvo"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,o),e.prototype.pluginType="plugin_for_task",e.prototype.createPlugin=function(t){var e,n;return n=this.onPluginHandle.bind(this),e=this.view.options.taskModel.toJSON(),this.requestSubView(i,{view:this.view,pluginModel:t,data:e,onPluginHandle:n})},e.prototype.onPluginHandle=function(){return this.view.hide()},e}()},bEonRzad:function(t,e,n){var i,o,r,s,a,c={}.hasOwnProperty;r=n("a+N5u/Cl"),i=n("q1z7EYOi"),s=n("WMI0/nUp"),a=n("gh8QIhMV").throwError,o={loading:"loading",end:"end",error:"error",unauth:"unauth"},t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)c.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,i.Model),e.prototype.page=1,e.prototype.count=20,e.prototype.headers=null,e.prototype.hasMore=!0,e.prototype.defaults={status:null,items:[],selects:[],active:-1},e.prototype.initialize=function(t){return this.pluginModel=t.pluginModel,this.url=t.url,this.token=t.token,t},e.prototype.load=function(){var t,e,n;return this.hasMore&&this.get("status")!==o.loading?(this.set("status",o.loading),t={page:this.page,count:this.count},this.url&&(t.url=this.url),this.token&&(t.access_token=this.token),e=new window.XMLHttpRequest,s.requestPluginUrl(this.pluginModel.toJSON(),t,{xhr:function(){return e},headers:r.assign({},this.headers)}).then((n=this,function(t){var i;return i=r.sortBy(t.data,function(t){return null==t.itemsUrl}),n.headers=e.getAllResponseHeaders().split("\r\n").reduce(function(t,n){var i;return n&&(i=n.split(":")[0],/x-custom-[\w\d\-]+/.test(i)&&(t[i]=e.getResponseHeader(i))),t},{}),n.page++,n.addItems(i),n.set("status",o.end),n.hasMore=i.length===n.count})).catch(function(t){return function(e){var n,i;return n=e.status,i=e.responseJSON.url,401===e.status?t.set("status",o.unauth,{url:i}):(a(e),n=o.error,t.set({status:n,error:e}))}}(this))):Promise.resolve()},e.prototype.setSelects=function(t){return this.set({selects:t})},e.prototype.setActive=function(t){return this.set("active",t)},e.prototype.addItems=function(t){var e;return e=(e=this.get("items")).concat(t),this.set({items:e})},e.prototype.getSelects=function(){var t,e;return t=this.get("items"),e=this.get("selects"),r.chain(e).map(function(e){return t[e]}).compact().value()},e}()},"bFM+GwEk":function(t,e){t.exports=function(t){var e,n;return'<section class="editor-content-wrap"> <textarea class="editor-input" autofocus>'+("undefined"!=typeof _encodeHTML?_encodeHTML:(e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},n=/&(?!#?\w+;)|<|>|"|'|\//g,function(t){return t?t.toString().replace(n,function(t){return e[t]||t}):""}))(t.content)+'</textarea></section><footer> <ul class="editor-attachments clearfix"></ul></footer>'}},bevJdz10:function(t,e){t.exports=function(t){var e,n,i="undefined"!=typeof _encodeHTML?_encodeHTML:(e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},n=/&(?!#?\w+;)|<|>|"|'|\//g,function(t){return t?t.toString().replace(n,function(t){return e[t]||t}):""}),o='<form class="stage-template-form"> <p class="muted">'+tb_i18n.get("tasklist.menu.add.templates.detail")+'</p> <input class="form-control" placeholder="'+tb_i18n.get("tasklist.menu.templates")+'" type="text" /> <p class="stage-template-stages muted"> <span class="stage-name">'+i(t.stages[0])+"</span> ",r=t.stages.slice(1);if(r)for(var s=-1,a=r.length-1;s<a;)o+=' <span class="stage-name">&gt; '+i(r[s+=1])+"</span> ";return o+=' </p> <button class="btn btn-primary" type="submit">'+tb_i18n.get("save")+"</button></form>"}},cCmDmlFU:function(t,e){t.exports=function(t){return'<form class="settings-form"> <div class="settings-approve">'+tb_i18n.get("bookkeeping.settings.approver.member")+'</div> <div class="settings-members"></div> <div class="settings-tips">'+tb_i18n.get("bookkeeping.settings.approver.tips")+"</div></form>"}},cNNGxnSV:function(t,e){t.exports=function(t){return'<form class="collection-archive-form"> <p>'+tb_i18n.get("collection.menu.confirm.archive")+'</p> <button class="btn btn-danger" type="submit">'+tb_i18n.get("archive")+"</button></form>"}},ch1PVy3R:function(t,e,n){},coHZxb9W:function(t,e){t.exports=function(t){var e,n,i="undefined"!=typeof _encodeHTML?_encodeHTML:(e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},n=/&(?!#?\w+;)|<|>|"|'|\//g,function(t){return t?t.toString().replace(n,function(t){return e[t]||t}):""}),o='<li class="link-menu-item ';return t.isActive&&(o+="active"),o+=" ",t.isUnfolded&&(o+="unfolded"),o+='" data-index="'+t.idx+'"> <a class="link-menu-item-handler"> '+i(t.title)+" </a></li>"}},"dLEQ9ek+":function(t,e,n){var i,o,r,s,a,c,l,p={}.hasOwnProperty;c=n("vmWJWrVe"),l=n("a+N5u/Cl"),a=n("GESwhXbR").Toast,o=n("77NnVLwu"),s=n("GPNoQLd7"),r=n("I60qZbaE"),i={task:"board",post:"wall",event:"calendar",work:"file",entry:"bookkeeping-logo"},t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)p.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,c),e.prototype.events={"click .update-icon":"reFavorite"},e.prototype.initialize=function(t){return null==t&&(t={}),this.model=t.model,this.render(),this.listenTo(this.model,"change",this.render)},e.prototype.render=function(){var t,e,n,a;if(t=l.extend(this.model.toJSON(),{iconName:i[this.model.get("type")]}),this.$el.html(r({item:t})),n=t.uniqueId,e=t._projectId,"task"===t.type&&e)return o.fetch(e,{silentError:!0,success:(a=this,function(t){return a.requestSubView(s,{projectModel:t,uniqueId:n}).bind(a.$(".task-id-placeholder"))})})},e.prototype.reFavorite=function(t){return t.stopPropagation(),this.model.doFavorite(this.model.get("type"),{success:function(){return a.success(tb_i18n.get("favorites.update.success"))}})},e}()},fMz8P7hA:function(t,e,n){var i,o={}.hasOwnProperty;i=n("qHH6+g6Q"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,i),e.prototype.name="stagetemplate",e.prototype.urlRoot="stagetemplates",e.prototype.defaults={title:"",description:"",class:"tasklist_custom",stages:[]},e}()},fsNj6oMD:function(t,e,n){var i,o,r={}.hasOwnProperty;o=n("a+N5u/Cl"),i=n("qHH6+g6Q"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,i),e.prototype.name="entryCategory",e.prototype.urlRoot="entryCategories",e.prototype.parse=function(t){var e;return(e=o.extend(this.toJSON(),t)).iconStr=e.icon||"more",e},e}()},fvcLErpI:function(t,e,n){var i,o,r,s={}.hasOwnProperty;r=n("sa1Ed382"),o=n("9558JHAV"),i=n("Xl2NRDob"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,i),e.prototype.viewName="MyTasksCreatedTasks",e.prototype.createAPI=function(t){var e,n;return n=o.isDoneType()?"accomplished":o.getSortType(),e={type:"created",isDone:o.isDoneType(),orderBy:n},this.api=new t(e)},e.prototype.getTaskFilter=function(){var t;return t=r.user.id,function(e){return o.isDoneType()===e.isDone&&e._creatorId===t}},e}()},"g/Kdugr/":function(t,e,n){var i,o,r,s={}.hasOwnProperty;r=n("zBkMzjyh"),o=n("OZDTLQvo"),i=$("body"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,r),e.prototype.pluginType="plugin_for_tasklist",e.prototype.createPlugin=function(t){var e,n;return n=this.onPluginHandle.bind(this),e=this.view.tasklistModel.toJSON(),this.requestSubView(o,{view:this.view,pluginModel:t,data:e,onPluginHandle:n})},e.prototype.onPluginHandle=function(){return i.click()},e}()},"i/aZTl2y":function(t,e,n){var i,o,r={}.hasOwnProperty;o=n("zBkMzjyh"),i=n("OZDTLQvo"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,o),e.prototype.pluginType="plugin_for_post",e.prototype.createPlugin=function(t){var e,n;return n=this.onPluginHandle.bind(this),e=this.view.options.postModel.toJSON(),this.requestSubView(i,{view:this.view,pluginModel:t,data:e,onPluginHandle:n})},e.prototype.onPluginHandle=function(){return this.view.hide()},e}()},ktWockrD:function(t,e,n){var i,o,r,s,a={}.hasOwnProperty;s=n("sa1Ed382"),r=n("9558JHAV"),i=n("Xl2NRDob"),o=n("s45TlfD2"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,i),e.prototype.viewName="MyTasksTodoTasks",e.prototype.createAPI=function(t){var e,n;return n=r.isDoneType()?"accomplished":r.getSortType(),e={type:"execute",isDone:r.isDoneType(),orderBy:n},this.api=new t(e)},e.prototype.renderList=function(t){var e,n,i,o,s;if(t=r.sortTask(t),this.removeTaskViews(),r.isSortByProject()&&!r.isDoneType())return i=r.getProjects(t),this.renderGroup(i,t);for(o=[],e=0,n=t.length;e<n;e++)s=t[e],o.push(this.renderTask(s));return o},e.prototype.renderGroup=function(t,e){var n,i,r,s,a;for(this.$el.html(o(t)),s=[],i=0,r=e.length;i<r;i++)a=e[i],n=this.$("[data-id="+(a._projectId||"indie")+"] .group-list"),s.push(this.renderTask(a,n));return s},e.prototype.getTaskFilter=function(){var t;return t=s.user.id,function(e){return r.isDoneType()===e.isDone&&e._executorId===t}},e}()},kzPHITtO:function(t,e){t.exports=function(t){var e,n,i="undefined"!=typeof _encodeHTML?_encodeHTML:(e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},n=/&(?!#?\w+;)|<|>|"|'|\//g,function(t){return t?t.toString().replace(n,function(t){return e[t]||t}):""}),o='<div class="unauth-placeholder"> ';return t.avatarUrl?o+=' <span class="link-thumbnail" style="background-image: url('+i(t.avatarUrl)+')"></span> ':o+=' <span class="link-thumbnail icon icon-link"></span> ',o+=' <p class="muted">'+tb_i18n.get("object.link.standard.auth.description")+'</p> <p><a href="'+t.url+'">'+tb_i18n.get("object.link.standard.auth.link")+"</a></p></div>"}},l5P98bhF:function(t,e){t.exports=function(t){var e='<form class="settings-form"> <div class="settings-set settings-in"> <div class="settings-title">'+tb_i18n.get("bookkeeping.settings.fields.in")+'</div> <ul class="clearfix list-inline ui-sortable"> ',n=t.in;if(n)for(var i=-1,o=n.length-1;i<o;)e+=" ","category"==(s=n[i+=1]).attr?(e+=' <li class="settings-field ',!0!==s.isDefault&&(e+="switch-handler"),e+='" data-attr="'+s.attr+'"> '+s.title+" </li> "):(e+=' <li class="settings-field ui-sortable-handle ',!0!==s.isDefault&&(e+="switch-handler"),e+='" data-attr="'+s.attr+'"> '+s.title+" </li> "),e+=" ";e+=' </ul> </div> <div class="settings-set settings-out hide"> <div class="settings-title">'+tb_i18n.get("bookkeeping.settings.fields.out")+'</div> <ul class="clearfix list-inline ui-sortable"> ';var r=t.out;if(r)for(var s,a=-1,c=r.length-1;a<c;)e+=' <li class="settings-field switch-handler" data-attr="'+(s=r[a+=1]).attr+'"> '+s.title+" </li> ";return e+=" </ul> </div></form>"}},lEEYZyEf:function(t,e,n){var i,o,r,s,a,c,l={}.hasOwnProperty;n("BVpVtTsR"),c=n("a+N5u/Cl"),a=n("vmWJWrVe"),s=n("YdqH4v7N"),o=n("kYwCKdnI"),i=n("2YhbCXuM"),r=n("coHZxb9W"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)l.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,a),e.prototype.className="link-column-plugin-view thin-scroll",e.prototype.viewName="LinkItemsPluginView",e.prototype.events={"click .link-menu-item":"handleClick"},e.prototype.initialize=function(t){var e,n,i,o;return this.onClick=null!=(e=t.onClick)?e:function(){},this.onLoadMore=null!=(n=t.onLoadMore)?n:function(){},this.onSelect=null!=(i=t.onSelect)?i:function(){},this.onSwitch=null!=(o=t.onSwitch)?o:function(){},this.status=t.status,this.renderBasic(),this.setupScroll(this.$el),this.renderContent()},e.prototype.loadMore=function(t){return this.onLoadMore(t)},e.prototype.handleClick=function(t,e){var n,i,o,r,s,a,l,p,u,d,h,f;if(n=$(t.currentTarget),i=e>=0?e:n.data("index"),o=this.status.items[i],r=this.status.selects||[],u=[],o.redirectUrl||o.dataUrl){if(t.metaKey||t.ctrlKey)u=c.indexOf(r,i)>-1?c.without(i):c.union(r,[i]);else if(t.shiftKey){for(s=i>=(p=r[r.length-1])?i:p,a=l=d=f=i>=p?p:i,h=Math.min(s,f+10);d<=h?l<=h:l>=h;a=d<=h?++l:--l)u.push(a);u=c.union(r,u)}else u=r.length>1?[i]:c.indexOf(r,i)>-1?[]:[i];this.onSelect(c.first(u,10))}if(!(t.metaKey||t.ctrlKey||t.shiftKey))return this.status.active!==i&&o.itemsUrl?(this.onSwitch(i),this.onClick(o.itemsUrl)):void 0},e.prototype.renderBasic=function(){return this.$el.html(i()),this.$loading=this.$(".link-column-loading").hide(),this.$placeholder=this.$(".link-column-placeholder").hide(),this.$list=this.$(".link-items-list"),this.showLoadingIndicator(this.$loading)},e.prototype.renderContent=function(){switch(this.renderItems(),this.status.status){case"loading":return this.$loading.show();case"end":if(0===this.status.items.length)return this.$placeholder.show()}},e.prototype.renderItems=function(){return this.$list.empty(),this.status.items.forEach((t=this,function(e,n){return null!=e.itemsUrl?t.renderMenuItem(e,n):t.renderLinkItem(e,n)}));var t},e.prototype.renderMenuItem=function(t,e){var n;return n=c.extend({},t,{idx:e,isUnfolded:e===this.status.active,isActive:~this.status.selects.indexOf(e)}),this.$list.append(r(n))},e.prototype.renderLinkItem=function(t,e){var n,i;return(n=this.requestSubView(o,{link:t,tagName:"li",onClick:(i=this,function(t){return i.handleClick(t,e)})}).$el).addClass("object-picker"),~this.status.selects.indexOf(e)&&n.addClass("active"),this.$list.append(n)},c.extend(e.prototype,s),e}()},lXfR7kvN:function(t,e,n){var i,o,r={}.hasOwnProperty;i=n("VuB9cZyl"),o=n("fMz8P7hA"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,i),e.prototype.name="stagetemplates",e.prototype.model=o,e.prototype.orderBy="latest-created",e}()},"m+Dzs2wV":function(t,e,n){var i,o,r,s={}.hasOwnProperty;r=n("a+N5u/Cl"),i=n("VuB9cZyl"),o=n("fsNj6oMD"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,i),e.prototype.name="entryCategories",e.prototype.boundToObjectType="project",e.prototype.model=o,e.prototype.pageNum=20,e.prototype.getCategory=function(t){var e,n;return(n=this.get(t))||(e={_id:"entryCategoryNull",icon:"",title:tb_i18n.get("entry.category.title.null"),type:0},n=new o(e)),n},e.prototype.getCategories=function(t,e){var n;return n=this.toJSON(),r.filter(n,function(n){return(!t||t===n.type)&&(!r.isBoolean(e)||e===n.isDefault)})},e.prototype.getDefaultId=function(t){var e,n,i,o;for(e=0,n=(o=this.models).length;e<n;e++)if((i=o[e]).get("type")===t&&i.get("isDefault"))return i.id},e}()},mOEK7NOi:function(t,e,n){var i,o,r={}.hasOwnProperty;o=n("zBkMzjyh"),i=n("OZDTLQvo"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,o),e.prototype.pluginType="plugin_for_event",e.prototype.createPlugin=function(t){var e,n;return n=this.onPluginHandle.bind(this),e=this.view.options.eventModel.toJSON(),this.requestSubView(i,{view:this.view,pluginModel:t,data:e,onPluginHandle:n})},e.prototype.onPluginHandle=function(){return this.view.hide()},e}()},nQmsKn43:function(t,e,n){},nSCNZlGQ:function(t,e){t.exports=function(t){var e,n,i="undefined"!=typeof _encodeHTML?_encodeHTML:(e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},n=/&(?!#?\w+;)|<|>|"|'|\//g,function(t){return t?t.toString().replace(n,function(t){return e[t]||t}):""}),o='<a class="plugin-handler" data-plugin-id="'+i(t._id)+"\" data-gta=\"{action: 'use plugin', control: '"+i(t.type)+"', type: '"+i(t.pinyin)+"', pluginid: '"+i(t._id)+"', projectid: '"+i(t.projectId)+"'}\"> ";return t.avatarUrl?o+=' <span style="background-image: url('+i(t.avatarUrl)+')" class="icon plugin-avatar"></span> ':o+=' <span class="icon icon-pencil"></span> ',o+=" <span>"+i(t.name)+"</span></a>"}},"o/BVWMhV":function(t,e){t.exports=function(t){var e='<div class="my-past-events-wrap accordion active"> <ul id="my-past-events-accordion"> ',n=t.groups;if(n)for(var i,o=-1,r=n.length-1;o<r;)i=n[o+=1],e+=' <li class="panel"> <div class="accordion-title collapsed" data-toggle="collapse" data-parent="#my-past-events-accordion" href="#my-past-events-group'+o+'" data-gta="event" data-label="events|show past events"> <span class="caret pull-left"></span> <span>'+i.monthString+'</span> </div> <div id="my-past-events-group'+o+'" class="collapse" data-month="'+i.month+'"> <ul class="accordion-list events-list"></ul> </div> </li> ';return e+=" </ul></div>"}},oAE0d9eX:function(t,e,n){var i,o,r,s,a,c,l,p,u={}.hasOwnProperty;n("WOtenH8b"),c=n("a+N5u/Cl"),l=n("QyjeWo4p"),p=n("CxY0Mkc1"),a=n("vmWJWrVe"),o=n("lEEYZyEf"),r=n("snOUkmtq"),i=n("rwi4RQKD"),s=n("kzPHITtO"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)u.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,a),e.prototype.viewName="LinkContainerPluginView",e.prototype.className="link-container-plugin-view row-flex",e.prototype.initialize=function(t){var e;return this.pluginModel=t.pluginModel,this.view=t.view,e=t.token,this.status=new r({pluginModel:this.pluginModel,token:e}),this.renderBasic(),this.listen(),this.spliceList()},e.prototype.listen=function(){return this.listenTo(this.view,"object-picker-submit",this.onSubmit),this.listenTo(this.status,"change:list",this.renderContent),this.listenTo(this.status,"change:needAuth",function(t,e,n){return this.renderUnauth(e,n)}),this.listenTo(this.status,"change:submitStatus change:list",this.renderSubmitStatus)},e.prototype.spliceList=function(t,e){return this.status.spliceList(t,e)},e.prototype.renderColumn=function(t,e){var n,i;return n=this.requestSubView(o,{pluginModel:this.pluginModel,status:t,onClick:(i=this,function(t){return i.spliceList(e,t)}),onLoadMore:function(t){return function(n){return t.status.loadMore(e,n)}}(this),onSelect:function(t){return function(n){return t.status.setColumnSelects(e,n)}}(this),onSwitch:function(t){return function(n){return t.status.setActive(e,n)}}(this)}),this.$container.append(n.$el)},e.prototype.renderContent=function(){var t,e,n;return t=this.$container.find(".link-column-plugin-view").map(function(){return $(this).scrollTop()}).get(),this.$container.empty(),this.status.get("list").forEach((n=this,function(t,e){return n.renderColumn(t,e)})),this.$container.find(".link-column-plugin-view").each(function(e){var n;return n=t[e]||0,$(this).scrollTop(n)}),e=250*this.status.get("list").length-620,this.$container.stop().animate({scrollLeft:e})},e.prototype.renderBasic=function(){return this.$el.html(i()),this.$container=this.$(".link-container"),this.$placeholder=this.$(".link-placeholder").hide()},e.prototype.renderSubmitStatus=function(){var t,e,n;return n=this.status.get("submitStatus"),e=this.status.getSelects(),t="submitting"!==n&&e.length>0,this.view.handleDisableSubmit(!t)},e.prototype.renderUnauth=function(t,e){var n,i,o;return t?(o=p.parse(e.url),i=p.format({protocol:o.protocol,host:o.host,pathname:o.pathname,query:c.extend({},l.parse(o.query),{next_url:window.location.href})}),n=this.pluginModel.get("avatarUrl"),this.$placeholder.html(s({url:i,avatarUrl:n})).show()):this.$placeholder.hide()},e.prototype.onSubmit=function(){return this.status.submit().then((t=this,function(e){var n;return n=e.map(function(t){return c.pick(t,"_id","type")}),t.view.onSelect?t.view.onSelect(n):t.view.options.onSelect&&t.view.options.onSelect(n),t.view.handleClose()})).catch(function(){});var t},e}()},oPKpjxwr:function(t,e,n){var i,o,r={}.hasOwnProperty;o=n("zBkMzjyh"),i=n("OZDTLQvo"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,o),e.prototype.pluginType="plugin_for_work",e.prototype.createPlugin=function(t){var e,n;return n=this.onPluginHandle.bind(this),e=(this.view.workModel||this.view.options.objectModel).toJSON(),this.requestSubView(i,{view:this.view,pluginModel:t,data:e,onPluginHandle:n})},e.prototype.onPluginHandle=function(){return this.view.hide()},e}()},oXTsRL5n:function(t,e,n){},ob9kWEi7:function(t,e,n){"use strict";n.d(e,"a",function(){return s});var i=n("mrSGxOB2"),o=n("q1tIBJhx"),r={move:{work:"onMoveWork",collection:"onMoveCollection"},download:{work:"onDownloadWork",collection:"onDownloadCollection"},submit:{work:"onModifyWork",collection:"onModifyCollection"},click:{work:"onWorkClick",collection:"onCollectionClick"},open:{work:"onOpenWorkMenu",collection:"onOpenCollectionMenu"}},s=function(t,e){var n;return(n=function(n){function s(t){var e=n.call(this,t)||this;return e.getInstance=function(t){e.wrapper=t},e.onOpenMenu=function(){return function(t){var n=r.open[e.type];e.props[n](t,e.itemId)}},e.onUpdateClick=function(){e.props.onUpdateClick(e.itemId)},e.onSelectClick=function(){e.props.onSelect(e.props.item)},e.onSubmit=function(t){var n=r.submit[e.type];return e.props[n](e.itemId,t)},e.onClick=function(){var t=r.click[e.type];e.props[t](e.itemId)},e.onMoveClick=function(){var t=r.move[e.type];e.props[t]&&e.props[t](e.itemId)},e.onDownloadClick=function(){var t=r.download[e.type];e.props[t]&&e.props[t](e.props.item)},e.onOpenClick=function(){e.props.onOpenWorkClick&&e.props.onOpenWorkClick(e.itemId)},e.onEnterEditing=function(){e.setState(i.a({},e.state,{isEditing:!0,isDisabled:!0}))},e.onQuitEditing=function(){e.setState(i.a({},e.state,{isEditing:!1,isDisabled:!1}))},e.state={isEditing:!1,isDisabled:!1},e}return i.d(s,n),Object.defineProperty(s.prototype,"type",{get:function(){return this.props.type},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"itemId",{get:function(){return this.props.item._id},enumerable:!0,configurable:!0}),s.prototype.componentDidMount=function(){this.props.initDragHandler(this.wrapper),"collection"===this.type&&this.props.initDropHandler(this.wrapper)},s.prototype.componentWillUnmount=function(){this.props.onComponentUnmount&&this.props.onComponentUnmount()},s.prototype.render=function(){var n=i.a({},this.props,{ref:this.getInstance,selected:this.props.item.selected,isEditing:this.state.isEditing,isDisabled:this.state.isDisabled,onEnterEditing:this.onEnterEditing,onQuitEditing:this.onQuitEditing,onSelectClick:this.onSelectClick,onSubmit:this.onSubmit,onClick:this.onClick,onMoveClick:this.onMoveClick,onOpenClick:this.onOpenClick,onMenuOpen:this.onOpenMenu(),onDownloadClick:this.onDownloadClick,onUpdateClick:this.onUpdateClick});return"work"===this.type?o.createElement(t,i.a({},n)):o.createElement(e,i.a({},n))},s}(o.Component)).defaultProps={showCreator:!0},n}},pbzP9iSs:function(t,e){t.exports=function(t){var e,n,i="undefined"!=typeof _encodeHTML?_encodeHTML:(e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},n=/&(?!#?\w+;)|<|>|"|'|\//g,function(t){return t?t.toString().replace(n,function(t){return e[t]||t}):""});return'<a class="plugin-handler app hint-content hinted" data-app="'+i(t.appName)+'" data-plugin-id="'+i(t._pluginId)+"\" data-gta=\"{action: 'use plugin', control: '"+i(t.type)+"', pluginid: '"+i(t._pluginId)+"', projectid: '"+i(t.projectId)+"'}\"> "+i(t.name)+"</a>"}},rU2aduZM:function(t,e){t.exports=function(t){return'<form class="work-archive-form"> <p>'+tb_i18n.get("work.menu.confirm.archive")+'</p> <button class="btn btn-danger" type="submit">'+tb_i18n.get("archive")+"</button></form>"}},rjH6teml:function(t,e,n){var i,o,r,s={}.hasOwnProperty,a=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};r=n("sa1Ed382"),o=n("9558JHAV"),i=n("Xl2NRDob"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,i),e.prototype.viewName="MyTasksJoinedTasks",e.prototype.createAPI=function(t){var e,n;return n=o.isDoneType()?"accomplished":o.getSortType(),e={type:"involves",isDone:o.isDoneType(),orderBy:n},this.api=new t(e)},e.prototype.getTaskFilter=function(){var t;return t=r.user.id,function(e){var n;return n=e.involveMembers||[],o.isDoneType()===e.isDone&&a.call(n,t)>=0}},e}()},rwi4RQKD:function(t,e){t.exports=function(t){return'<div class="link-container flex-horiz flex-fill thin-scroll"></div><div class="link-placeholder"></div>'}},s45TlfD2:function(t,e){t.exports=function(t){var e,n,i="undefined"!=typeof _encodeHTML?_encodeHTML:(e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},n=/&(?!#?\w+;)|<|>|"|'|\//g,function(t){return t?t.toString().replace(n,function(t){return e[t]||t}):""}),o="",r=t;if(r)for(var s,a=-1,c=r.length-1;a<c;)o+='<li class="my-tasks-group" data-id="'+(s=r[a+=1])._id+'"> <div class="group-header"> <span class="group-name">'+i(s.name||tb_i18n.get("my.tasks.group.title.indie.tasks"))+'</span> ·     <span class="group-count">'+s.count+'</span> </div> <ul class="group-list my-list"></ul></li>';return o}},sBJ0DUAr:function(t,e,n){var i,o,r,s,a,c={}.hasOwnProperty;a=n("a+N5u/Cl"),i=n("cCmDmlFU"),o=n("/dfPTVwF"),r=n("vNWLjLJF"),s=n("vmWJWrVe"),n("gh8QIhMV").throwError,t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)c.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,s),e.prototype.viewName="BookkeepingSettingsApproverView",e.prototype.tagName="div",e.prototype.className="bookkeeping-settings-approver-view",e.prototype.modalTitle="",e.prototype.events={"click .settings-in-hanlder":"inHandler","click .settings-out-hanlder":"outHandler","submit .settings-form":"submit"},e.prototype.initialize=function(t){if(!t.bookkeepingModel)throw new Error(this.viewName+":options should have bookkeepingModel");var n;return this.options=t,this.bookkeepingModel=t.bookkeepingModel,this._projectId=this.bookkeepingModel.get("_projectId"),this.model=new o({_projectId:this.bookkeepingModel.get("_projectId"),involveMembers:this.bookkeepingModel.get("_approverIds")}),this.render(),a.delay((n=this,function(){return n.$el.addClass("in")}),100),e.__super__.initialize.apply(this,arguments)},e.prototype.render=function(){return this.$el.html(i()),this.initMemberPicker()},e.prototype.initMemberPicker=function(){return this.involveView=this.requestSubView(r,{_projectId:this._projectId,objectModel:this.model,customPermission:"put.approvers",saveOnHidden:!0,dropArea:this.$el,saveToCache:!0}),this.involveView.$el.prependTo(this.$(".settings-members")),this},e.prototype.saveApprovers=function(){if(!a.isEqual(this.bookkeepingModel.get("_approverIds"),this.model.get("involveMembers")))return this.bookkeepingModel.save(null,{attrs:{_approverIds:this.model.get("involveMembers")}})},e.prototype.onClose=function(){return this.saveApprovers()},e.prototype.close=function(){var t;return null!=(t=this.parentView)&&t.remove(),this},e}()},schKCMXe:function(t,e,n){var i,o,r,s,a={}.hasOwnProperty;s=n("a+N5u/Cl"),i=n("l5P98bhF"),r=n("vmWJWrVe"),o=n("GESwhXbR").Toast,t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,r),e.prototype.viewName="BookkeepingSettingsDisplayFieldsView",e.prototype.tagName="div",e.prototype.className="bookkeeping-settings-displayFields-view",e.prototype.events={"click .settings-in .switch-handler":"removeField","click .settings-out .switch-handler":"addField"},e.prototype.initialize=function(t){if(!t.bookkeepingModel)throw new Error(this.viewName+":options should have bookkeepingModel");var n;return this.options=t,this.bookkeepingModel=t.bookkeepingModel,this.displayFields=this.bookkeepingModel.getDisplayFields(),this.hiddenFields=this.bookkeepingModel.getHiddenFields(),this.render(),s.delay((n=this,function(){return n.$el.addClass("in")}),100),e.__super__.initialize.apply(this,arguments)},e.prototype.render=function(){var t;return t={in:this.displayFields,out:this.hiddenFields},this.$el.html(i(t)),this.checkOutFields(),this.initSortable()},e.prototype.initSortable=function(){var t;return!1,this.$(".list-inline").sortable({items:".ui-sortable-handle",connectWith:".list-inline",helper:"clone",placeholder:"settings-field settings-field-placeholder",tolerance:"pointer",zIndex:2001,scroll:!1,update:(t=this,function(e,n){var i;return!((i=$(n.item[0])).closest(".settings-out").length&&!i.hasClass("switch-handler"))&&(t.$(".settings-in").find(".icon-tick").removeClass("icon-tick").addClass("icon-remove"),t.$(".settings-out").find(".icon-remove").removeClass("icon-remove").addClass("icon-tick"),t.parseFromUI())})}),this},e.prototype.parseFromUI=function(){var t,e;return t=[],this.$(".settings-in .settings-field").each(function(){return t.push($(this).data("attr"))}),this.displayFields=this.bookkeepingModel.getFields(t),e=[],this.$(".settings-out .settings-field").each(function(){return e.push($(this).data("attr"))}),this.hiddenFields=this.bookkeepingModel.getFields(e),this.checkOutFields()},e.prototype.checkOutFields=function(){return this.hiddenFields.length?this.$(".setting-out").show():this.$(".setting-out").hide()},e.prototype.removeField=function(t){var e,n;if(e=(null!=t?t.currentTarget:void 0)?$(t.currentTarget).data("attr"):t)return this.displayFields=s.reject(this.displayFields,(n=this,function(t){return t.attr===e&&(n.hiddenFields.unshift(t),!0)})),this.renderMain()},e.prototype.addField=function(t){var e,n;if(e=(null!=t?t.currentTarget:void 0)?$(t.currentTarget).data("attr"):t)return this.hiddenFields=s.reject(this.hiddenFields,(n=this,function(t){return t.attr===e&&(n.displayFields.push(t),!0)})),this.renderMain()},e.prototype.saveFields=function(){var t,e;if(t=s.map(this.displayFields,"attr"),!s.isEqual(t,this.bookkeepingModel.get("displayFields")))return this.bookkeepingModel.save(null,{attrs:{displayFields:t},success:(e=this,function(){return e.close()}),error:function(t,e){return o.error(e)}})},e.prototype.onClose=function(){return this.saveFields(),this},e.prototype.close=function(){var t;return null!=(t=this.parentView)&&t.remove(),this},e}()},snOUkmtq:function(t,e,n){var i,o,r,s,a,c,l={}.hasOwnProperty;s=n("a+N5u/Cl"),i=n("q1z7EYOi"),n("VuB9cZyl"),o=n("bEonRzad"),a=n("WMI0/nUp"),c=n("gh8QIhMV").throwError,r={submitting:"submitting",success:"success",error:"error"},t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)l.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,i.Model),e.prototype.collection=null,e.prototype.defaults={needAuth:!1,submitStatus:null,list:null,error:null},e.prototype.initialize=function(t){return this.pluginModel=t.pluginModel,this.token=t.token,this.collection=new i.Collection([]),this.listenTo(this.collection,"change add remove reset",this.parseList),this.listenTo(this.collection,"change:status",function(t,e,n){return"unauth"===e?this.set("needAuth",!0,n):this.set("needAuth",!1)})},e.prototype.parseList=function(){return this.set("list",this.collection.toJSON())},e.prototype.spliceList=function(t,e){var n,i;return null==t&&(t=0),(i=new o({pluginModel:this.pluginModel,url:e,token:this.token})).load(),n=s.chain(this.collection.models).first(t+1).push(i).value(),this.collection.reset(n)},e.prototype.setColumnSelects=function(t,e){return this.collection.each(function(n,i){return t===i?n.setSelects(e):n.setSelects([])})},e.prototype.setActive=function(t,e){return this.collection.at(t).setActive(e)},e.prototype.getSelects=function(){return s.chain(this.collection.models).map(function(t){return t.getSelects()}).flatten().value()},e.prototype.loadMore=function(t,e){var n;return(n=this.collection.at(t)).load().then(function(){if(n.hasMore)return"function"==typeof e?e():void 0})},e.prototype.submit=function(){var t,e;return this.set("submitStatus",r.submitting),t=this.getSelects(),a.createLinks(this.pluginModel.toJSON(),t,this.token).then((e=this,function(t){return e.set("submitStatus",r.success),t})).catch(function(t){return function(e){return c(e),t.set("submitStatus",r.error),t.set("error",e)}}(this))},e}()},"t6Fy+YvB":function(t,e,n){},v9kTbSr6:function(t,e,n){"use strict";n.d(e,"a",function(){return l});var i=n("mrSGxOB2"),o=n("q1tIBJhx"),r=n("TSYQbtd+"),s=n.n(r),a=n("tLZJUYWX"),c=n("GESwhXbR");n("ch1PVy3R");var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onSwitchViewMode=function(t){return function(){e.props.onSwitchViewMode(t)}},e.genMessage=function(t,e){var n="";return t&&(n+=a.get("library.works.count",t)),t&&e&&(n+=a.get("library.and")),e&&(n+=a.get("library.collections.count",e)),n},e}return i.d(e,t),e.prototype.renderCheckBox=function(){if(null==this.props.selectAll)return o.createElement("div",{className:"check-box flex-static"});var t=s()("check-box","flex-static",{"is-available":!0,selected:this.props.selectAll});return o.createElement("div",{className:t,onClick:this.props.onSelectAll},o.createElement("span",{className:"icon icon-tick"}))},e.prototype.renderArchiveHandler=function(){var t=o.createElement("a",{className:"batch-archive-handler"},o.createElement("span",{className:"icon icon-trash"}),a.get("archive")),e=this.props,n=e.selectFileCount,i=e.selectCollectionCount,r=this.genMessage(n,i);return o.createElement(c.PopupMenu,{className:"library-batch-handler-popup",main:0,trigger:t,key:"archive"},o.createElement(c.PopupMenuView,{index:0,title:a.get("archive")},o.createElement("div",null,a.get("library.archive.to",r)),o.createElement(c.Button,{className:"library-batch-handler-popup-button",danger:!0,onClick:this.props.onArchiveClick},a.get("archive"))))},e.prototype.renderSelectsNum=function(){return 0===this.props.selectCount?null:[o.createElement("span",{className:"select-num-hint",key:"hint"},a.get("library.handler.selects.hint",this.props.selectCount)),this.props.download?o.createElement("a",{className:"batch-download-handler",key:"download",onClick:this.props.onDownloadClick},o.createElement("span",{className:"icon icon-circle-arrow-down-o"}),a.get("library.download")):null,this.props.update?o.createElement("a",{className:"library-update-handler",key:"update",onClick:this.props.onUpdateClick},o.createElement("span",{className:"icon icon-circle-arrow-up-o"}),a.get("library.file.update")):null,this.props.move?o.createElement("a",{className:"batch-move-handler",key:"move",onClick:this.props.onMoveClick},o.createElement("span",{className:"icon icon-file-move2"}),a.get("library.move")):null,this.props.copy?o.createElement("a",{className:"batch-copy-handler",key:"copy",onClick:this.props.onCopyClick},o.createElement("span",{className:"icon icon-copy"}),a.get("library.copy")):null,this.props.favorite?o.createElement("a",{className:"batch-favorite-handler",key:"favorite",onClick:this.props.onFavoriteClick},o.createElement("span",{className:"icon icon-favorite"}),a.get("library.favorite")):null,this.props.unfavorite?o.createElement("a",{className:"batch-unfavorite-handler",key:"unfavorite",onClick:this.props.onUnfavoriteClick},o.createElement("span",{className:"icon icon-favorite"}),a.get("library.unfavorite")):null,this.props.archive?this.renderArchiveHandler():null]},e.prototype.renderListControls=function(){if("list"!==this.props.viewMode||this.props.selectCount>0)return null;var t=s()("caret",{dropup:this.props.asc}),e="name"===this.props.sortMethod&&o.createElement("span",{className:t}),n="size"===this.props.sortMethod&&o.createElement("span",{className:t}),i="updated"===this.props.sortMethod&&o.createElement("span",{className:"caret"}),r=s()("library-info-name sort-name-handler",{dropup:this.props.asc}),c=s()("library-info-size sort-size-handler",{dropup:this.props.asc}),l=s()("library-info-update sort-updated-handler",{dropup:this.props.asc}),p=this.props.showCreator?o.createElement("span",{className:"library-info-author"},a.get("library.author")):null;return o.createElement("div",{className:"library-info flex-fill"},o.createElement("a",{className:r,onClick:this.props.sortByName},o.createElement("span",{className:"library-sort"},a.get("library.name")),e),o.createElement("a",{className:c,onClick:this.props.sortBySize},o.createElement("span",{className:"library-sort sort-size-handler"},a.get("library.size")),n),p,o.createElement("a",{className:l,onClick:this.props.sortByUpdated},o.createElement("span",{className:"library-sort"},a.get("library.update")),i))},e.prototype.renderGridControls=function(){return"grid"!==this.props.viewMode||this.props.selectCount>0||null==this.props.selectAll?null:o.createElement("span",{className:"select-num-hint"},a.get("library.handler.selectAll"))},e.prototype.renderViewMode=function(){var t="list"===this.props.viewMode,e=s()("mode-handler list-mode-handler icon icon-unordered-list hinted",{active:t}),n=s()("mode-handler grid-mode-handler icon icon-org-apps hinted",{active:!t});return o.createElement("div",{className:"view-mode-handlers"},o.createElement("a",{"data-title":a.get("library.list.mode"),className:e,onClick:this.onSwitchViewMode("list")}),o.createElement("a",{"data-title":a.get("library.grid.mode"),className:n,onClick:this.onSwitchViewMode("grid")}))},e.prototype.render=function(){return o.createElement("div",{className:"library-handler flex-horiz"},this.renderCheckBox(),this.renderSelectsNum(),this.renderListControls(),this.renderGridControls(),this.renderViewMode())},e.defaultProps={showCreator:!0},e}(o.PureComponent)},wBtFGHUK:function(t,e,n){var i,o,r,s,a,c,l,p,u,d,h,f={}.hasOwnProperty;u=n("a+N5u/Cl"),h=n("sa1Ed382"),l=n("vmWJWrVe"),c=n("YdqH4v7N"),r=n("g09zqn9P"),p=n("OmupbwLD"),a=n("qKYkuTVR"),i=n("zXxYBKpE"),d=n("9558JHAV"),o={todo:n("ktWockrD"),created:n("fvcLErpI"),joined:n("rjH6teml")},s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)f.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,l),e.prototype.viewName="MyTasksView",e.prototype.tagName="section",e.prototype.className="my-tasks-view my-content-view fade",e.prototype.events={"click .icalendar":"showICalendar","click .task-content-set":"gtaShowTaskDetail","click .type-filter":"toggleFilterSelector","click .tasks-menu-group a":"toggleSelector"},e.prototype.initialize=function(t){var e;return this.options=u.extend({},t),d.setFilterType("todo"),this.setCurrentSort(),this.renderBasic(),this.renderCurrent(),u.delay((e=this,function(){return e.$el.addClass("in")})),this},e.prototype.setCurrentSort=function(){var t,e;if(e=d.getTypeSortKey(),(t=h.PREFERENCE.get(e))!==d.getSortType())return d.setSortType(t)},e.prototype.renderBasic=function(){var t;return t={taskTypes:d.getFilterList(),sortTitle:d.getSortTitle()},this.$el.html(i(t)).attr("data-done",d.getDoneType()),this.$content=this.$(".my-tasks-wrapper"),this.$dropdownMenu=this.$(".tasks-menu-group"),this.$filterMenuTabs=this.$(".my-header-tabs"),this.$doneMenuTitle=this.$("a[data-type='done'] .menu-title",this.$dropdownMenu),this.$sortMenuTitle=this.$("a[data-type='sort'] .menu-title",this.$dropdownMenu),this.loadMoreIfNotEnough=this.setupScroll(this.$content)},e.prototype.toggleSelector=function(t){switch($(t.currentTarget).data("type")){case"done":return this.toggleDoneSelector(t);case"sort":return this.toggleSortSelector(t)}},e.prototype.renderCurrent=function(){var t,e,n,i;return null!=(e=this.currentView)&&e.remove(),t=o[d.getFilterType()],this.currentView=this.requestSubView(t),this.$content.html(this.currentView.$el),this.refreshHeader(),null!=(n=this.subs)&&n.unsubscribe(),this.subs=this.currentView.observeHasMore().take(4).delay(1e3).subscribe((i=this,function(t){return t&&("function"==typeof i.loadMoreIfNotEnough?i.loadMoreIfNotEnough():void 0)}))},e.prototype.refreshHeader=function(){return this.$filterMenuTabs.find("li").removeClass("is-active"),this.$filterMenuTabs.find("[data-type="+d.getFilterType()+"]").addClass("is-active"),this.$doneMenuTitle.text(d.getDoneTitle()),this.$sortMenuTitle.text(d.getSortTitle()),this.$dropdownMenu.find(".selected").removeClass("selected"),this.$dropdownMenu.find("[data-type="+d.getFilterType()+"]").parent().addClass("selected"),this.$dropdownMenu.find("a").data("toggleSelector",!1),this.$el.attr("data-filter",d.getFilterType()),this.$el.attr("data-done",d.getDoneType())},e.prototype.showICalendar=function(){var t;return t=u.extend({},this.options,{title:tb_i18n.get("my.tasks"),subTitle:tb_i18n.get("my.tasks.icalendar.title"),webcal:h.user.get("taskCalLink")}),this.requestSubView(p).open(r,t)},e.prototype.gtaShowTaskDetail=function(t){var e;return e=$(t.currentTarget),h.gta.event({action:"open detail",series:e.data("series")||0,type:e.data("type")||"task",control:d.getFilterGta(),category:d.getDoneTypeGta(),note1:d.getSortTypeGta()})},e.prototype.loadMore=function(t){var e;return t(),"function"==typeof(e=this.currentView).loadMore?e.loadMore():void 0},e.prototype.toggleFilterSelector=function(t){var e;if((e=$(t.currentTarget).data("type"))!==d.getFilterType())return d.setFilterType(e),this.setCurrentSort(),this.renderCurrent(),h.gta.event({action:"open task list",category:d.getFilterGta(e)})},e.prototype.toggleDoneSelector=function(t){var e,n,i,o;return n="toggleSelector",(e=$(t.currentTarget)).data(n)?(e.data(n,!1),this):(e.data(n,!0),null!=(i=this.doneSelectorrView)&&i.remove(),this.doneSelectorrView=this.requestSubView(a,{$toggler:e,width:170,dataList:d.getDoneList(),selected:d.getDoneType(),select:(o=this,function(t){if(t!==d.getDoneType())return d.setDoneType(t),o.currentView.render(),o.renderCurrent(),h.gta.event({action:"switch status",category:d.getDoneTypeGta(t),control:d.getFilterGta()})})}).show(),h.gta.event({action:"toggle status list"}))},e.prototype.toggleSortSelector=function(t){var e,n,i,o;return n="toggleSelector",(e=$(t.currentTarget)).data(n)?(e.data(n,!1),this):(e.data(n,!0),null!=(i=this.toggleSortSelectorrView)&&i.remove(),this.toggleSortSelectorrView=this.requestSubView(a,{$toggler:e,width:194,dataList:d.getSortList(),selected:d.getSortType(),select:(o=this,function(t){if(t!==d.getSortType())return d.setSortType(t),o.updateSortPreference(t),o.currentView.render(),o.renderCurrent(),h.gta.event({action:"switch order",category:d.getSortTypeGta(t),control:d.getFilterGta()})})}).show(),h.gta.event({action:"toggle order list"}))},e.prototype.updateSortPreference=function(t){switch(d.getFilterType()){case"todo":return h.PREFERENCE.toggleMyTaskExecuteSort(t);case"joined":return h.PREFERENCE.toggleMyTaskInvolvesSort(t);case"created":return h.PREFERENCE.toggleMyTaskCreatedSort(t)}},e.prototype.remove=function(){var t;return null!=(t=this.subs)&&t.unsubscribe(),e.__super__.remove.apply(this,arguments)},e}(),u.extend(s.prototype,c),t.exports=s},wj2Vcbed:function(t,e){t.exports=function(t){var e,n,i="undefined"!=typeof _encodeHTML?_encodeHTML:(e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},n=/&(?!#?\w+;)|<|>|"|'|\//g,function(t){return t?t.toString().replace(n,function(t){return e[t]||t}):""});return'<form class="tasklist-edit-form"> <input class="form-control" placeholder="'+tb_i18n.get("tasklist.menu.tasklist.title")+'" type="text" value="'+i(t.title)+'" /> <textarea class="form-control" placeholder="'+tb_i18n.get("tasklist.menu.tasklist.desc")+'">'+(t.description||"")+'</textarea> <button class="btn btn-primary" type="submit">'+tb_i18n.get("save")+"</button></form>"}},x6JOqOc9:function(t,e){t.exports=function(t){return'<div class="today-tasks" data-gta="event" data-label="my today tasks" data-value="my today tasks"> <h3> '+tb_i18n.get("my.recent.today")+' · <span class="count"></span> </h3> <ul class="task-list events-list my-list"></ul></div><div class="tomorrow-tasks" data-gta="event" data-label="my tomorrow tasks" data-value="my tomorrow tasks"> <h3> '+tb_i18n.get("my.recent.tomorrow")+' · <span class="count"></span> </h3> <ul class="task-list events-list my-list"></ul></div><div class="week-tasks" data-gta="event" data-label="my week tasks" data-value="my week tasks"> <h3> '+tb_i18n.get("my.recent.week")+' · <span class="count"></span> </h3> <ul class="task-list events-list my-list"></ul></div><div class="task-placeholder placeholder muted"> <span class="icon icon-board"></span> <br /> '+tb_i18n.get("task.recent.placeholder")+"</div>"}},xSDGjIzx:function(t,e,n){t.exports=function(t){var e="",i=n("2qRnoGmE");return e+='<ul class="list work-menu-list"> ',t.inGridView&&(e+=" ",t.permissions.putVersion&&(e+=' <li> <a class="update-work-handler"> <span class="icon icon-circle-arrow-up-o"></span>'+tb_i18n.get("work.update.title")+" </a> </li> "),e+=" ",t.permissions.putMove&&(e+=' <li> <a class="move-work-handler"> <span class="icon icon-file-move2"></span>'+tb_i18n.get("work.move.title")+" </a> </li> "),e+=" "),e+=" ",t.permissions.putFork&&(e+=' <li> <a class="copy-work-handler"> <span class="icon icon-copy"></span>'+tb_i18n.get("work.menu.copy.file")+" </a> </li> "),e+=" ",t.showShare&&i.FEATURES.thirdShare&&("involves"!==t.parentVisible||t.parentPermissions.putVisible)&&(e+=' <li> <a class="share-work-handler"> <div class="main-mode main-mode-title"> <span class="icon icon-wechat"></span> <span class="mode">'+tb_i18n.get("share.via.wechat")+"</span> ",t.isShared?e+=' <span class="ifClose">'+tb_i18n.get("share.link.open")+"</span> ":e+=' <span class="ifCloseDisabled">'+tb_i18n.get("share.link.closed")+"</span> ",e+=' </div> <div class="main-mode-description"> '+tb_i18n.get("share.via.wechat.description")+" </div> </a> </li> "),e+=" ",t.showInviteLink&&i.FEATURES.qrLinkShare&&(e+=' <li> <a class="invite-handler"> <div class="main-mode main-mode-title"> <span class="icon icon-share-chain"></span> <span class="mode">'+tb_i18n.get("invite.from.link")+'</span> </div> <div class="main-mode-description"> '+tb_i18n.get("invite.from.link.description")+" </div> </a> </li> "),e+=" ",t.showLink&&(e+=' <li> <a class="copy-object-link-handler" data-clipboard-text="'+t.objectLinkUrl+"\" data-gta=\"{aciton: 'copy link', control: 'More Menu', type: 'file', segment: 'file list'}\"> <span class=\"icon icon-link\"></span>"+tb_i18n.get("object.link.copy.handler.file")+" </a> </li> "),e+=' <li> <a class="favorite-work-handler"> <span class="icon icon-favorite ',t.isFavorite&&(e+="favorited"),e+='"></span>',t.isFavorite?e+=""+tb_i18n.get("unfavorite"):e+=""+tb_i18n.get("favorite")+tb_i18n.get("navigation.work"),e+=" </a> </li> ",t.permissions.putArchive&&(e+=' <li> <a class="archive-work-handler"> <span class="icon icon-trash"></span>'+tb_i18n.get("archive")+" </a> </li> "),e+=" ",t.canModifyVisibility&&(e+=' <li class="divider"></li> <li> <a class="switch-visible-handler"></a> </li> '),e+="</ul>"}},xa0Lr1Lz:function(t,e,n){t.exports=function(t){var e="",i=n("ytDAhr3u").ColorNames;if(e+='<ul class="list collection-menu-list"> <li> <a class="copy-object-link-handler" data-clipboard-text="'+t.objectLinkUrl+"\" data-gta=\"{aciton: 'copy link', control: 'More Menu', type: 'folder'}\"> <span class=\"icon icon-link\"></span>"+tb_i18n.get("object.link.copy.handler.collection")+" </a> </li> ",t.inGridView&&(e+=" ",t.permissions.putMove&&(e+=' <li> <a class="move-collection-handler"> <span class="icon icon-file-move2"></span>'+tb_i18n.get("collection.move.title")+" </a> </li> "),e+=" "),e+=" ","default"!=t.collectionType&&(e+=" ",t.permissions.putFork&&(e+=' <li> <a class="fork-collection-handler"> <span class="icon icon-copy"></span>'+tb_i18n.get("collection.menu.fork.title")+" </a> </li> "),e+=" ",t.permissions.putArchive&&(e+=' <li> <a class="archive-collection-handler"> <span class="icon icon-trash"></span>'+tb_i18n.get("archive")+" </a> </li> "),e+=" ",t.permissions.putVisible&&(e+=' <li> <a class="change-collection-visibility-handler" data-gta="{action: \'open folder visibility setting\', control: \'More Menu\'}" > <span class="icon icon-lock"></span>'+tb_i18n.get("collection.menu.change.visibility.title")+" </a> </li> "),e+=" "),e+=" ",t.permissions.put){e+=" ",(t.permissions.del||t.permissions.putArchive||t.inGridView&&t.permissions.putMove)&&(e+=' <li class="list-divider"></li> '),e+=' <li class="color-choise"> <ul class="clearfix"> ';var o=i;if(o)for(var r,s=-1,a=o.length-1;s<a;)r=o[s+=1],e+=' <li class="color ',t.color==r&&(e+="active"),e+=" color-"+r+'" data-color="'+r+'"> <span class="icon icon-tick icon-white"></span> </li> ';e+=" </ul> </li> "}return e+="</ul>"}},zBkMzjyh:function(t,e,n){var i,o,r={}.hasOwnProperty;o=n("7gS+SwzT"),i=n("3xRTerdf"),t.exports=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,o),e.prototype.container=".list",e.prototype.$divider=null,e.prototype.$mark=null,e.prototype.initialize=function(t){var n;return this.view=t.view,this.collection=t.collection,this.$divider=this.requestSubView(i).$el,n=document.createComment("divider"),this.$mark=$(n),this.view.$el.find(this.container).append(n),e.__super__.initialize.apply(this,arguments)},e.prototype.listen=function(t){return e.__super__.listen.apply(this,arguments),this.listenTo(t,"add remove",this.checkDivider)},e.prototype.render=function(){return e.__super__.render.apply(this,arguments),this.checkDivider()},e.prototype.checkDivider=function(){return this.getPluginModels().length?this.$mark.after(this.$divider):this.$divider.remove()},e}()},zXxYBKpE:function(t,e,n){t.exports=function(t){var e="",i=n("2qRnoGmE");n("sa1Ed382");e+='<header class="my-tab-header tasks-header"> <ul class="my-header-tabs"> ';var o=t.taskTypes;if(o)for(var r,s=-1,a=o.length-1;s<a;)e+=' <li class="type-filter" data-type="'+(r=o[s+=1])._id+'">'+r.title+"</li> ";return e+=' </ul> <div class="tasks-menu-group pull-right"> <a data-type="done"> <span class="menu-title">'+t.doneTitle+'</span> <i class="icon icon-chevron-down"></i> </a> <a data-type="sort"> <span class="menu-title">'+t.sortTitle+'</span> <i class="icon icon-chevron-down"></i> </a> ',i.FEATURES.subPersonalTask&&(e+=" <a class=\"icalendar\" data-gta=\"{action: 'subscribe to calendar', type: 'task', control: 'Subscribe My Tasks'}\"> "+tb_i18n.get("iCalendar.title",tb_i18n.get("my.tasks"))+" </a> "),e+=' </div></header><div class="my-tasks-wrapper"></div>'}},zvO9CzUp:function(t,e,n){var i,o,r,s,a,c,l,p,u,d,h,f,v,y,g,m,b,k,w,_,M,C,S,T=function(t,e){return function(){return t.apply(e,arguments)}},E={}.hasOwnProperty;b=n("a+N5u/Cl"),S=n("sa1Ed382"),y=n("GESwhXbR").Toast,a=n("bZr3G77e"),M=n("QyjeWo4p"),k=n("2qRnoGmE"),c=n("6XSa3ffj"),C=n("RLD3BeS/"),g=C.ToastMessageWithUrl,m=C.ToastWithObject,f=n("lXfR7kvN"),u=n("+BDmEJp8"),p=n("4bWDEe5E"),v=n("oRPyOBnq").TaskFieldConfigIconMap,_=n("bvmrLhnu").isTasklistIgnored,o=n("KYwmZVTe"),i=n("2FjqrY7D"),s=n("wj2Vcbed"),h=n("bevJdz10"),d=n("+WIg4jaI"),r=n("2kwr2b1U"),l=n("H72dUcNY").ProjectSelectorWithHint,w=n("TEHCgK4p"),t.exports=function(t){function e(){return this.submitSelect=T(this.submitSelect,this),e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)E.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,c),e.prototype.className="tasklist-menu-view",e.prototype.viewName="TasklistMenuView",e.prototype.popoverTitle="",e.prototype.width=250,e.prototype.events={"click .edit-tasklist-handler":"enterEditSubMenu","click .set-tasklist-task-field-config":"enterTaskFieldConfigMenu","click .task-field-config":"onClickTaskFieldConfig","click .confirm-task-field-config":"saveDefaultTaskFieldConfig","click .stage-template-handler":"enterStageTemplateMenu","click .copy-tasklist-handler":"enterCopyOrMoveTasklistMenu","click .move-tasklist-handler":"enterCopyOrMoveTasklistMenu","click .archive-tasklist-handler":"enterArchiveSubMenu","click .export-tasklist-handler":"exportTasklistHandler","submit .tasklist-edit-form":"submitEditForm","submit .stage-template-form":"submitStageTemplateForm","submit .tasklist-archive-form":"submitArchiveForm","submit .stage-template-created":"createdForm"},e.prototype.initialize=function(t){return null==t&&(t={}),this.tasklistModel=t.tasklistModel,this._projectId=t.tasklistModel.get("_projectId"),this.projectModel=t.projectModel,this.tasklistCount=t.tasklistCount,this.onComplete=t.onComplete,this.popoverTitle=tb_i18n.get("tasklist.menu.title"),this.chosenTaskFieldConfig=null,this.listenTo(S.router,"route",this.hide),e.__super__.initialize.apply(this,arguments)},e.prototype.render=function(){return this.renderMenu(),this},e.prototype.stopPropagation=function(t){return t.stopPropagation()},e.prototype.renderMenu=function(){var t,e,n,i,r,s,a;return this.$popover.removeClass("in-submenu"),this.$title.text(this.popoverTitle),i=this.tasklistModel.hasPermissions("put","put.archive"),a=this.tasklistCount||(null!=(r=this.tasklistModel.collection)?r.length:void 0)||0,t=this.projectModel.getRoleScope()>=1,n=this.projectModel.isTaskflow(),s=!i.put&&!(i.putArchive&&a>1)&&!t&&n,e=b.extend(this.tasklistModel.toJSON(),{permissions:i,tasklistCount:a,canCopyOrMove:t,isTaskflowProject:n,showPlaceholder:s}),this.$el.html(o(e)),this.setupPlugins({_projectId:this._projectId}),this},e.prototype.enterEditSubMenu=function(){var t;return this.enterSubMenu(tb_i18n.get("tasklist.menu.edit.title"),(t=this,function(){return t.$el.html(s(t.tasklistModel.toJSON())),t.$("input").focusAtEnd()})),this.gtaConfig("edit task group"),this},e.prototype.enterTaskFieldConfigMenu=function(){var t;return this.enterSubMenu(tb_i18n.get("tasklist.menu.set.default.taskFieldConfig"),(t=this,function(){return new Promise(function(e,n){var i;return i=p.genCacheId(t._projectId,"task"),p.fetch(i,{attrs:{withTaskflowstatus:!0},boundToObjectType:"task",success:function(n){return t.taskFieldConfigsCollection=n,e()},error:n})}).then(function(){var e,n,i;return n=t.tasklistModel.get("_defaultScenariofieldconfigId")||(null!=(i=t.taskFieldConfigsCollection.at(0))?i.id:void 0),t.chosenTaskFieldConfig=t.taskFieldConfigsCollection.get(n),e=t.taskFieldConfigsCollection.map(function(t){var e;return e=v[t.get("icon")],b.extend({},t.toJSON(),{svgIcon:"#"+(null!=e?e.id:void 0)})}),t.$el.html(r(e)),t.refreshTaskFieldConfigs(n)})})),this.gtaConfig("save tasktype to taskgroup")},e.prototype.onClickTaskFieldConfig=function(t){var e;return e=$(t.currentTarget).data("id"),this.chosenTaskFieldConfig=this.taskFieldConfigsCollection.get(e),this.refreshTaskFieldConfigs(e)},e.prototype.refreshTaskFieldConfigs=function(t){var e;return this.$(".task-field-config").removeClass("selected"),this.$(".task-field-config").each(function(e,n){if($(n).data("id")===t)return $(n).addClass("selected")}),e=t===this.tasklistModel.get("_defaultScenariofieldconfigId"),this.$(".confirm-task-field-config").attr({disabled:e})},e.prototype.saveDefaultTaskFieldConfig=function(){var t;return this.tasklistModel.saveAttr("default-scenariofieldconfig-id",null,{attrs:{_scenariofieldconfigId:this.chosenTaskFieldConfig.id},success:(t=this,function(){return t.renderMenu()})}),this.gtaConfig("saved tasktype to taskgroup")},e.prototype.enterStageTemplateMenu=function(){var t;return u.fetch(this.tasklistModel.id,{success:(t=this,function(e){return t.stages=[],e.each(function(e){return t.stages.push(e.get("name").replace(/,/g,""))}),t.enterSubMenu(tb_i18n.get("tasklist.menu.templates"),function(){return t.$el.html(h({stages:t.stages})),t.$("input").focusAtEnd()})})}),this.gtaConfig("save as template"),this},e.prototype.enterCopyOrMoveTasklistMenu=function(t){var e,n,i,o;switch(e=$(t.currentTarget).data("action")){case"fork":i=tb_i18n.get("tasklist.menu.copy.title"),n=tb_i18n.get("tasklist.menu.copy.content"),this.gtaConfig("copy task group");break;case"move":i=tb_i18n.get("tasklist.menu.move.title"),n=tb_i18n.get("tasklist.menu.move.content"),this.gtaConfig("move task group")}return this.enterSubMenu(i,(o=this,function(){var t;return o.requestReactView(o.el,l,{_organizationId:null!=(t=o.projectModel)?t.get("_organizationId"):void 0,hideIndieEntry:!0,excludes:"move"===e?[o._projectId]:void 0,canToggle:function(t){var n;return _(t)&&(n="move"===e?tb_i18n.get("project.selector.moving.tasklist.into.agile.project.disabled"):tb_i18n.get("project.selector.forking.tasklist.into.agile.project.disabled")),{result:!n,error:n}},classNames:"fork-move-project-list in-tasklist-menu",objectType:"tasklist",permission:"tasklist.post",hint:n,hintClass:w.hint,onConfirm:function(t){return o.submitSelect(e,t.id)},containerHeight:o.flexStaticMaxHeight})})),this},e.prototype.submitSelect=function(t,e){var n,i,o;switch(t){case"fork":i=tb_i18n.get("copy.tasklist.success"),n=tb_i18n.get("copy.tasklist.error");break;case"move":i=tb_i18n.get("move.tasklist.success"),n=tb_i18n.get("move.tasklist.error")}return this.tasklistModel.forkOrMoveTasklist(t,e,{silentError:!0,success:(o=this,function(){return o.hide(),"function"==typeof o.onComplete&&o.onComplete(),g.success({messageTitle:i,url:"/project/"+e+"/tasks/scrum/"+o.tasklistModel.id,urlTitle:o.tasklistModel.get("title")})}),error:function(t){return function(){return t.hide(),y.error(n)}}(this)})},e.prototype.enterStageTemplateCreatedMenu=function(t){var e;return e=t.get("title"),this.$el.html(d({successInfo:tb_i18n.get("tasklist.menu.add.templates.success",e)})),this},e.prototype.enterArchiveSubMenu=function(){var t;return this.enterSubMenu(tb_i18n.get("archive"),(t=this,function(){var e;return t.$el.html(i({name:t.tasklistModel.get("title"),isLast:1===(null!=(e=t.tasklistModel.collection)?e.length:void 0)}))})),this.gtaConfig("archive task group"),this},e.prototype.exportTasklistHandler=function(){var t,e;return e=M.stringify({timezone:a.timezone()}),(t=k.API_HOST+"/tasklists/"+this.tasklistModel.id+"/export?"+e)&&$.fileDownload(t),this},e.prototype.submitEditForm=function(t){var e,n,i,o;return t.preventDefault(),i=(e=$(t.currentTarget)).find("input").val().trim(),n=e.find("textarea").val(),i?this.tasklistModel.save(null,{attrs:{title:i,description:n},success:(o=this,function(){return o.renderMenu(),o.gtaConfig("edited as template")})}):e.find("input").focusAtEnd(),this},e.prototype.submitStageTemplateForm=function(t){var e,n,i;return t.preventDefault(),(n=(e=$(t.currentTarget)).find("input").val().trim())?(f.get(0).create(null,{wait:!0,attrs:{title:n,stages:this.stages.join(",")},success:(i=this,function(t){return i.enterStageTemplateCreatedMenu(t)})}),this.gtaConfig("saved as template")):e.find("input").focusAtEnd(),this},e.prototype.submitArchiveForm=function(t){var e;return t.preventDefault(),this.gtaConfig("archived task groupe"),this.tasklistModel.archive({success:(e=this,function(){return e.hide(),m.archive()})}),this},e.prototype.createdForm=function(t){return t.preventDefault(),this.renderMenu(),this},e.prototype.gtaConfig=function(t){return S.gta.event({action:t,type:"task group",control:"tasks group title",segment:this.projectModel.getboardViewGtaSegment()})},e.prototype.returnMainMenu=function(){return this.unmountReact(this.el),e.__super__.returnMainMenu.apply(this,arguments)},e.prototype.onHidden=function(){return this.el&&this.unmountReact(this.el),e.__super__.onHidden.apply(this,arguments)},e}()}}]);
//# sourceMappingURL=5.3003da01.chunk.js.map